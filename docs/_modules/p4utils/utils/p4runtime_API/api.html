

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>p4utils.utils.p4runtime_API.api &mdash; P4-Utils 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../../',
              VERSION:'1.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> P4-Utils
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">p4utils</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">P4-Utils</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>p4utils.utils.p4runtime_API.api</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for p4utils.utils.p4runtime_API.api</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 Barefoot Networks, Inc.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;__ https://github.com/p4lang/p4runtime-shell/blob/main/p4runtime_sh/shell.py</span>

<span class="sd">This module is a modified version of p4runtime_sh.shell__ that performs low lever</span>
<span class="sd">P4Runtime operations with the server running on a capable switch. It allows to specify the</span>
<span class="sd">context and the client for each method and class that uses them without falling back to the global ones.</span>
<span class="sd">Indeed, some changes were needed to manage multiple switches at the same time.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">namedtuple</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">p4.v1</span> <span class="kn">import</span> <span class="n">p4runtime_pb2</span>
<span class="kn">from</span> <span class="nn">p4.config.v1</span> <span class="kn">import</span> <span class="n">p4info_pb2</span>
<span class="kn">import</span> <span class="nn">google.protobuf.text_format</span>
<span class="kn">from</span> <span class="nn">google.protobuf</span> <span class="kn">import</span> <span class="n">descriptor</span>

<span class="kn">from</span> <span class="nn">p4utils.utils.p4runtime_API.p4runtime</span> <span class="kn">import</span> <span class="n">P4RuntimeClient</span><span class="p">,</span> <span class="n">P4RuntimeException</span><span class="p">,</span> <span class="n">parse_p4runtime_error</span>
<span class="kn">from</span> <span class="nn">p4utils.utils.p4runtime_API</span> <span class="kn">import</span> <span class="n">bytes_utils</span>
<span class="kn">from</span> <span class="nn">p4utils.utils.p4runtime_API.context</span> <span class="kn">import</span> <span class="n">P4RuntimeEntity</span><span class="p">,</span> <span class="n">P4Type</span><span class="p">,</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">p4utils.utils.p4runtime_API.utils</span> <span class="kn">import</span> <span class="n">UserError</span><span class="p">,</span> <span class="n">InvalidP4InfoError</span>


<div class="viewcode-block" id="UserUsageError"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.UserUsageError">[docs]</a><span class="k">class</span> <span class="nc">UserUsageError</span><span class="p">(</span><span class="n">UserError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Usage: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span></div>


<div class="viewcode-block" id="NotSupportedYet"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.NotSupportedYet">[docs]</a><span class="k">class</span> <span class="nc">NotSupportedYet</span><span class="p">(</span><span class="n">UserError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">what</span> <span class="o">=</span> <span class="n">what</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not supported yet&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">what</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">_PrintContext</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_one</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>

    <span class="k">def</span> <span class="nf">find_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">DESCRIPTOR</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;TableEntry&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">table_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">find_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">DESCRIPTOR</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Action&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">action_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_sub_object</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">pcontext</span><span class="p">):</span>
    <span class="n">id_</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pcontext</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown object id </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">id_</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_sub_mf</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">pcontext</span><span class="p">):</span>
    <span class="n">id_</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="n">pcontext</span><span class="o">.</span><span class="n">find_table</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">table_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot find any table in context&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">return</span> <span class="n">pcontext</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_mf_name</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">id_</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_sub_ap</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">pcontext</span><span class="p">):</span>
    <span class="n">id_</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">action_name</span> <span class="o">=</span> <span class="n">pcontext</span><span class="o">.</span><span class="n">find_action</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">action_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot find any action in context&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">return</span> <span class="n">pcontext</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_param_name</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">id_</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_gen_pretty_print_proto_field</span><span class="p">(</span><span class="n">substitutions</span><span class="p">,</span> <span class="n">pcontext</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">myPrintField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_PrintFieldName</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">FieldDescriptor</span><span class="o">.</span><span class="n">TYPE_BYTES</span><span class="p">:</span>
            <span class="c1"># TODO(antonin): any kind of checks required?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">x</span><span class="si">{:02x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PrintFieldValue</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">containing_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subs</span> <span class="o">=</span> <span class="n">substitutions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">containing_type</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subs</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">subs</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">subs</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">](</span><span class="n">field</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">pcontext</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; (&quot;</span><span class="si">{}</span><span class="s1">&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_one_line</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">myPrintField</span>


<span class="k">def</span> <span class="nf">_repr_pretty_proto</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">substitutions</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A custom version of :py:class:`google.protobuf.text_format.MessageToString` which represents Protobuf</span>
<span class="sd">    messages with a more user-friendly string. In particular, P4Runtime ids are supplemented with</span>
<span class="sd">    the P4 name and binary strings are displayed in hexadecimal format.&quot;&quot;&quot;</span>
    <span class="n">pcontext</span> <span class="o">=</span> <span class="n">_PrintContext</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">message_formatter</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">as_one_line</span><span class="p">):</span>
        <span class="c1"># For each messages we do 2 passes: the first one updates the _PrintContext instance and</span>
        <span class="c1"># calls MessageToString again. The second pass returns None immediately (default handling by</span>
        <span class="c1"># text_format).</span>
        <span class="k">if</span> <span class="n">pcontext</span><span class="o">.</span><span class="n">skip_one</span><span class="p">:</span>
            <span class="n">pcontext</span><span class="o">.</span><span class="n">skip_one</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>
        <span class="n">pcontext</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">pcontext</span><span class="o">.</span><span class="n">skip_one</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">MessageToString</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="n">as_one_line</span><span class="o">=</span><span class="n">as_one_line</span><span class="p">,</span> <span class="n">message_formatter</span><span class="o">=</span><span class="n">message_formatter</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">indent</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pcontext</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="c1"># We modify the &quot;internals&quot; of the text_format module which is not great as it may break in the</span>
    <span class="c1"># future, but this enables us to keep the code fairly small.</span>
    <span class="n">saved_printer</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">_Printer</span><span class="o">.</span><span class="n">PrintField</span>
    <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">_Printer</span><span class="o">.</span><span class="n">PrintField</span> <span class="o">=</span> <span class="n">_gen_pretty_print_proto_field</span><span class="p">(</span>
        <span class="n">substitutions</span><span class="p">,</span> <span class="n">pcontext</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">MessageToString</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">message_formatter</span><span class="o">=</span><span class="n">message_formatter</span><span class="p">)</span>

    <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">_Printer</span><span class="o">.</span><span class="n">PrintField</span> <span class="o">=</span> <span class="n">saved_printer</span>

    <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">_repr_pretty_p4info</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">substitutions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Table&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;const_default_action_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">,</span>
                  <span class="s2">&quot;implementation_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">,</span>
                  <span class="s2">&quot;direct_resource_ids&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;ActionRef&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;ActionProfile&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;table_ids&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;DirectCounter&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;direct_table_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;DirectMeter&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;direct_table_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_repr_pretty_proto</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">substitutions</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_repr_pretty_p4runtime</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">substitutions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;TableEntry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;table_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;FieldMatch&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field_id&quot;</span><span class="p">:</span> <span class="n">_sub_mf</span><span class="p">},</span>
        <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;Param&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;param_id&quot;</span><span class="p">:</span> <span class="n">_sub_ap</span><span class="p">},</span>
        <span class="s2">&quot;ActionProfileMember&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action_profile_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;ActionProfileGroup&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action_profile_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;MeterEntry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;meter_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;CounterEntry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;counter_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;ValueSetEntry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value_set_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;RegisterEntry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;register_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;DigestEntry&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;digest_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;DigestListAck&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;digest_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
        <span class="s2">&quot;DigestList&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;digest_id&quot;</span><span class="p">:</span> <span class="n">_sub_object</span><span class="p">},</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">_repr_pretty_proto</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">substitutions</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<div class="viewcode-block" id="P4Object"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.P4Object">[docs]</a><span class="k">class</span> <span class="nc">P4Object</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A wrapper around the P4Info Protobuf message for P4 objects.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - You can access any field from the message with ``&lt;self&gt;.&lt;field name&gt;``.</span>
<span class="sd">    - You can access the *name* directly with ``&lt;self&gt;.name``.</span>
<span class="sd">    - You can access the *id* directly with ``&lt;self&gt;.id``.</span>
<span class="sd">    - If you need the underlying Protobuf message, you can access it with ``msg()``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_type</span> <span class="o">=</span> <span class="n">obj_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj_type</span> <span class="o">==</span> <span class="n">P4Type</span><span class="o">.</span><span class="n">table</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;actions&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">_repr_pretty_p4info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_repr_pretty_p4info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__settattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Operation not supported&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="P4Object.msg"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.P4Object.msg">[docs]</a>    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get Protobuf message object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span></div>

<div class="viewcode-block" id="P4Object.info"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.P4Object.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">_repr_pretty_p4info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">))</span></div>

<div class="viewcode-block" id="P4Object.actions"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.P4Object.actions">[docs]</a>    <span class="k">def</span> <span class="nf">actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print list of actions, only for tables and action profiles.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj_type</span> <span class="o">==</span> <span class="n">P4Type</span><span class="o">.</span><span class="n">table</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">action_refs</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj_type</span> <span class="o">==</span> <span class="n">P4Type</span><span class="o">.</span><span class="n">action_profile</span><span class="p">:</span>
            <span class="n">t_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj</span><span class="o">.</span><span class="n">table_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">t_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">t_id</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">t_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">action_refs</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;&#39;actions&#39; is only available for tables and action profiles&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="P4Objects"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.P4Objects">[docs]</a><span class="k">class</span> <span class="nc">P4Objects</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;All the P4 objects in the P4 program.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    To access a specific object, use ``&lt;self&gt;[&#39;&lt;name&gt;&#39;]``.</span>

<span class="sd">    Example:</span>
<span class="sd">        You can use this class to iterate over all P4 object instances::</span>

<span class="sd">            for x in &lt;self&gt;:</span>
<span class="sd">                print(x.id)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_type</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_type</span> <span class="o">=</span> <span class="n">obj_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_objs</span><span class="p">(</span><span class="n">obj_type</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ipython_key_completions_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj_type</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_obj_type</span><span class="o">.</span><span class="n">pretty_name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">P4Object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_obj_type</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Operation not allowed&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>


<div class="viewcode-block" id="MatchKey"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.MatchKey">[docs]</a><span class="k">class</span> <span class="nc">MatchKey</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Match key fields for P4 table.</span>
<span class="sd">    </span>
<span class="sd">    **Usage**</span>

<span class="sd">    Set a field value with ``&lt;self&gt;[&#39;&lt;field_name&gt;&#39;] = &#39;...&#39;``:</span>

<span class="sd">    - For *exact* match: ``&lt;self&gt;[&#39;&lt;f&gt;&#39;] = &#39;&lt;value&gt;&#39;``.</span>
<span class="sd">    - For *ternary* match: ``&lt;self&gt;[&#39;&lt;f&gt;&#39;] = &#39;&lt;value&gt;&amp;&amp;&amp;&lt;mask&gt;&#39;``.</span>
<span class="sd">    - For *LPM* match: ``&lt;self&gt;[&#39;&lt;f&gt;&#39;] = &#39;&lt;value&gt;/&lt;mask&gt;&#39;``.</span>
<span class="sd">    - For *range* match: ``&lt;self&gt;[&#39;&lt;f&gt;&#39;] = &#39;&lt;start&gt;..&lt;end&gt;&#39;``.</span>

<span class="sd">    Note:</span>
<span class="sd">        If it&#39;s inconvenient to use the whole field name, you can use a unique suffix.</span>

<span class="sd">    Example:</span>
<span class="sd">        You may also use ``&lt;self&gt;.set(&lt;f&gt;=&#39;&lt;value&gt;&#39;)`` but ``&lt;f&gt;`` must not include a ``.`` in this case.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">match_fields</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields_suffixes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">mf</span> <span class="ow">in</span> <span class="n">match_fields</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_field</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mk</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ipython_key_completions_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;clear&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_mf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_suffixes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields_suffixes</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid match field name, nor a valid unique suffix, &quot;</span>
            <span class="s2">&quot;for table &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">field_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mf</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># Allow for don&#39;t care matches (e.g. 0.0.0.0/0). Indeed, by P4Runtime spec</span>
        <span class="c1"># (see https://p4.org/p4runtime/spec/v1.3.0/P4Runtime-Spec.html#sec-match-format)</span>
        <span class="c1"># don&#39;t care matches have to be unset in the message.</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_mf</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field_info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mk</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mf</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mk</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mf</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Unset&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_parse_mf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Match field value must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_info</span><span class="o">.</span><span class="n">match_type</span> <span class="o">==</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">MatchField</span><span class="o">.</span><span class="n">EXACT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_mf_exact</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field_info</span><span class="o">.</span><span class="n">match_type</span> <span class="o">==</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">MatchField</span><span class="o">.</span><span class="n">LPM</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_mf_lpm</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field_info</span><span class="o">.</span><span class="n">match_type</span> <span class="o">==</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">MatchField</span><span class="o">.</span><span class="n">TERNARY</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_mf_ternary</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field_info</span><span class="o">.</span><span class="n">match_type</span> <span class="o">==</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">MatchField</span><span class="o">.</span><span class="n">RANGE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_mf_range</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Unsupported match type for field:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field_info</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_parse_mf_exact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">bytes_utils</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">FieldMatch</span><span class="p">()</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">field_id</span> <span class="o">=</span> <span class="n">field_info</span><span class="o">.</span><span class="n">id</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">exact</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">mf</span>

    <span class="k">def</span> <span class="nf">_parse_mf_lpm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">length</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">s</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="n">bytes_utils</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid prefix length&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_and_convert_mf_lpm</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">field_info</span><span class="p">)</span>

    <span class="c1"># TODO(antonin): use canonical representation when server supports it</span>
    <span class="k">def</span> <span class="nf">_sanitize_and_convert_mf_lpm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Allow for don&#39;t care matches (e.g. 0.0.0.0/0). Indeed, by P4Runtime spec</span>
            <span class="c1"># (see https://p4.org/p4runtime/spec/v1.3.0/P4Runtime-Spec.html#sec-match-format)</span>
            <span class="c1"># don&#39;t care matches have to be unset in the message.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LPM value was transformed to conform to the P4Runtime spec &quot;</span>
                  <span class="s2">&quot;(don&#39;t care matches must be unset)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
            <span class="c1"># raise UserError(</span>
            <span class="c1">#     &quot;Ignoring LPM don&#39;t care match (prefix length of 0) as per P4Runtime spec&quot;)</span>

        <span class="n">mf</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">FieldMatch</span><span class="p">()</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">field_id</span> <span class="o">=</span> <span class="n">field_info</span><span class="o">.</span><span class="n">id</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">lpm</span><span class="o">.</span><span class="n">prefix_len</span> <span class="o">=</span> <span class="n">length</span>

        <span class="n">first_byte_masked</span> <span class="o">=</span> <span class="n">length</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="k">if</span> <span class="n">first_byte_masked</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">mf</span><span class="o">.</span><span class="n">lpm</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">prefix</span>
            <span class="k">return</span> <span class="n">mf</span>

        <span class="n">barray</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="n">transformed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">length</span> <span class="o">%</span> <span class="mi">8</span>
        <span class="n">byte_mask</span> <span class="o">=</span> <span class="mh">0xff</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">r</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">barray</span><span class="p">[</span><span class="n">first_byte_masked</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">byte_mask</span> <span class="o">!=</span> <span class="n">barray</span><span class="p">[</span><span class="n">first_byte_masked</span><span class="p">]:</span>
            <span class="n">transformed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">barray</span><span class="p">[</span><span class="n">first_byte_masked</span><span class="p">]</span> <span class="o">=</span> <span class="n">barray</span><span class="p">[</span><span class="n">first_byte_masked</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">byte_mask</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">first_byte_masked</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">barray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">transformed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">barray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">transformed</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LPM value was transformed to conform to the P4Runtime spec &quot;</span>
                  <span class="s2">&quot;(trailing bits must be unset)&quot;</span><span class="p">)</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">lpm</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">barray</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mf</span>

    <span class="k">def</span> <span class="nf">_parse_mf_ternary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&amp;&amp;&#39;</span><span class="p">)</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">mask</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="s2">&quot;0b&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;1&quot;</span> <span class="o">*</span> <span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">bytes_utils</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">bytes_utils</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_and_convert_mf_ternary</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">field_info</span><span class="p">)</span>

    <span class="c1"># TODO(antonin): use canonical representation when server supports it</span>
    <span class="k">def</span> <span class="nf">_sanitize_and_convert_mf_ternary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;big&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Allow for don&#39;t care matches (e.g. 0.0.0.0/0). Indeed, by P4Runtime spec</span>
            <span class="c1"># (see https://p4.org/p4runtime/spec/v1.3.0/P4Runtime-Spec.html#sec-match-format)</span>
            <span class="c1"># don&#39;t care matches have to be unset in the message.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ternary value was transformed to conform to the P4Runtime spec &quot;</span>
                  <span class="s2">&quot;(don&#39;t care matches must be unset)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
            <span class="c1"># raise UserError(&quot;Ignoring ternary don&#39;t care match (mask of 0s) as per P4Runtime spec&quot;)</span>

        <span class="n">mf</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">FieldMatch</span><span class="p">()</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">field_id</span> <span class="o">=</span> <span class="n">field_info</span><span class="o">.</span><span class="n">id</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">ternary</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

        <span class="n">barray</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">transformed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">barray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">barray</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">transformed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">barray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">barray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">transformed</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ternary value was transformed to conform to the P4Runtime spec &quot;</span>
                  <span class="s2">&quot;(masked off bits must be unset)&quot;</span><span class="p">)</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">ternary</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">barray</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mf</span>

    <span class="c1"># TODO(antonin): use canonical representation when server supports it</span>
    <span class="k">def</span> <span class="nf">_parse_mf_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">end</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; does not specify a valid range, use &#39;&lt;start&gt;..&lt;end&gt;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">s</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">bytes_utils</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">bytes_utils</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_and_convert_mf_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">field_info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sanitize_and_convert_mf_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="c1"># It&#39;s a bit silly: the fields are converted from str to int to bytes by bytes_utils, then</span>
        <span class="c1"># converted back to int here...</span>
        <span class="n">start_</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
        <span class="n">end_</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_</span> <span class="o">&gt;</span> <span class="n">end_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Invalid range match: start is greater than end&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">end_</span> <span class="o">==</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">field_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Allow for don&#39;t care matches (e.g. 0.0.0.0/0). Indeed, by P4Runtime spec</span>
            <span class="c1"># (see https://p4.org/p4runtime/spec/v1.3.0/P4Runtime-Spec.html#sec-match-format)</span>
            <span class="c1"># don&#39;t care matches have to be unset in the message.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Range value was transformed to conform to the P4Runtime spec &quot;</span>
                  <span class="s2">&quot;(don&#39;t care matches must be unset)&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
            <span class="c1"># raise UserError(</span>
            <span class="c1">#     &quot;Ignoring range don&#39;t care match (all possible values) as per P4Runtime spec&quot;)</span>
        <span class="n">mf</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">FieldMatch</span><span class="p">()</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">field_id</span> <span class="o">=</span> <span class="n">field_info</span><span class="o">.</span><span class="n">id</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">end</span>
        <span class="k">return</span> <span class="n">mf</span>

    <span class="k">def</span> <span class="nf">_add_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">field_info</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recompute_suffixes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_recompute_suffixes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">suffixes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">suffix_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)):</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="n">s</span> <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">suffix</span>
                <span class="n">suffixes</span><span class="p">[</span><span class="n">suffix</span><span class="p">]</span> <span class="o">=</span> <span class="n">fname</span>
                <span class="n">suffix_count</span><span class="p">[</span><span class="n">suffix</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">suffix_count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">suffixes</span><span class="p">[</span><span class="n">suffix</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields_suffixes</span> <span class="o">=</span> <span class="n">suffixes</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">mf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mk</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">mf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mk</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mf</span><span class="p">))</span>

<div class="viewcode-block" id="MatchKey.set"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.MatchKey.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="MatchKey.clear"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.MatchKey.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mk</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mk</span><span class="p">)</span></div>


<div class="viewcode-block" id="Action"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.Action">[docs]</a><span class="k">class</span> <span class="nc">Action</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Action parameters for P4 actions.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Set a param value with ``&lt;self&gt;[&#39;&lt;param_name&gt;&#39;] = &#39;&lt;value&gt;&#39;``.</span>
<span class="sd">    - You may also use ``&lt;self&gt;.set(&lt;param_name&gt;=&#39;&lt;value&gt;&#39;)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">action_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">action_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Please provide name for action&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_name</span> <span class="o">=</span> <span class="n">action_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="n">action_info</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Unknown action &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_id</span> <span class="o">=</span> <span class="n">action_info</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">action_info</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_info</span> <span class="o">=</span> <span class="n">action_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param_values</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_ipython_key_completions_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;action_name&quot;</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid action parameter name for action &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;action_name&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot change action name&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">param_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_param</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">param_info</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param_values</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Unset&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_parse_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">param_info</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Action parameter value must be a string&quot;</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">bytes_utils</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">param_info</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">param_id</span> <span class="o">=</span> <span class="n">param_info</span><span class="o">.</span><span class="n">id</span>
        <span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">p</span>

<div class="viewcode-block" id="Action.msg"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.Action.msg">[docs]</a>    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">Action</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">action_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_id</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_param_values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">msg</span></div>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_id</span> <span class="o">==</span> <span class="n">msg</span><span class="o">.</span><span class="n">action_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="n">p_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_param_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">param_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_param_values</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">()))</span>

<div class="viewcode-block" id="Action.set"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.Action.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div></div>


<span class="k">class</span> <span class="nc">_EntityBase</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">p4runtime_cls</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">modify_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span> <span class="o">=</span> <span class="n">entity_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span> <span class="o">=</span> <span class="n">p4runtime_cls</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modify_only</span> <span class="o">=</span> <span class="n">modify_only</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modify_only</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;modify&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;insert&quot;</span><span class="p">,</span> <span class="s2">&quot;modify&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="c1"># To be called before issuing a P4Runtime request</span>
    <span class="c1"># enforces checks that cannot be performed when setting individual fields</span>
    <span class="k">def</span> <span class="nf">_validate_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_msg</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">_repr_pretty_p4runtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_msg</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">_repr_pretty_p4runtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_msg</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span>

    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_msg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_msg</span><span class="p">()</span>
        <span class="n">update</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
        <span class="n">update</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type_</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">update</span><span class="o">.</span><span class="n">entity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">write_update</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modify_only</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Insert not supported for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Inserting entry&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">Update</span><span class="o">.</span><span class="n">INSERT</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modify_only</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Delete not supported for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Deleting entry&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">Update</span><span class="o">.</span><span class="n">DELETE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Modifying entry&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">Update</span><span class="o">.</span><span class="n">MODIFY</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Entities should override this method and provide a helpful docstring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_msg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_msg</span><span class="p">()</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">Entity</span><span class="p">()</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="p">)</span>

        <span class="n">iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">read_one</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="c1"># Cannot use a (simpler) generator here as we need to decorate __next__ with</span>
        <span class="c1"># @parse_p4runtime_error.</span>
        <span class="k">class</span> <span class="nc">_EntryIterator</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">it</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entity</span> <span class="o">=</span> <span class="n">entity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_it</span> <span class="o">=</span> <span class="n">it</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entities_it</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span>

            <span class="nd">@parse_p4runtime_error</span>
            <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_it</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">rep</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_it</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_entities_it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">rep</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_it</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_entities_it</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="p">,</span> <span class="n">_P4EntityBase</span><span class="p">):</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># create new instance of same entity</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity</span><span class="o">.</span><span class="n">_entity_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># neither of these should be needed</span>
                <span class="c1"># e._update_msg()</span>
                <span class="c1"># e._entry.CopyFrom(msg)</span>
                <span class="k">return</span> <span class="n">e</span>

        <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_EntryIterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_EntryIterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterator</span><span class="p">):</span>
                <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_P4EntityBase</span><span class="p">(</span><span class="n">_EntityBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p4_type</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">p4runtime_cls</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modify_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">p4runtime_cls</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">modify_only</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_p4_type</span> <span class="o">=</span> <span class="n">p4_type</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Please provide name for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p4_type</span><span class="o">.</span><span class="n">pretty_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">P4Objects</span><span class="p">(</span><span class="n">p4_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display P4Info entry for the object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>


<div class="viewcode-block" id="ActionProfileMember"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.ActionProfileMember">[docs]</a><span class="k">class</span> <span class="nc">ActionProfileMember</span><span class="p">(</span><span class="n">_P4EntityBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An action profile member.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Use ``&lt;self&gt;.info`` to display the P4Info entry for the action profile.</span>
<span class="sd">    - Set the *member id* with ``&lt;self&gt;.member_id = &lt;expr&gt;``.</span>
<span class="sd">    - To set the action specification ``&lt;self&gt;.action = &lt;instance of type Action&gt;``.</span>
<span class="sd">    - To set the value of action parameters, use ``&lt;self&gt;.action[&#39;&lt;param name&gt;&#39;] = &lt;expr&gt;``.</span>

<span class="sd">    Example:</span>
<span class="sd">        Typical usage to insert an action profile member::</span>

<span class="sd">            m = action_profile_member[&#39;&lt;action_profile_name&gt;&#39;](action=&#39;&lt;action_name&gt;&#39;, member_id=1)</span>
<span class="sd">            m.action[&#39;&lt;p1&gt;&#39;] = ...</span>
<span class="sd">            ...</span>
<span class="sd">            m.action[&#39;&lt;pM&gt;&#39;] = ...</span>
<span class="sd">            # OR m.action.set(p1=..., ..., pM=...)</span>
<span class="sd">            m.insert</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">action_profile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4Type</span><span class="o">.</span><span class="n">action_profile</span><span class="p">,</span> <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">action_profile_member</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">ActionProfileMember</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">action_profile_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">member_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_action_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_action_set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;member_id&quot;</span><span class="p">,</span> <span class="s2">&quot;action&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_action_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">table_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">t_id</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">t_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">action</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">action_refs</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;action&quot;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot change action profile name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;member_id&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;member_id must be an integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;action&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Action</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;action must be an instance of Action&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_action_id</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">_action_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;action &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid action for this action profile&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">action_name</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_valid_action_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">action_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_action_ids</span>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">action_profile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">member_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">member_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">member_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">member_id</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">):</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">action</span>
            <span class="n">action_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">action_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">action_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

<div class="viewcode-block" id="ActionProfileMember.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.ActionProfileMember.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC. Supports wildcard reads (just leave</span>
<span class="sd">        the appropriate fields unset). If function is **None**, returns an iterator.</span>
<span class="sd">        Iterate over it to get all the members (as ``ActionProfileMember`` instances) </span>
<span class="sd">        returned by the server. Otherwise, function is applied to all the members</span>
<span class="sd">        returned by the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GroupMember"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.GroupMember">[docs]</a><span class="k">class</span> <span class="nc">GroupMember</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A member in an :py:class:`ActionProfileGroup`.</span>

<span class="sd">    Args:</span>
<span class="sd">        member_id (int): member id (required)</span>
<span class="sd">        weight (int)   : member weigth</span>
<span class="sd">        watch (int)    : member watch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">member_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;member_id is required&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">ActionProfileGroup</span><span class="o">.</span><span class="n">Member</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">member_id</span> <span class="o">=</span> <span class="n">member_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">watch</span> <span class="o">=</span> <span class="n">watch</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;member_id&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="s2">&quot;watch&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;member_id&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;member_id must be an integer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">member_id</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;weight must be an integer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;watch&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;watch must be an integer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">watch</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;member_id&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">member_id</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">weight</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;watch&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">watch</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span></div>


<div class="viewcode-block" id="ActionProfileGroup"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.ActionProfileGroup">[docs]</a><span class="k">class</span> <span class="nc">ActionProfileGroup</span><span class="p">(</span><span class="n">_P4EntityBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An action profile group.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Use ``&lt;self&gt;.info`` to display the P4Info entry for the action profile.</span>
<span class="sd">    - Set the group id with ``&lt;self&gt;.group_id = &lt;expr&gt;``. Default is ``0``.</span>
<span class="sd">    - Set the max size with ``&lt;self&gt;.max_size = &lt;expr&gt;``. Default is ``0``.</span>
<span class="sd">    - Add members to the group with ``&lt;self&gt;.add(&lt;member_id&gt;, weight=&lt;weight&gt;, watch=&lt;watch&gt;)``.</span>
<span class="sd">      ``weight`` and ``watch`` are optional (default to ``1`` and ``0`` respectively).</span>

<span class="sd">    Example:</span>
<span class="sd">        Typical usage to insert an action profile group::</span>

<span class="sd">            g = action_profile_group[&#39;&lt;action_profile_name&gt;&#39;](group_id=1)</span>
<span class="sd">            g.add(&lt;member id 1&gt;)</span>
<span class="sd">            g.add(&lt;member id 2&gt;)</span>
<span class="sd">            # OR g.add(&lt;member id 1&gt;).add(&lt;member id 2&gt;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">action_profile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4Type</span><span class="o">.</span><span class="n">action_profile</span><span class="p">,</span> <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">action_profile_group</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">ActionProfileGroup</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">action_profile_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;group_id&quot;</span><span class="p">,</span> <span class="s2">&quot;max_size&quot;</span><span class="p">,</span> <span class="s2">&quot;members&quot;</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;clear&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot change action profile name&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;group_id&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;group_id must be an integer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;members&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;members must be a list of GroupMember objects&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">GroupMember</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;members must be a list of GroupMember objects&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="ActionProfileGroup.add"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.ActionProfileGroup.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a member to the members list.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GroupMember</span><span class="p">(</span><span class="n">member_id</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">watch</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ActionProfileGroup.clear"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.ActionProfileGroup.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Empty members list.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">action_profile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">members</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">GroupMember</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;members must be a list of GroupMember objects&quot;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
            <span class="n">m</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">_msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">group_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_size</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">max_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">members</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">member_id</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">watch</span><span class="p">)</span>

<div class="viewcode-block" id="ActionProfileGroup.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.ActionProfileGroup.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC. Supports wildcard reads (just leave</span>
<span class="sd">        the appropriate fields unset). If function is **None**, returns an iterator.</span>
<span class="sd">        Iterate over it to get all the members (as ``ActionProfileGroup`` instances) </span>
<span class="sd">        returned by the server. Otherwise, function is applied to all the groups</span>
<span class="sd">        returned by the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">_get_action_profile</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
    <span class="n">implementation_id</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">implementation_id</span>
    <span class="k">if</span> <span class="n">implementation_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">implementation_name</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">implementation_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidP4InfoError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid implementation_id </span><span class="si">{}</span><span class="s2"> for table &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">implementation_id</span><span class="p">,</span> <span class="n">table_name</span><span class="p">))</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(</span><span class="n">P4Type</span><span class="o">.</span><span class="n">action_profile</span><span class="p">,</span> <span class="n">implementation_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidP4InfoError</span><span class="p">(</span><span class="s2">&quot;Unknown implementation for table &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ap</span>


<div class="viewcode-block" id="OneshotAction"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.OneshotAction">[docs]</a><span class="k">class</span> <span class="nc">OneshotAction</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;An action in a oneshot action set.</span>

<span class="sd">    Args:</span>
<span class="sd">        action (p4utils.utils.p4runtime_API.api.Action): action instance (required)</span>
<span class="sd">        weight (int)                                   : action weight</span>
<span class="sd">        watch (int)                                    : action watch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;action is required&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watch</span> <span class="o">=</span> <span class="n">watch</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="s2">&quot;watch&quot;</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;action&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Action</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;action must be an instance of Action&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;weight must be an integer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;watch&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;watch must be an integer&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="OneshotAction.msg"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.OneshotAction.msg">[docs]</a>    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">ActionProfileAction</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">watch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">watch</span>
        <span class="k">return</span> <span class="n">msg</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">()))</span></div>


<div class="viewcode-block" id="Oneshot"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.Oneshot">[docs]</a><span class="k">class</span> <span class="nc">Oneshot</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A *oneshot* action set for P4 table.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - To add an action to the set, use ``&lt;self&gt;.add(&lt;Action instance&gt;)``.</span>
<span class="sd">    - You can also access the set of actions with ``&lt;self&gt;.actions`` (which is a Python :py:class:`list`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Please provide table name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_info</span> <span class="o">=</span> <span class="n">P4Objects</span><span class="p">(</span><span class="n">P4Type</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)[</span><span class="n">table_name</span><span class="p">]</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="n">_get_action_profile</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ap</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot create Oneshot instance for a direct table&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ap</span><span class="o">.</span><span class="n">with_selector</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot create Oneshot instance for a table with an action profile &quot;</span>
                <span class="s2">&quot;without selector&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;table_name&quot;</span><span class="p">,</span> <span class="s2">&quot;actions&quot;</span><span class="p">,</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;table_name&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot change table name&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;actions&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;actions must be a list of OneshotAction objects&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">OneshotAction</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;actions must be a list of OneshotAction objects&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_action_id</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">_action_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;action &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid action for table </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">value</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_name</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_valid_action_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_id</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">action_ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_info</span><span class="o">.</span><span class="n">action_refs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action_id</span> <span class="o">==</span> <span class="n">action_ref</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Oneshot.add"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.Oneshot.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an action to the oneshot action set.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OneshotAction</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">watch</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Oneshot.msg"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.Oneshot.msg">[docs]</a>    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">ActionProfileActionSet</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">action_profile_actions</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">action</span><span class="o">.</span><span class="n">msg</span><span class="p">()</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">msg</span></div>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">action_profile_actions</span><span class="p">:</span>
            <span class="n">action_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action_id</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">action_name</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OneshotAction</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">watch</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">()))</span></div>


<span class="k">class</span> <span class="nc">_CounterData</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">attrs_for_counter_type</span><span class="p">(</span><span class="n">counter_type</span><span class="p">):</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">counter_type</span> <span class="ow">in</span> <span class="p">{</span><span class="n">p4info_pb2</span><span class="o">.</span><span class="n">CounterSpec</span><span class="o">.</span><span class="n">BYTES</span><span class="p">,</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">CounterSpec</span><span class="o">.</span><span class="n">BOTH</span><span class="p">}:</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;byte_count&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counter_type</span> <span class="ow">in</span> <span class="p">{</span><span class="n">p4info_pb2</span><span class="o">.</span><span class="n">CounterSpec</span><span class="o">.</span><span class="n">PACKETS</span><span class="p">,</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">CounterSpec</span><span class="o">.</span><span class="n">BOTH</span><span class="p">}:</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;packet_count&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">attrs</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">counter_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter_name</span> <span class="o">=</span> <span class="n">counter_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter_type</span> <span class="o">=</span> <span class="n">counter_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">CounterData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span> <span class="o">=</span> <span class="n">_CounterData</span><span class="o">.</span><span class="n">attrs_for_counter_type</span><span class="p">(</span><span class="n">counter_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">:</span>
            <span class="n">type_name</span> <span class="o">=</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">_COUNTERSPEC_UNIT</span><span class="o">.</span><span class="n">values_by_number</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_counter_type</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Counter &#39;</span><span class="si">{}</span><span class="s2">&#39; is of type &#39;</span><span class="si">{}</span><span class="s2">&#39;, you cannot set &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_counter_name</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> must be an integer&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;byte_count&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;packet_count&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">()))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_count</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">counter_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">counter_name</span><span class="p">,</span> <span class="n">counter_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_count</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">counter_type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">counter_name</span><span class="p">,</span> <span class="n">counter_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">r</span>


<span class="k">class</span> <span class="nc">_MeterConfig</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">attrs</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;cir&quot;</span><span class="p">,</span> <span class="s2">&quot;cburst&quot;</span><span class="p">,</span> <span class="s2">&quot;pir&quot;</span><span class="p">,</span> <span class="s2">&quot;pburst&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">meter_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meter_name</span> <span class="o">=</span> <span class="n">meter_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meter_type</span> <span class="o">=</span> <span class="n">meter_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">MeterConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span> <span class="o">=</span> <span class="n">_MeterConfig</span><span class="o">.</span><span class="n">attrs</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> must be an integer&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">()))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_param</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">meter_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">meter_name</span><span class="p">,</span> <span class="n">meter_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_param</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">meter_type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">meter_name</span><span class="p">,</span> <span class="n">meter_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="n">r</span>


<div class="viewcode-block" id="TableEntry"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.TableEntry">[docs]</a><span class="k">class</span> <span class="nc">TableEntry</span><span class="p">(</span><span class="n">_P4EntityBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An entry for a P4 table.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Use ``&lt;self&gt;.info`` to display the P4Info entry for this table.</span>
<span class="sd">    - To set the *match key*, use ``&lt;self&gt;.match[&#39;&lt;field name&gt;&#39;] = &lt;expr&gt;``.</span>
<span class="sd">    - To set the *action specification* (this is a direct table): ``&lt;self&gt;.action = &lt;instance of type Action&gt;``.</span>
<span class="sd">    - To set the value of *action parameters*, use ``&lt;self&gt;.action[&#39;&lt;param name&gt;&#39;] = &lt;expr&gt;``.</span>
<span class="sd">    - To set the *priority*, use ``&lt;self&gt;.priority = &lt;expr&gt;``.</span>
<span class="sd">    - To mark the entry as *default*, use ``&lt;self&gt;.is_default = True``.</span>
<span class="sd">    - If a *direct counter* is set to this table, then:</span>

<span class="sd">        - To set the counter spec, use ``&lt;self&gt;.counter_data.byte_count`` and/or ``&lt;self&gt;.counter_data.packet_count``.</span>
<span class="sd">        - To unset it, use ``&lt;self&gt;.counter_data = None`` or ``&lt;self&gt;.clear_counter_data()``.</span>
<span class="sd">    - If a *direct meter* is set to this table, then:</span>

<span class="sd">        - To access the meter config, use ``&lt;self&gt;.meter_config.&lt;cir|cburst|pir|pburst&gt;``.</span>
<span class="sd">        - To unset it, use ``&lt;self&gt;.meter_config = None`` or ``&lt;self&gt;.clear_meter_config()``.</span>
<span class="sd">    - Access the *member_id* with ``&lt;self&gt;.member_id``.</span>
<span class="sd">    - Access the *group_id* with ``&lt;self&gt;.group_id``.</span>
<span class="sd">    - To add *metadata* to the entry, use ``&lt;self&gt;.metadata = &lt;expr&gt;``.</span>

<span class="sd">    Example:</span>
<span class="sd">        Typical usage to insert a table entry::</span>

<span class="sd">            t = table_entry[&#39;&lt;table_name&gt;&#39;](action=&#39;&lt;action_name&gt;&#39;)</span>
<span class="sd">            t.match[&#39;&lt;f1&gt;&#39;] = ...</span>
<span class="sd">            ...</span>
<span class="sd">            t.match[&#39;&lt;fN&gt;&#39;] = ...</span>
<span class="sd">            # OR t.match.set(f1=..., ..., fN=...)</span>
<span class="sd">            t.action[&#39;&lt;p1&gt;&#39;] = ...</span>
<span class="sd">            ...</span>
<span class="sd">            t.action[&#39;&lt;pM&gt;&#39;] = ...</span>
<span class="sd">            # OR t.action.set(p1=..., ..., pM=...)</span>
<span class="sd">            t.insert</span>

<span class="sd">        Typical usage to set the default entry::</span>

<span class="sd">            t = table_entry[&#39;&lt;table_name&gt;&#39;](is_default=True)</span>
<span class="sd">            t.action[&#39;&lt;p1&gt;&#39;] = ...</span>
<span class="sd">            ...</span>
<span class="sd">            t.action[&#39;&lt;pM&gt;&#39;] = ...</span>
<span class="sd">            # OR t.action.set(p1=..., ..., pM=...)</span>
<span class="sd">            t.modify</span>

<span class="sd">        Typical usage to insert a table entry if you know the *member_id*::</span>

<span class="sd">            t = table_entry[&#39;&lt;table_name&gt;&#39;]</span>
<span class="sd">            t.match[&#39;&lt;f1&gt;&#39;] = ...</span>
<span class="sd">            ...</span>
<span class="sd">            t.match[&#39;&lt;fN&gt;&#39;] = ...</span>
<span class="sd">            # OR t.match.set(f1=..., ..., fN=...)</span>
<span class="sd">            t.member_id = &lt;expr&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@enum</span><span class="o">.</span><span class="n">unique</span>
    <span class="k">class</span> <span class="nc">_ActionSpecType</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
        <span class="n">NONE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">DIRECT_ACTION</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">MEMBER_ID</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">GROUP_ID</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">ONESHOT</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_action_spec_name_to_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">DIRECT_ACTION</span><span class="p">,</span>
            <span class="s2">&quot;member_id&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">MEMBER_ID</span><span class="p">,</span>
            <span class="s2">&quot;group_id&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">GROUP_ID</span><span class="p">,</span>
            <span class="s2">&quot;oneshot&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">ONESHOT</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4Type</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">table_entry</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">TableEntry</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">MatchKey</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">match_fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">NONE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_default</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="n">_get_action_profile</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_support_members</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_support_groups</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_support_members</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_support_groups</span> <span class="o">=</span> <span class="n">ap</span><span class="o">.</span><span class="n">with_selector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">res_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">direct_resource_ids</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="p">(</span><span class="n">res_id</span> <span class="o">&amp;</span> <span class="mh">0xff000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">P4Ids</span><span class="o">.</span><span class="n">DIRECT_COUNTER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_obj_by_id</span><span class="p">(</span><span class="n">res_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">prefix</span> <span class="o">==</span> <span class="n">p4info_pb2</span><span class="o">.</span><span class="n">P4Ids</span><span class="o">.</span><span class="n">DIRECT_METER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_obj_by_id</span><span class="p">(</span><span class="n">res_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span>
            <span class="s2">&quot;match&quot;</span><span class="p">,</span> <span class="s2">&quot;priority&quot;</span><span class="p">,</span> <span class="s2">&quot;is_default&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
            <span class="s2">&quot;clear_action&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_match&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_counter_data&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_meter_config&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_groups</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;member_id&quot;</span><span class="p">,</span> <span class="s2">&quot;group_id&quot;</span><span class="p">,</span> <span class="s2">&quot;oneshot&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_members</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;member_id&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;counter_data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;meter_config&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;action&quot;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_action_spec_set_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">member_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">MEMBER_ID</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">member_id</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;member_id must be an integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_members</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Table does not have an action profile and therefore does not support members&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">MEMBER_ID</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="n">member_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_action_spec_set_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">GROUP_ID</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;group_id must be an integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_groups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Table does not have an action profile with selector &quot;</span>
                <span class="s2">&quot;and therefore does not support groups&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">GROUP_ID</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_action_spec_set_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">DIRECT_ACTION</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">Action</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;action must be an instance of Action&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">implementation_id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Table has an implementation and therefore does not support direct actions &quot;</span>
                <span class="s2">&quot;(P4Runtime 1.0 doesn&#39;t support writing the default action for indirect tables&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_action_id</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">_action_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;action &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid action for this table&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">action</span><span class="o">.</span><span class="n">action_name</span><span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">DIRECT_ACTION</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_action_spec_set_oneshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oneshot</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">oneshot</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">ONESHOT</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oneshot</span><span class="p">,</span> <span class="n">Oneshot</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;oneshot must be an instance of Oneshot&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_groups</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Table does not have an action profile with selector &quot;</span>
                <span class="s2">&quot;and therefore does not support oneshot programming&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">oneshot</span><span class="o">.</span><span class="n">table_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;This Oneshot instance was not created for this table&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">ONESHOT</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="n">oneshot</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot change table name&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;priority&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;priority must be an integer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;match&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MatchKey</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;match must be an instance of MatchKey&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;is_default&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;is_default must be a boolean&quot;</span><span class="p">)</span>
            <span class="c1"># TODO(antonin): should we do a better job and handle other cases (a field is set while</span>
            <span class="c1"># is_default is set to True)?</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clearing match key because entry is now default&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;member_id&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_set_member</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;group_id&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_set_group</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;oneshot&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_set_oneshot</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;action&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_set_action</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;counter_data&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Table has no direct counter&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot set &#39;counter_data&#39; directly&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;meter_config&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Table has no direct meter&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot set &#39;meter_config&#39; directly&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;metadata&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;metadata must be a byte string&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;counter_data&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Table has no direct counter&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span> <span class="o">=</span> <span class="n">_CounterData</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;meter_config&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Table has no direct meter&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span> <span class="o">=</span> <span class="n">_MeterConfig</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_name_to_type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="n">t</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">ONESHOT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">ONESHOT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec</span> <span class="o">=</span> <span class="n">Oneshot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_is_valid_action_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_id</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">action_ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">action_refs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action_id</span> <span class="o">==</span> <span class="n">action_ref</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">priority</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_default</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">is_default_action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">for</span> <span class="n">mf</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">match</span><span class="p">:</span>
            <span class="n">mf_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_mf_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">field_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">_mk</span><span class="p">[</span><span class="n">mf_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mf</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">):</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action</span>
            <span class="n">action_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">action_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">action_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;action_profile_member_id&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">member_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action_profile_member_id</span>
        <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;action_profile_group_id&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action_profile_group_id</span>
        <span class="k">elif</span> <span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;action_profile_action_set&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oneshot</span> <span class="o">=</span> <span class="n">Oneshot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oneshot</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action_profile_action_set</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;counter_data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span> <span class="o">=</span> <span class="n">_CounterData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_counter</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">counter_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;meter_config&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span> <span class="o">=</span> <span class="n">_MeterConfig</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_meter</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">meter_config</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="TableEntry.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.TableEntry.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC. Supports wildcard reads (just leave</span>
<span class="sd">        the appropriate fields unset). If function is **None**, returns an iterator.</span>
<span class="sd">        Iterate over it to get all the table entries (``TableEntry`` instances)</span>
<span class="sd">        returned by the server. Otherwise, function is applied to all the table</span>
<span class="sd">        entries returned by the server.</span>

<span class="sd">        Example:</span>
<span class="sd">            ::</span>

<span class="sd">                for te in &lt;self&gt;.read():</span>
<span class="sd">                    print(te)</span>

<span class="sd">            The above code is equivalent to the following one-liner::</span>

<span class="sd">                &lt;self&gt;.read(lambda te: print(te))</span>

<span class="sd">            To delete all the entries from a table, simply use::</span>

<span class="sd">                table_entry[&#39;&lt;table_name&gt;&#39;].read(function=lambda x: x.delete())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">TableEntry</span><span class="p">()</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">table_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">_mk</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">priority</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">is_default_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_default</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">DIRECT_ACTION</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_spec</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">MEMBER_ID</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action_profile_member_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">GROUP_ID</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action_profile_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_spec_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">ONESHOT</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">action_profile_action_set</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_spec</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">ClearField</span><span class="p">(</span><span class="s1">&#39;counter_data&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">counter_data</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">ClearField</span><span class="p">(</span><span class="s1">&#39;meter_config&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">meter_config</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">def</span> <span class="nf">_validate_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_default</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">_count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
                <span class="s2">&quot;Match key must be empty for default entry, use &lt;self&gt;.is_default = False &quot;</span>
                <span class="s2">&quot;or &lt;self&gt;.match.clear (whichever one is appropriate)&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TableEntry.clear_action"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.TableEntry.clear_action">[docs]</a>    <span class="k">def</span> <span class="nf">clear_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears the action spec for the ``TableEntry``.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec_type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ActionSpecType</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;_action_spec&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableEntry.clear_match"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.TableEntry.clear_match">[docs]</a>    <span class="k">def</span> <span class="nf">clear_match</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears the match spec for the ``TableEntry``.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableEntry.clear_counter_data"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.TableEntry.clear_counter_data">[docs]</a>    <span class="k">def</span> <span class="nf">clear_counter_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear all counter data, same as ``&lt;self&gt;.counter_data = None``.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter_data</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TableEntry.clear_meter_config"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.TableEntry.clear_meter_config">[docs]</a>    <span class="k">def</span> <span class="nf">clear_meter_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the meter config, same as ``&lt;self&gt;.meter_config = None``.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meter_config</span> <span class="o">=</span> <span class="kc">None</span></div></div>


<span class="k">class</span> <span class="nc">_CounterEntryBase</span><span class="p">(</span><span class="n">_P4EntityBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="n">_CounterData</span><span class="o">.</span><span class="n">attrs_for_counter_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_counter_type</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span>
            <span class="s2">&quot;clear_data&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot change counter name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;byte_count&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;packet_count&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">_CounterData</span><span class="o">.</span><span class="n">set_count</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot set &#39;data&#39; directly&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;byte_count&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;packet_count&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">_CounterData</span><span class="o">.</span><span class="n">get_count</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter_type</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">r</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">_CounterData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter_type</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">_CounterData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">ClearField</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">clear_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear all counter data, same as ``&lt;self&gt;.data = None``.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="CounterEntry"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.CounterEntry">[docs]</a><span class="k">class</span> <span class="nc">CounterEntry</span><span class="p">(</span><span class="n">_CounterEntryBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An entry for a P4 counter.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Use ``&lt;self&gt;.info`` to display the P4Info entry for this counter.  </span>
<span class="sd">    - Set the index with ``&lt;self&gt;.index = &lt;expr&gt;``. To reset it </span>
<span class="sd">      (e.g. for wildcard read), set it to **None**.</span>
<span class="sd">    - Access byte count and packet count with ``&lt;self&gt;.byte_count`` / </span>
<span class="sd">      ``&lt;self&gt;.packet_count``.</span>
<span class="sd">    - To read from the counter, use ``&lt;self&gt;.read()``.</span>
<span class="sd">    - To write to the counter, use ``&lt;self&gt;.modify()``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">counter_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4Type</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">counter_entry</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">CounterEntry</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span>
            <span class="n">modify_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">counter_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">ClearField</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;index must be an integer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">index</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="CounterEntry.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.CounterEntry.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC. Supports wildcard reads (just leave</span>
<span class="sd">        the index unset). If function is **None**, returns an iterator. </span>
<span class="sd">        Iterate over it to get all the counter entries (``CounterEntry`` instances)</span>
<span class="sd">        returned by the server. Otherwise, function is applied to all the counter </span>
<span class="sd">        entries returned by the server.</span>

<span class="sd">        Example:</span>
<span class="sd">            ::</span>

<span class="sd">                for c in &lt;self&gt;.read():</span>
<span class="sd">                    print(c)</span>

<span class="sd">            The above code is equivalent to the following one-liner::</span>

<span class="sd">                &lt;self&gt;.read(lambda c: print(c))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DirectCounterEntry"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.DirectCounterEntry">[docs]</a><span class="k">class</span> <span class="nc">DirectCounterEntry</span><span class="p">(</span><span class="n">_CounterEntryBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An entry for a P4 direct counter.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Use ``&lt;self&gt;.info`` to display the P4Info entry for this direct counter.</span>
<span class="sd">    - Set the table_entry with ``&lt;self&gt;.table_entry = &lt;TableEntry instance&gt;``. </span>
<span class="sd">      To reset it (e.g. for wildcard read), set it to **None**. It is the same as:</span>
<span class="sd">      ``&lt;self&gt;.table_entry = TableEntry({})``.</span>
<span class="sd">    - Access byte count and packet count with ``&lt;self&gt;.byte_count`` / ``&lt;self&gt;.packet_count``.</span>
<span class="sd">    - To read from the counter, use ``&lt;self&gt;.read``</span>
<span class="sd">    - To write to the counter, use ``&lt;self&gt;.modify``</span>

<span class="sd">    Note:</span>
<span class="sd">        The :py:class:`TableEntry` instance must be for the table to which the direct counter is attached.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">direct_counter_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4Type</span><span class="o">.</span><span class="n">direct_counter</span><span class="p">,</span> <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">direct_counter_entry</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">DirectCounterEntry</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">direct_counter_name</span><span class="p">,</span>
            <span class="n">modify_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">direct_table_id</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidP4InfoError</span><span class="p">(</span><span class="s2">&quot;direct_table_id </span><span class="si">{}</span><span class="s2"> is not a valid table id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="o">=</span> <span class="n">TableEntry</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;table_entry&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Direct counters are not index-based&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;table_entry&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="o">=</span> <span class="n">TableEntry</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">TableEntry</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;table_entry must be an instance of TableEntry&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;This DirectCounterEntry is for table &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Direct counters are not index-based&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;table_entry&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_update_msg</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">ClearField</span><span class="p">(</span><span class="s1">&#39;table_entry&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">table_entry</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;table_entry&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">table_entry</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DirectCounterEntry.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.DirectCounterEntry.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC. Supports wildcard reads (just leave</span>
<span class="sd">        the index unset). If function is **None**, returns an iterator. </span>
<span class="sd">        Iterate over it to get all the direct counter entries (``DirectCounterEntry``</span>
<span class="sd">        instances) returned by the server. Otherwise, function is applied to </span>
<span class="sd">        all the direct counter entries returned by the server.</span>

<span class="sd">        Example:</span>
<span class="sd">            ::</span>

<span class="sd">                for c in &lt;self&gt;.read():</span>
<span class="sd">                    print(c)</span>

<span class="sd">            The above code is equivalent to the following one-liner::</span>

<span class="sd">                &lt;self&gt;.read(lambda c: print(c))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">_MeterEntryBase</span><span class="p">(</span><span class="n">_P4EntityBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meter_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="n">_MeterConfig</span><span class="o">.</span><span class="n">attrs</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;clear_config&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot change meter name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_MeterConfig</span><span class="o">.</span><span class="n">attrs</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">_MeterConfig</span><span class="o">.</span><span class="n">set_param</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Cannot set &#39;config&#39; directly&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_MeterConfig</span><span class="o">.</span><span class="n">attrs</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">_MeterConfig</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter_type</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">r</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">_MeterConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter_type</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">_MeterConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meter_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">ClearField</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">clear_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the meter config, same as ``&lt;self&gt;.config = None``.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="MeterEntry"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.MeterEntry">[docs]</a><span class="k">class</span> <span class="nc">MeterEntry</span><span class="p">(</span><span class="n">_MeterEntryBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An entry for a P4 meter.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Use ``&lt;self&gt;.info`` to display the P4Info entry for this meter.</span>
<span class="sd">    - Set the index with ``&lt;self&gt;.index = &lt;expr&gt;``. To reset it (e.g. </span>
<span class="sd">      for wildcard read), set it to **None**.</span>
<span class="sd">    - Access meter rates and burst sizes with:</span>

<span class="sd">        - ``&lt;self&gt;.cir``</span>
<span class="sd">        - ``&lt;self&gt;.cburst``</span>
<span class="sd">        - ``&lt;self&gt;.pir``</span>
<span class="sd">        - ``&lt;self&gt;.pburst``</span>
<span class="sd">    - To read from the meter, use ``&lt;self&gt;.read``.</span>
<span class="sd">    - To write to the meter, use ``&lt;self&gt;.modify``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">meter_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4Type</span><span class="o">.</span><span class="n">meter</span><span class="p">,</span> <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">meter_entry</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">MeterEntry</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span>
            <span class="n">modify_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">meter_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">ClearField</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;index must be an integer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">index</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="MeterEntry.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.MeterEntry.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC. Supports wildcard reads (just leave</span>
<span class="sd">        the index unset). If function is **None**, returns an iterator. </span>
<span class="sd">        Iterate over it to get all the meter entries (``MeterEntry`` instances)</span>
<span class="sd">        returned by the server. Otherwise, function is applied to all the</span>
<span class="sd">        meter entries returned by the server.</span>

<span class="sd">        Example:</span>
<span class="sd">            ::</span>

<span class="sd">                for c in &lt;self&gt;.read():</span>
<span class="sd">                    print(c)</span>

<span class="sd">            The above code is equivalent to the following one-liner::</span>

<span class="sd">                &lt;self&gt;.read(lambda c: print(c))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DirectMeterEntry"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.DirectMeterEntry">[docs]</a><span class="k">class</span> <span class="nc">DirectMeterEntry</span><span class="p">(</span><span class="n">_MeterEntryBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An entry for a P4 direct meter.</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Use ``&lt;self&gt;.info`` to display the P4Info entry for this direct meter.</span>
<span class="sd">    - Set the table_entry with ``&lt;self&gt;.table_entry = &lt;TableEntry instance&gt;``. </span>
<span class="sd">      To reset it (e.g. for wildcard read), set it to **None**. It is the same as: </span>
<span class="sd">      ``&lt;self&gt;.table_entry = TableEntry({})``</span>
<span class="sd">    - Access meter rates and burst sizes with:</span>

<span class="sd">        - ``&lt;self&gt;.cir``</span>
<span class="sd">        - ``&lt;self&gt;.cburst``</span>
<span class="sd">        - ``&lt;self&gt;.pir``</span>
<span class="sd">        - ``&lt;self&gt;.pburst``</span>
<span class="sd">    - To read from the meter, use ``&lt;self&gt;.read``.</span>
<span class="sd">    - To write to the meter, use ``&lt;self&gt;.modify``.</span>

<span class="sd">    Note:</span>
<span class="sd">        The :py:class:`TableEntry` instance must be for the table to which the direct meter is attached.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">direct_meter_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4Type</span><span class="o">.</span><span class="n">direct_meter</span><span class="p">,</span> <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">direct_meter_entry</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">DirectMeterEntry</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">direct_meter_name</span><span class="p">,</span>
            <span class="n">modify_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">direct_table_id</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get_name_from_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidP4InfoError</span><span class="p">(</span><span class="s2">&quot;direct_table_id </span><span class="si">{}</span><span class="s2"> is not a valid table id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="o">=</span> <span class="n">TableEntry</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;table_entry&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Direct meters are not index-based&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;table_entry&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="o">=</span> <span class="n">TableEntry</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">TableEntry</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;table_entry must be an instance of TableEntry&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;This DirectMeterEntry is for table &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_direct_table_name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Direct meters are not index-based&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;table_entry&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_update_msg</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">ClearField</span><span class="p">(</span><span class="s1">&#39;table_entry&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span><span class="o">.</span><span class="n">table_entry</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s1">&#39;table_entry&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span><span class="o">.</span><span class="n">_from_msg</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">table_entry</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table_entry</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DirectMeterEntry.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.DirectMeterEntry.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC. Supports wildcard reads (just leave</span>
<span class="sd">        the index unset). If function is **None**, returns an iterator. </span>
<span class="sd">        Iterate over it to get all the direct meter entries (``DirectMeterEntry``</span>
<span class="sd">        instances) returned by the server. Otherwise, function is applied to</span>
<span class="sd">        all the direct meter entries returned by the server.</span>

<span class="sd">        Example:</span>
<span class="sd">            ::</span>

<span class="sd">                for c in &lt;self&gt;.read():</span>
<span class="sd">                    print(c)</span>

<span class="sd">            The above code is equivalent to the following one-liner::</span>

<span class="sd">                &lt;self&gt;.read(lambda c: print(c))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Replica"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.Replica">[docs]</a><span class="k">class</span> <span class="nc">Replica</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A replica is the pair ``(&lt;port number&gt;, &lt;instance id&gt;)``.</span>
<span class="sd">    It is used for multicast and clone session programming.</span>

<span class="sd">    Args:</span>
<span class="sd">        egress_port (int): outboud packets port</span>
<span class="sd">        instance (int)   : instance of the packet replication</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">egress_port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">egress_port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;egress_port is required&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">Replica</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">egress_port</span> <span class="o">=</span> <span class="n">egress_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;egress_port&quot;</span><span class="p">,</span> <span class="s2">&quot;instance&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;egress_port&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;egress_port must be an integer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">egress_port</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;instance must be an integer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;egress_port&quot;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">egress_port</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="o">.</span><span class="n">instance</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">))</span></div>


<div class="viewcode-block" id="MulticastGroupEntry"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.MulticastGroupEntry">[docs]</a><span class="k">class</span> <span class="nc">MulticastGroupEntry</span><span class="p">(</span><span class="n">_EntityBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Multicast group entry.</span>

<span class="sd">    Args:</span>
<span class="sd">        group_id (int): multicast group id</span>

<span class="sd">    **Usage**</span>

<span class="sd">    Add replicas with ``&lt;self&gt;.add(&lt;eg_port_1&gt;, &lt;instance_1&gt;).add(&lt;eg_port_2&gt;, &lt;instance_2&gt;)...``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">group_id</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">packet_replication_engine_entry</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">PacketReplicationEngineEntry</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="n">group_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;group_id&quot;</span><span class="p">,</span> <span class="s2">&quot;replicas&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;group_id&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;group_id must be an integer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;replicas&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;replicas must be a list of Replica objects&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Replica</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;replicas must be a list of Replica objects&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">multicast_group_entry</span><span class="o">.</span><span class="n">multicast_group_id</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">multicast_group_entry</span><span class="o">.</span><span class="n">replicas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">egress_port</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>

<div class="viewcode-block" id="MulticastGroupEntry.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.MulticastGroupEntry.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC to read a single ``MulticastGroupEntry``</span>
<span class="sd">        (wildcard reads not supported). If function is **None**, return a </span>
<span class="sd">        ``MulticastGroupEntry`` instance (or **None** if the provided group id </span>
<span class="sd">        does not exist). If function is not **None**, function is applied to the</span>
<span class="sd">        ``MulticastGroupEntry`` instance (if any).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">PacketReplicationEngineEntry</span><span class="p">()</span>
        <span class="n">mcg_entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">multicast_group_entry</span>
        <span class="n">mcg_entry</span><span class="o">.</span><span class="n">multicast_group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span>
        <span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">mcg_entry</span><span class="o">.</span><span class="n">replicas</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
            <span class="n">r</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">replica</span><span class="o">.</span><span class="n">_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span> <span class="o">=</span> <span class="n">entry</span>

    <span class="k">def</span> <span class="nf">_validate_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;0 is not a valid group_id for MulticastGroupEntry&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="MulticastGroupEntry.add"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.MulticastGroupEntry.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">egress_port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a replica to the multicast group.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Replica</span><span class="p">(</span><span class="n">egress_port</span><span class="p">,</span> <span class="n">instance</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="CloneSessionEntry"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.CloneSessionEntry">[docs]</a><span class="k">class</span> <span class="nc">CloneSessionEntry</span><span class="p">(</span><span class="n">_EntityBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clone session entry.</span>

<span class="sd">    Args:</span>
<span class="sd">        session_id (int): clone session id</span>

<span class="sd">    **Usage**</span>

<span class="sd">    - Add replicas with ``&lt;self&gt;.add(&lt;eg_port_1&gt;, &lt;instance_1&gt;).add(&lt;eg_port_2&gt;, &lt;instance_2&gt;)...``</span>
<span class="sd">    - Access class of service with ``&lt;self&gt;.cos``.</span>
<span class="sd">    - Access truncation length with ``&lt;self&gt;.packet_length_bytes``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">packet_replication_engine_entry</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">PacketReplicationEngineEntry</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">session_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packet_length_bytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;session_id&quot;</span><span class="p">,</span> <span class="s2">&quot;replicas&quot;</span><span class="p">,</span> <span class="s2">&quot;cos&quot;</span><span class="p">,</span> <span class="s2">&quot;packet_length_bytes&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;session_id&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;session_id must be an integer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;replicas&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;replicas must be a list of Replica objects&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Replica</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;replicas must be a list of Replica objects&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;cos&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;cos must be an integer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;packet_length_bytes&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;packet_length_bytes must be an integer&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">clone_session_entry</span><span class="o">.</span><span class="n">session_id</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">clone_session_entry</span><span class="o">.</span><span class="n">replicas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">egress_port</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cos</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">clone_session_entry</span><span class="o">.</span><span class="n">class_of_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packet_length_bytes</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">clone_session_entry</span><span class="o">.</span><span class="n">packet_length_bytes</span>

<div class="viewcode-block" id="CloneSessionEntry.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.CloneSessionEntry.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC to read a single ``CloneSessionEntry``</span>
<span class="sd">        (wildcard reads not supported). If function is **None**, return a</span>
<span class="sd">        ``CloneSessionEntry`` instance (or **None** if the provided group id does</span>
<span class="sd">        not exist). If function is not **None**, function is applied to the </span>
<span class="sd">        ``CloneSessionEntry`` instance (if any).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">PacketReplicationEngineEntry</span><span class="p">()</span>
        <span class="n">cs_entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">clone_session_entry</span>
        <span class="n">cs_entry</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span>
        <span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">cs_entry</span><span class="o">.</span><span class="n">replicas</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
            <span class="n">r</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">replica</span><span class="o">.</span><span class="n">_msg</span><span class="p">)</span>
        <span class="n">cs_entry</span><span class="o">.</span><span class="n">class_of_service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cos</span>
        <span class="n">cs_entry</span><span class="o">.</span><span class="n">packet_length_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packet_length_bytes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span> <span class="o">=</span> <span class="n">entry</span>

<div class="viewcode-block" id="CloneSessionEntry.add"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.CloneSessionEntry.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">egress_port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a replica to the clone session.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Replica</span><span class="p">(</span><span class="n">egress_port</span><span class="p">,</span> <span class="n">instance</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="DigestEntry"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.DigestEntry">[docs]</a><span class="k">class</span> <span class="nc">DigestEntry</span><span class="p">(</span><span class="n">_P4EntityBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A P4Runtime digest entry.</span>
<span class="sd">    </span>
<span class="sd">    It is used to configure how the device must generate digest messages.</span>
<span class="sd">    </span>
<span class="sd">    **Usage**</span>

<span class="sd">    - The maximum server buffering delay in nanoseconds for an outstanding digest message</span>
<span class="sd">      can be set using ``&lt;self&gt;.max_timeout_ns = &lt;expr&gt;``. By default, this is set to ``0``, i.e. the server</span>
<span class="sd">      should generate a ``DigestList`` message for every digest message generated by the data plane.</span>
<span class="sd">    - The maximum digest list size  in number of digest messages  sent by the server to the client as a </span>
<span class="sd">      single ``DigestList`` message can be set using ``&lt;self&gt;.max_list_size = &lt;expr&gt;``. By default, this</span>
<span class="sd">      is set to ``1``, i.e. the server should generate a ``DigestList`` message for every digest message generated</span>
<span class="sd">      by the data plane.</span>
<span class="sd">    - The timeout in nanoseconds that a server must wait for a digest list acknowledgement from the </span>
<span class="sd">      client before new digest messages can be generated for the same learned data can be set using</span>
<span class="sd">      ``&lt;self&gt;.ack_timeout_ns = &lt;expr&gt;``. By default, this is set to ``0``, i.e. the cache of digests not </span>
<span class="sd">      yet acknowledged must always be an empty set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">digest_name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">P4Type</span><span class="o">.</span><span class="n">digest</span><span class="p">,</span> <span class="n">P4RuntimeEntity</span><span class="o">.</span><span class="n">digest_entry</span><span class="p">,</span>
            <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">DigestEntry</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">digest_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout_ns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_list_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ack_timeout_ns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span>
            <span class="s2">&quot;max_timeout_ns&quot;</span><span class="p">,</span> <span class="s2">&quot;max_list_size&quot;</span><span class="p">,</span> <span class="s2">&quot;ack_timeout_ns&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;max_timeout_ns&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;max_timeout_ns must be an integer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;max_list_size&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;max_list_size must be an integer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ack_timeout_ns&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;ack_timeout_ns must be an integer&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout_ns</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_timeout_ns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_list_size</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_list_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ack_timeout_ns</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ack_timeout_ns</span>

<div class="viewcode-block" id="DigestEntry.read"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.DigestEntry.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a P4Runtime Read RPC. Supports wildcard reads (just leave</span>
<span class="sd">        the appropriate fields unset). If function is **None**, returns an iterator,</span>
<span class="sd">        otherwise the function is applied to every entry in the iterator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">function</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">DigestEntry</span><span class="p">()</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">digest_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_timeout_ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout_ns</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_list_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_list_size</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ack_timeout_ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ack_timeout_ns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entry</span> <span class="o">=</span> <span class="n">entry</span></div>


<div class="viewcode-block" id="Write"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.Write">[docs]</a><span class="k">def</span> <span class="nf">Write</span><span class="p">(</span><span class="n">input_</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reads a ``WriteRequest`` from a file (text format) and sends it to the server.</span>
<span class="sd">    It rewrites the device id and election id appropriately.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">p4runtime_pb2</span><span class="o">.</span><span class="n">WriteRequest</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">input_</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">google</span><span class="o">.</span><span class="n">protobuf</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">req</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span>
            <span class="s2">&quot;Write only works with files at the moment and &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a file&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">input_</span><span class="p">))</span></div>


<div class="viewcode-block" id="APIVersion"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.APIVersion">[docs]</a><span class="k">def</span> <span class="nf">APIVersion</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the version of the **P4Runtime API** implemented by the server, using</span>
<span class="sd">    the Capabilities RPC.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">api_version</span><span class="p">()</span></div>


<span class="n">FwdPipeConfig</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;FwdPipeConfig&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;p4info&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="setup"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.setup">[docs]</a><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">device_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">grpc_addr</span><span class="o">=</span><span class="s1">&#39;localhost:9559&#39;</span><span class="p">,</span> <span class="n">election_id</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Establishes the connection to the P4Runtime server.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating P4Runtime client&quot;</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">P4RuntimeClient</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">grpc_addr</span><span class="p">,</span> <span class="n">election_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p4info_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">p4info</span>
            <span class="n">bin_path</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">bin</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;config&#39; must be a FwdPipeConfig namedtuple&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">set_fwd_pipe_config</span><span class="p">(</span><span class="n">p4info_path</span><span class="p">,</span> <span class="n">bin_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">tear_down</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="n">P4RuntimeException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">tear_down</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">client</span><span class="o">.</span><span class="n">tear_down</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">p4info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_p4info</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">P4RuntimeException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">client</span><span class="o">.</span><span class="n">tear_down</span><span class="p">()</span>
        <span class="k">raise</span> <span class="n">e</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing P4Info message&quot;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">set_p4info</span><span class="p">(</span><span class="n">p4info</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">client</span><span class="p">,</span> <span class="n">context</span></div>


<div class="viewcode-block" id="teardown"><a class="viewcode-back" href="../../../../p4utils.utils.p4runtime_API.api.html#p4utils.utils.p4runtime_API.api.teardown">[docs]</a><span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tears down the connection to the P4Runtime server.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Tearing down P4Runtime client&quot;</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">tear_down</span><span class="p">()</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Networked Systems Group (NSG@ETH).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>