

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>p4utils.utils.thrift_API &mdash; P4-Utils 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'1.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  false,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> P4-Utils
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">General Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced_usage.html">Advanced Usage</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../p4utils.html">P4-Utils API reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">P4-Utils</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>p4utils.utils.thrift_API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for p4utils.utils.thrift_API</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># Copyright 2013-present Barefoot Networks, Inc.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>

<span class="c1">#</span>
<span class="c1"># Antonin Bas (antonin@barefootnetworks.com)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># Further work: Edgar Costa (cedgar@ethz.ch)</span>
<span class="c1"># Further work: Jurij Nota (junota@student.ethz.ch)</span>

<span class="sd">&quot;&quot;&quot;__ https://github.com/p4lang/behavioral-model/blob/main/tools/runtime_CLI.py</span>

<span class="sd">This module is a modified version of runtime_CLI__ that performs control plane</span>
<span class="sd">operations by connecting to the *Thrift* server running on a capable switch. The</span>
<span class="sd">main difference between this code and the original one is that this module is an API,</span>
<span class="sd">whereas the other is a client.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">bmpy_utils</span> <span class="k">as</span> <span class="nn">utils</span>


<span class="kn">from</span> <span class="nn">bm_runtime.standard</span> <span class="kn">import</span> <span class="n">Standard</span>
<span class="kn">from</span> <span class="nn">bm_runtime.standard.ttypes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">bm_runtime.simple_pre</span> <span class="kn">import</span> <span class="n">SimplePre</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">bm_runtime.simple_pre_lag</span> <span class="kn">import</span> <span class="n">SimplePreLAG</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="enum"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.enum">[docs]</a><span class="k">def</span> <span class="nf">enum</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="o">*</span><span class="n">sequential</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
    <span class="n">enums</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sequential</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequential</span><span class="p">))))),</span> <span class="o">**</span><span class="n">named</span><span class="p">)</span>
    <span class="n">reverse</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">enums</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">enums</span><span class="p">[</span><span class="s1">&#39;to_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_str</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">enums</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

    <span class="n">enums</span><span class="p">[</span><span class="s1">&#39;from_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_str</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="p">(),</span> <span class="n">enums</span><span class="p">)</span></div>


<span class="n">PreType</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;PreType&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;SimplePre&#39;</span><span class="p">,</span> <span class="s1">&#39;SimplePreLAG&#39;</span><span class="p">)</span>
<span class="n">MeterType</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;MeterType&#39;</span><span class="p">,</span> <span class="s1">&#39;packets&#39;</span><span class="p">,</span> <span class="s1">&#39;bytes&#39;</span><span class="p">)</span>
<span class="n">TableType</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;TableType&#39;</span><span class="p">,</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span> <span class="s1">&#39;indirect&#39;</span><span class="p">,</span> <span class="s1">&#39;indirect_ws&#39;</span><span class="p">)</span>
<span class="n">ResType</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="s1">&#39;ResType&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;action_prof&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;meter_array&#39;</span><span class="p">,</span>
               <span class="s1">&#39;counter_array&#39;</span><span class="p">,</span> <span class="s1">&#39;register_array&#39;</span><span class="p">,</span> <span class="s1">&#39;parse_vset&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="bytes_to_string"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.bytes_to_string">[docs]</a><span class="k">def</span> <span class="nf">bytes_to_string</span><span class="p">(</span><span class="n">byte_array</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">byte_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="o">*</span><span class="n">byte_array</span><span class="p">)</span></div>

<div class="viewcode-block" id="table_error_name"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.table_error_name">[docs]</a><span class="k">def</span> <span class="nf">table_error_name</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">TableOperationErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">x</span><span class="p">]</span></div>


<div class="viewcode-block" id="MatchType"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.MatchType">[docs]</a><span class="k">class</span> <span class="nc">MatchType</span><span class="p">:</span>
    <span class="n">EXACT</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">LPM</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">TERNARY</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">VALID</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">RANGE</span> <span class="o">=</span> <span class="mi">4</span>

<div class="viewcode-block" id="MatchType.to_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.MatchType.to_str">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;lpm&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;ternary&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;range&quot;</span><span class="p">}[</span><span class="n">x</span><span class="p">]</span></div>

<div class="viewcode-block" id="MatchType.from_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.MatchType.from_str">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;exact&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;lpm&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ternary&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}[</span><span class="n">x</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="Table"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Table">[docs]</a><span class="k">class</span> <span class="nc">Table</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match_type_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_action</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_timeout</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_prof</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Table.num_key_fields"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Table.num_key_fields">[docs]</a>    <span class="k">def</span> <span class="nf">num_key_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="Table.key_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Table.key_str">[docs]</a>    <span class="k">def</span> <span class="nf">key_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;,</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bw</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">bw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">])</span></div>

<div class="viewcode-block" id="Table.table_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Table.table_str">[docs]</a>    <span class="k">def</span> <span class="nf">table_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ap_str</span> <span class="o">=</span> <span class="s2">&quot;implementation=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;None&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_prof</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_prof</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0:30}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">, mk=</span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ap_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_str</span><span class="p">())</span></div>

<div class="viewcode-block" id="Table.get_action"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Table.get_action">[docs]</a>    <span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">suffix_lookup_map</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">ResType</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="n">action_name</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">suffix_lookup_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">action</span></div></div>


<div class="viewcode-block" id="ActionProf"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ActionProf">[docs]</a><span class="k">class</span> <span class="nc">ActionProf</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_selection</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_cnt</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="ActionProf.action_prof_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ActionProf.action_prof_str">[docs]</a>    <span class="k">def</span> <span class="nf">action_prof_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0:30}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_selection</span><span class="p">)</span></div>

<div class="viewcode-block" id="ActionProf.get_action"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ActionProf.get_action">[docs]</a>    <span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">suffix_lookup_map</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">ResType</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="n">action_name</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">suffix_lookup_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">action</span></div></div>


<div class="viewcode-block" id="Action"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Action">[docs]</a><span class="k">class</span> <span class="nc">Action</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runtime_data</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Action.num_params"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Action.num_params">[docs]</a>    <span class="k">def</span> <span class="nf">num_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">runtime_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Action.runtime_data_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Action.runtime_data_str">[docs]</a>    <span class="k">def</span> <span class="nf">runtime_data_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;,</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bw</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">bw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_data</span><span class="p">])</span></div>

<div class="viewcode-block" id="Action.action_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.Action.action_str">[docs]</a>    <span class="k">def</span> <span class="nf">action_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0:30}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime_data_str</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="MeterArray"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.MeterArray">[docs]</a><span class="k">class</span> <span class="nc">MeterArray</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_direct</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_count</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="MeterArray.meter_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.MeterArray.meter_str">[docs]</a>    <span class="k">def</span> <span class="nf">meter_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0:30}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">, </span><span class="si">{2}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                                          <span class="n">MeterType</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="CounterArray"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.CounterArray">[docs]</a><span class="k">class</span> <span class="nc">CounterArray</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_direct</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CounterArray.counter_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.CounterArray.counter_str">[docs]</a>    <span class="k">def</span> <span class="nf">counter_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0:30}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RegisterArray"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.RegisterArray">[docs]</a><span class="k">class</span> <span class="nc">RegisterArray</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="RegisterArray.register_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.RegisterArray.register_str">[docs]</a>    <span class="k">def</span> <span class="nf">register_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0:30}</span><span class="s2"> [</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ParseVSet"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ParseVSet">[docs]</a><span class="k">class</span> <span class="nc">ParseVSet</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_</span> <span class="o">=</span> <span class="n">id_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bitwidth</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="ParseVSet.parse_vset_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ParseVSet.parse_vset_str">[docs]</a>    <span class="k">def</span> <span class="nf">parse_vset_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0:30}</span><span class="s2"> [compressed bitwidth:</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SwitchInfo"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.SwitchInfo">[docs]</a><span class="k">class</span> <span class="nc">SwitchInfo</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_profs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meter_arrays</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter_arrays</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_arrays</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_crc_calcs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_vsets</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># maps (object type, unique suffix) to object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix_lookup_map</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="SwitchInfo.reset_config"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.SwitchInfo.reset_config">[docs]</a>    <span class="k">def</span> <span class="nf">reset_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_profs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meter_arrays</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter_arrays</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_arrays</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_crc_calcs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_vsets</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="SwitchInfo.load_json_config"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.SwitchInfo.load_json_config">[docs]</a>    <span class="k">def</span> <span class="nf">load_json_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">standard_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">read_conf</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">json_path</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">standard_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">utils</span><span class="o">.</span><span class="n">check_JSON_md5</span><span class="p">(</span><span class="n">standard_client</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="n">standard_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">json_cfg</span> <span class="o">=</span> <span class="n">standard_client</span><span class="o">.</span><span class="n">bm_get_config</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">json_cfg</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_json_str</span><span class="p">(</span><span class="n">read_conf</span><span class="p">())</span></div>

<div class="viewcode-block" id="SwitchInfo.load_json_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.SwitchInfo.load_json_str">[docs]</a>    <span class="k">def</span> <span class="nf">load_json_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_str</span><span class="p">,</span> <span class="n">architecture_spec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">get_header_type</span><span class="p">(</span><span class="n">header_name</span><span class="p">,</span> <span class="n">j_headers</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">j_headers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">header_name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;header_type&quot;</span><span class="p">]</span>
            <span class="k">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_field_bitwidth</span><span class="p">(</span><span class="n">header_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">j_header_types</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">j_header_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">header_type</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]:</span>
                    <span class="c1"># t can have a third element (field signedness)</span>
                    <span class="n">f</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="n">field_name</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">bw</span>
            <span class="k">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_config</span><span class="p">()</span>
        <span class="n">json_</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_json_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">json_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">j_action</span> <span class="ow">in</span> <span class="n">get_json_key</span><span class="p">(</span><span class="s2">&quot;actions&quot;</span><span class="p">):</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="n">j_action</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">j_action</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j_param</span> <span class="ow">in</span> <span class="n">j_action</span><span class="p">[</span><span class="s2">&quot;runtime_data&quot;</span><span class="p">]:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">runtime_data</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">j_param</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">j_param</span><span class="p">[</span><span class="s2">&quot;bitwidth&quot;</span><span class="p">])]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">j_action</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">action</span>

        <span class="k">for</span> <span class="n">j_pipeline</span> <span class="ow">in</span> <span class="n">get_json_key</span><span class="p">(</span><span class="s2">&quot;pipelines&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;action_profiles&quot;</span> <span class="ow">in</span> <span class="n">j_pipeline</span><span class="p">:</span>  <span class="c1"># new JSON format</span>
                <span class="k">for</span> <span class="n">j_aprof</span> <span class="ow">in</span> <span class="n">j_pipeline</span><span class="p">[</span><span class="s2">&quot;action_profiles&quot;</span><span class="p">]:</span>
                    <span class="n">action_prof</span> <span class="o">=</span> <span class="n">ActionProf</span><span class="p">(</span><span class="n">j_aprof</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">j_aprof</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                    <span class="n">action_prof</span><span class="o">.</span><span class="n">with_selection</span> <span class="o">=</span> <span class="s2">&quot;selector&quot;</span> <span class="ow">in</span> <span class="n">j_aprof</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">action_profs</span><span class="p">[</span><span class="n">j_aprof</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">action_prof</span>

            <span class="k">for</span> <span class="n">j_table</span> <span class="ow">in</span> <span class="n">j_pipeline</span><span class="p">[</span><span class="s2">&quot;tables&quot;</span><span class="p">]:</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                <span class="n">table</span><span class="o">.</span><span class="n">match_type</span> <span class="o">=</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;match_type&quot;</span><span class="p">])</span>
                <span class="n">table</span><span class="o">.</span><span class="n">type_</span> <span class="o">=</span> <span class="n">TableType</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
                <span class="n">table</span><span class="o">.</span><span class="n">support_timeout</span> <span class="o">=</span> <span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;support_timeout&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]:</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">action</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">type_</span> <span class="ow">in</span> <span class="p">{</span><span class="n">TableType</span><span class="o">.</span><span class="n">indirect</span><span class="p">,</span> <span class="n">TableType</span><span class="o">.</span><span class="n">indirect_ws</span><span class="p">}:</span>
                    <span class="k">if</span> <span class="s2">&quot;action_profile&quot;</span> <span class="ow">in</span> <span class="n">j_table</span><span class="p">:</span>
                        <span class="n">action_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_profs</span><span class="p">[</span><span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;action_profile&quot;</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># for backward compatibility</span>
                        <span class="k">assert</span><span class="p">(</span><span class="s2">&quot;act_prof_name&quot;</span> <span class="ow">in</span> <span class="n">j_table</span><span class="p">)</span>
                        <span class="n">action_prof</span> <span class="o">=</span> <span class="n">ActionProf</span><span class="p">(</span><span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;act_prof_name&quot;</span><span class="p">],</span>
                                                 <span class="n">table</span><span class="o">.</span><span class="n">id_</span><span class="p">)</span>
                        <span class="n">action_prof</span><span class="o">.</span><span class="n">with_selection</span> <span class="o">=</span> <span class="s2">&quot;selector&quot;</span> <span class="ow">in</span> <span class="n">j_table</span>

                    <span class="n">action_prof</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
                    <span class="n">action_prof</span><span class="o">.</span><span class="n">ref_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">action_profs</span><span class="p">[</span><span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;act_prof_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">action_prof</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">action_prof</span> <span class="o">=</span> <span class="n">action_prof</span>

                <span class="k">for</span> <span class="n">j_key</span> <span class="ow">in</span> <span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]:</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">j_key</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
                    <span class="n">match_type</span> <span class="o">=</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">j_key</span><span class="p">[</span><span class="s2">&quot;match_type&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match_type</span> <span class="o">==</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">VALID</span><span class="p">:</span>
                        <span class="n">field_name</span> <span class="o">=</span> <span class="n">target</span> <span class="o">+</span> <span class="s2">&quot;_valid&quot;</span>
                        <span class="n">bitwidth</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;$valid$&quot;</span><span class="p">:</span>
                        <span class="n">field_name</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_valid&quot;</span>
                        <span class="n">bitwidth</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">field_name</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                        <span class="n">header_type</span> <span class="o">=</span> <span class="n">get_header_type</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                      <span class="n">json_</span><span class="p">[</span><span class="s2">&quot;headers&quot;</span><span class="p">])</span>
                        <span class="n">bitwidth</span> <span class="o">=</span> <span class="n">get_field_bitwidth</span><span class="p">(</span><span class="n">header_type</span><span class="p">,</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                      <span class="n">json_</span><span class="p">[</span><span class="s2">&quot;header_types&quot;</span><span class="p">])</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">key</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">match_type</span><span class="p">,</span> <span class="n">bitwidth</span><span class="p">)]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">j_table</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span>

        <span class="k">for</span> <span class="n">j_meter</span> <span class="ow">in</span> <span class="n">get_json_key</span><span class="p">(</span><span class="s2">&quot;meter_arrays&quot;</span><span class="p">):</span>
            <span class="n">meter_array</span> <span class="o">=</span> <span class="n">MeterArray</span><span class="p">(</span><span class="n">j_meter</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">j_meter</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">&quot;is_direct&quot;</span> <span class="ow">in</span> <span class="n">j_meter</span> <span class="ow">and</span> <span class="n">j_meter</span><span class="p">[</span><span class="s2">&quot;is_direct&quot;</span><span class="p">]:</span>
                <span class="n">meter_array</span><span class="o">.</span><span class="n">is_direct</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">meter_array</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="n">j_meter</span><span class="p">[</span><span class="s2">&quot;binding&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">meter_array</span><span class="o">.</span><span class="n">is_direct</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">meter_array</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">j_meter</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
            <span class="n">meter_array</span><span class="o">.</span><span class="n">type_</span> <span class="o">=</span> <span class="n">MeterType</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">j_meter</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
            <span class="n">meter_array</span><span class="o">.</span><span class="n">rate_count</span> <span class="o">=</span> <span class="n">j_meter</span><span class="p">[</span><span class="s2">&quot;rate_count&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">meter_arrays</span><span class="p">[</span><span class="n">j_meter</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">meter_array</span>


        <span class="k">for</span> <span class="n">j_counter</span> <span class="ow">in</span> <span class="n">get_json_key</span><span class="p">(</span><span class="s2">&quot;counter_arrays&quot;</span><span class="p">):</span>
            <span class="n">counter_array</span> <span class="o">=</span> <span class="n">CounterArray</span><span class="p">(</span><span class="n">j_counter</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">j_counter</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="n">counter_array</span><span class="o">.</span><span class="n">is_direct</span> <span class="o">=</span> <span class="n">j_counter</span><span class="p">[</span><span class="s2">&quot;is_direct&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">counter_array</span><span class="o">.</span><span class="n">is_direct</span><span class="p">:</span>
                <span class="n">counter_array</span><span class="o">.</span><span class="n">binding</span> <span class="o">=</span> <span class="n">j_counter</span><span class="p">[</span><span class="s2">&quot;binding&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">counter_array</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">j_counter</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">counter_arrays</span><span class="p">[</span><span class="n">j_counter</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">counter_array</span>

        <span class="k">for</span> <span class="n">j_register</span> <span class="ow">in</span> <span class="n">get_json_key</span><span class="p">(</span><span class="s2">&quot;register_arrays&quot;</span><span class="p">):</span>
            <span class="n">register_array</span> <span class="o">=</span> <span class="n">RegisterArray</span><span class="p">(</span><span class="n">j_register</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">j_register</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="n">register_array</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">j_register</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>
            <span class="n">register_array</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">j_register</span><span class="p">[</span><span class="s2">&quot;bitwidth&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">register_arrays</span><span class="p">[</span><span class="n">j_register</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">register_array</span>

        <span class="k">for</span> <span class="n">j_calc</span> <span class="ow">in</span> <span class="n">get_json_key</span><span class="p">(</span><span class="s2">&quot;calculations&quot;</span><span class="p">):</span>
            <span class="n">calc_name</span> <span class="o">=</span> <span class="n">j_calc</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">j_calc</span><span class="p">[</span><span class="s2">&quot;algo&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;crc16_custom&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">custom_crc_calcs</span><span class="p">[</span><span class="n">calc_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="k">elif</span> <span class="n">j_calc</span><span class="p">[</span><span class="s2">&quot;algo&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;crc32_custom&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">custom_crc_calcs</span><span class="p">[</span><span class="n">calc_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span>

        <span class="k">for</span> <span class="n">j_parse_vset</span> <span class="ow">in</span> <span class="n">get_json_key</span><span class="p">(</span><span class="s2">&quot;parse_vsets&quot;</span><span class="p">):</span>
            <span class="n">parse_vset</span> <span class="o">=</span> <span class="n">ParseVSet</span><span class="p">(</span><span class="n">j_parse_vset</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">j_parse_vset</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="n">parse_vset</span><span class="o">.</span><span class="n">bitwidth</span> <span class="o">=</span> <span class="n">j_parse_vset</span><span class="p">[</span><span class="s2">&quot;compressed_bitwidth&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">parse_vsets</span><span class="p">[</span><span class="n">j_parse_vset</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parse_vset</span>

        <span class="k">if</span> <span class="n">architecture_spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># call architecture specific json parsing code</span>
            <span class="n">architecture_spec</span><span class="p">(</span><span class="n">json_</span><span class="p">)</span>

        <span class="c1"># Builds a dictionary mapping (object type, unique suffix) to the object</span>
        <span class="c1"># (Table, Action, etc...). In P4_16 the object name is the fully-qualified</span>
        <span class="c1"># name, which can be quite long, which is why we accept unique suffixes as</span>
        <span class="c1"># valid identifiers.</span>
        <span class="c1"># Auto-complete does not support suffixes, only the fully-qualified names,</span>
        <span class="c1"># but that can be changed in the future if needed.</span>
        <span class="n">suffix_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">res_type</span><span class="p">,</span> <span class="n">res_dict</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">),</span> <span class="p">(</span><span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_profs</span><span class="p">),</span>
                <span class="p">(</span><span class="n">ResType</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">),</span> <span class="p">(</span><span class="n">ResType</span><span class="o">.</span><span class="n">meter_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">meter_arrays</span><span class="p">),</span>
                <span class="p">(</span><span class="n">ResType</span><span class="o">.</span><span class="n">counter_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter_arrays</span><span class="p">),</span>
                <span class="p">(</span><span class="n">ResType</span><span class="o">.</span><span class="n">register_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_arrays</span><span class="p">),</span>
                <span class="p">(</span><span class="n">ResType</span><span class="o">.</span><span class="n">parse_vset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_vsets</span><span class="p">)]:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)):</span>
                    <span class="n">suffix</span> <span class="o">=</span> <span class="n">s</span> <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">suffix</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">res_type</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
                    <span class="n">suffix_count</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">#checks if a table is repeated, in that case it removes the only suffix entries</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">suffix_count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="UIn_Error"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.UIn_Error">[docs]</a><span class="k">class</span> <span class="nc">UIn_Error</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span></div>


<div class="viewcode-block" id="UIn_ResourceError"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.UIn_ResourceError">[docs]</a><span class="k">class</span> <span class="nc">UIn_ResourceError</span><span class="p">(</span><span class="n">UIn_Error</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_type</span> <span class="o">=</span> <span class="n">res_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Invalid </span><span class="si">{}</span><span class="s2"> name (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="UIn_MatchKeyError"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.UIn_MatchKeyError">[docs]</a><span class="k">class</span> <span class="nc">UIn_MatchKeyError</span><span class="p">(</span><span class="n">UIn_Error</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span></div>


<div class="viewcode-block" id="UIn_RuntimeDataError"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.UIn_RuntimeDataError">[docs]</a><span class="k">class</span> <span class="nc">UIn_RuntimeDataError</span><span class="p">(</span><span class="n">UIn_Error</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span></div>


<div class="viewcode-block" id="CLI_FormatExploreError"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.CLI_FormatExploreError">[docs]</a><span class="k">class</span> <span class="nc">CLI_FormatExploreError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="UIn_BadParamError"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.UIn_BadParamError">[docs]</a><span class="k">class</span> <span class="nc">UIn_BadParamError</span><span class="p">(</span><span class="n">UIn_Error</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span></div>


<div class="viewcode-block" id="UIn_BadIPv4Error"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.UIn_BadIPv4Error">[docs]</a><span class="k">class</span> <span class="nc">UIn_BadIPv4Error</span><span class="p">(</span><span class="n">UIn_Error</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="UIn_BadIPv6Error"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.UIn_BadIPv6Error">[docs]</a><span class="k">class</span> <span class="nc">UIn_BadIPv6Error</span><span class="p">(</span><span class="n">UIn_Error</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="UIn_BadMacError"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.UIn_BadMacError">[docs]</a><span class="k">class</span> <span class="nc">UIn_BadMacError</span><span class="p">(</span><span class="n">UIn_Error</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="ipv4Addr_to_bytes"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ipv4Addr_to_bytes">[docs]</a><span class="k">def</span> <span class="nf">ipv4Addr_to_bytes</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">addr</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CLI_FormatExploreError</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">addr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadIPv4Error</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadIPv4Error</span><span class="p">()</span></div>


<div class="viewcode-block" id="macAddr_to_bytes"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.macAddr_to_bytes">[docs]</a><span class="k">def</span> <span class="nf">macAddr_to_bytes</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">addr</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CLI_FormatExploreError</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">addr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadMacError</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadMacError</span><span class="p">()</span></div>


<div class="viewcode-block" id="ipv6Addr_to_bytes"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ipv6Addr_to_bytes">[docs]</a><span class="k">def</span> <span class="nf">ipv6Addr_to_bytes</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">ipaddr</span> <span class="kn">import</span> <span class="n">IPv6Address</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">addr</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CLI_FormatExploreError</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">IPv6Address</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadIPv6Error</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">ip</span><span class="o">.</span><span class="n">packed</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadIPv6Error</span><span class="p">()</span></div>


<div class="viewcode-block" id="int_to_bytes"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.int_to_bytes">[docs]</a><span class="k">def</span> <span class="nf">int_to_bytes</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
    <span class="n">byte_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">byte_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">256</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">256</span>
        <span class="n">num</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadParamError</span><span class="p">(</span><span class="s2">&quot;Parameter is too large&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">byte_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">byte_array</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">byte_array</span></div>


<div class="viewcode-block" id="parse_param"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.parse_param">[docs]</a><span class="k">def</span> <span class="nf">parse_param</span><span class="p">(</span><span class="n">input_str</span><span class="p">,</span> <span class="n">bitwidth</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bitwidth</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ipv4Addr_to_bytes</span><span class="p">(</span><span class="n">input_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CLI_FormatExploreError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="n">UIn_BadIPv4Error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_BadParamError</span><span class="p">(</span><span class="s2">&quot;Invalid IPv4 address&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">bitwidth</span> <span class="o">==</span> <span class="mi">48</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">macAddr_to_bytes</span><span class="p">(</span><span class="n">input_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CLI_FormatExploreError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="n">UIn_BadMacError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_BadParamError</span><span class="p">(</span><span class="s2">&quot;Invalid MAC address&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">bitwidth</span> <span class="o">==</span> <span class="mi">128</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ipv6Addr_to_bytes</span><span class="p">(</span><span class="n">input_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CLI_FormatExploreError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="n">UIn_BadIPv6Error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_BadParamError</span><span class="p">(</span><span class="s2">&quot;Invalid IPv6 address&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">input_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_str</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadParamError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid input, could not cast to integer, try in hex with 0x prefix&quot;</span>
        <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">int_to_bytes</span><span class="p">(</span><span class="n">input_</span><span class="p">,</span> <span class="p">(</span><span class="n">bitwidth</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">UIn_BadParamError</span><span class="p">:</span>
        <span class="k">raise</span></div>


<div class="viewcode-block" id="parse_runtime_data"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.parse_runtime_data">[docs]</a><span class="k">def</span> <span class="nf">parse_runtime_data</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse_param_</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">bw</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parse_param</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UIn_BadParamError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_RuntimeDataError</span><span class="p">(</span>
                <span class="s2">&quot;Error while parsing </span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="n">bitwidths</span> <span class="o">=</span> <span class="p">[</span><span class="n">bw</span> <span class="k">for</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">runtime_data</span><span class="p">]</span>
    <span class="n">byte_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">input_str</span><span class="p">,</span> <span class="n">bitwidth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">bitwidths</span><span class="p">):</span>
        <span class="n">byte_array</span> <span class="o">+=</span> <span class="p">[</span><span class="n">bytes_to_string</span><span class="p">(</span><span class="n">parse_param_</span><span class="p">(</span><span class="n">input_str</span><span class="p">,</span> <span class="n">bitwidth</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">byte_array</span></div>


<span class="n">_match_types_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">MatchType</span><span class="o">.</span><span class="n">EXACT</span><span class="p">:</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">EXACT</span><span class="p">,</span>
    <span class="n">MatchType</span><span class="o">.</span><span class="n">LPM</span><span class="p">:</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">LPM</span><span class="p">,</span>
    <span class="n">MatchType</span><span class="o">.</span><span class="n">TERNARY</span><span class="p">:</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">TERNARY</span><span class="p">,</span>
    <span class="n">MatchType</span><span class="o">.</span><span class="n">VALID</span><span class="p">:</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">VALID</span><span class="p">,</span>
    <span class="n">MatchType</span><span class="o">.</span><span class="n">RANGE</span><span class="p">:</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">RANGE</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="parse_match_key"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.parse_match_key">[docs]</a><span class="k">def</span> <span class="nf">parse_match_key</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">key_fields</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">parse_param_</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">bw</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parse_param</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UIn_BadParamError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_MatchKeyError</span><span class="p">(</span>
                <span class="s2">&quot;Error while parsing </span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">match_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
    <span class="n">bitwidths</span> <span class="o">=</span> <span class="p">[</span><span class="n">bw</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">bw</span><span class="p">)</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">key_fields</span><span class="p">):</span>
        <span class="n">param_type</span> <span class="o">=</span> <span class="n">_match_types_mapping</span><span class="p">[</span><span class="n">match_types</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>
        <span class="n">bw</span> <span class="o">=</span> <span class="n">bitwidths</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param_type</span> <span class="o">==</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">EXACT</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">bytes_to_string</span><span class="p">(</span><span class="n">parse_param_</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">bw</span><span class="p">))</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">BmMatchParam</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">param_type</span><span class="p">,</span>
                                 <span class="n">exact</span><span class="o">=</span><span class="n">BmMatchParamExact</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">param_type</span> <span class="o">==</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">LPM</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">prefix</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_MatchKeyError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid LPM value </span><span class="si">{}</span><span class="s2">, use &#39;/&#39; to separate prefix &quot;</span>
                    <span class="s2">&quot;and length&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">bytes_to_string</span><span class="p">(</span><span class="n">parse_param_</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">bw</span><span class="p">))</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">BmMatchParam</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">param_type</span><span class="p">,</span>
                                 <span class="n">lpm</span><span class="o">=</span><span class="n">BmMatchParamLPM</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">param_type</span> <span class="o">==</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">TERNARY</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&amp;&amp;&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_MatchKeyError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid ternary value </span><span class="si">{}</span><span class="s2">, use &#39;&amp;&amp;&amp;&#39; to separate key and &quot;</span>
                    <span class="s2">&quot;mask&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">bytes_to_string</span><span class="p">(</span><span class="n">parse_param_</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">bw</span><span class="p">))</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">bytes_to_string</span><span class="p">(</span><span class="n">parse_param_</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">bw</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UIn_MatchKeyError</span><span class="p">(</span>
                    <span class="s2">&quot;Key and mask have different lengths in expression </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">forma</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">BmMatchParam</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">param_type</span><span class="p">,</span>
                                 <span class="n">ternary</span><span class="o">=</span><span class="n">BmMatchParamTernary</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">param_type</span> <span class="o">==</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">VALID</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">BmMatchParam</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">param_type</span><span class="p">,</span>
                                 <span class="n">valid</span><span class="o">=</span><span class="n">BmMatchParamValid</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">param_type</span> <span class="o">==</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">RANGE</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_MatchKeyError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid range value </span><span class="si">{}</span><span class="s2">, use &#39;-&gt;&#39; to separate range start &quot;</span>
                    <span class="s2">&quot;and range end&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">bytes_to_string</span><span class="p">(</span><span class="n">parse_param_</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">bw</span><span class="p">))</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">bytes_to_string</span><span class="p">(</span><span class="n">parse_param_</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">bw</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">end</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UIn_MatchKeyError</span><span class="p">(</span>
                    <span class="s2">&quot;start and end have different lengths in expression </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_MatchKeyError</span><span class="p">(</span>
                    <span class="s2">&quot;start is less than end in expression </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">BmMatchParam</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">param_type</span><span class="p">,</span>
                                 <span class="nb">range</span><span class="o">=</span><span class="n">BmMatchParamRange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">params</span></div>


<div class="viewcode-block" id="printable_byte_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.printable_byte_str">[docs]</a><span class="k">def</span> <span class="nf">printable_byte_str</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">format</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;02x&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span></div>


<div class="viewcode-block" id="BmMatchParam_to_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.BmMatchParam_to_str">[docs]</a><span class="k">def</span> <span class="nf">BmMatchParam_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">BmMatchParamType</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span>\
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exact</span><span class="o">.</span><span class="n">to_str</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exact</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span>\
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lpm</span><span class="o">.</span><span class="n">to_str</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lpm</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span>\
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ternary</span><span class="o">.</span><span class="n">to_str</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ternary</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span>\
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">to_str</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span>\
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">to_str</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BmMatchParamExact_to_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.BmMatchParamExact_to_str">[docs]</a><span class="k">def</span> <span class="nf">BmMatchParamExact_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">printable_byte_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="BmMatchParamLPM_to_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.BmMatchParamLPM_to_str">[docs]</a><span class="k">def</span> <span class="nf">BmMatchParamLPM_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">printable_byte_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix_length</span><span class="p">)</span></div>


<div class="viewcode-block" id="BmMatchParamTernary_to_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.BmMatchParamTernary_to_str">[docs]</a><span class="k">def</span> <span class="nf">BmMatchParamTernary_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">printable_byte_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp;&amp; &quot;</span> <span class="o">+</span> <span class="n">printable_byte_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span></div>


<div class="viewcode-block" id="BmMatchParamValid_to_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.BmMatchParamValid_to_str">[docs]</a><span class="k">def</span> <span class="nf">BmMatchParamValid_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="BmMatchParamRange_to_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.BmMatchParamRange_to_str">[docs]</a><span class="k">def</span> <span class="nf">BmMatchParamRange_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">printable_byte_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="n">printable_byte_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_</span><span class="p">)</span></div>


<span class="n">BmMatchParam</span><span class="o">.</span><span class="n">to_str</span> <span class="o">=</span> <span class="n">BmMatchParam_to_str</span>
<span class="n">BmMatchParamExact</span><span class="o">.</span><span class="n">to_str</span> <span class="o">=</span> <span class="n">BmMatchParamExact_to_str</span>
<span class="n">BmMatchParamLPM</span><span class="o">.</span><span class="n">to_str</span> <span class="o">=</span> <span class="n">BmMatchParamLPM_to_str</span>
<span class="n">BmMatchParamTernary</span><span class="o">.</span><span class="n">to_str</span> <span class="o">=</span> <span class="n">BmMatchParamTernary_to_str</span>
<span class="n">BmMatchParamValid</span><span class="o">.</span><span class="n">to_str</span> <span class="o">=</span> <span class="n">BmMatchParamValid_to_str</span>
<span class="n">BmMatchParamRange</span><span class="o">.</span><span class="n">to_str</span> <span class="o">=</span> <span class="n">BmMatchParamRange_to_str</span>


<div class="viewcode-block" id="parse_pvs_value"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.parse_pvs_value">[docs]</a><span class="k">def</span> <span class="nf">parse_pvs_value</span><span class="p">(</span><span class="n">input_str</span><span class="p">,</span> <span class="n">bitwidth</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">input_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_str</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadParamError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid input, could not cast to integer, try in hex with 0x prefix&quot;</span>
        <span class="p">)</span>
    <span class="n">max_v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bitwidth</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="c1"># bmv2 does not perform this check when receiving the value (and does not</span>
    <span class="c1"># truncate values which are too large), so we perform this check</span>
    <span class="c1"># client-side.</span>
    <span class="k">if</span> <span class="n">input_</span> <span class="o">&gt;</span> <span class="n">max_v</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">UIn_BadParamError</span><span class="p">(</span>
            <span class="s2">&quot;Input is too large, it should fit within </span><span class="si">{}</span><span class="s2"> bits&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bitwidth</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">int_to_bytes</span><span class="p">(</span><span class="n">input_</span><span class="p">,</span> <span class="p">(</span><span class="n">bitwidth</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">UIn_BadParamError</span><span class="p">:</span>
        <span class="c1"># should not happen because of check above</span>
        <span class="k">raise</span>
    <span class="k">return</span> <span class="n">bytes_to_string</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

<span class="c1"># services is [(service_name, client_class), ...]</span>


<div class="viewcode-block" id="thrift_connect"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.thrift_connect">[docs]</a><span class="k">def</span> <span class="nf">thrift_connect</span><span class="p">(</span><span class="n">thrift_ip</span><span class="p">,</span> <span class="n">thrift_port</span><span class="p">,</span> <span class="n">services</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">thrift_connect</span><span class="p">(</span><span class="n">thrift_ip</span><span class="p">,</span> <span class="n">thrift_port</span><span class="p">,</span> <span class="n">services</span><span class="p">)</span></div>


<div class="viewcode-block" id="handle_bad_input"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.handle_bad_input">[docs]</a><span class="k">def</span> <span class="nf">handle_bad_input</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UIn_MatchKeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid match key:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UIn_RuntimeDataError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid runtime data:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UIn_Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">InvalidTableOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">TableOperationErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid table operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">InvalidCounterOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">CounterOperationErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid counter operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">InvalidMeterOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">MeterOperationErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid meter operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">InvalidRegisterOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">RegisterOperationErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid register operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">InvalidLearnOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">LearnOperationErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid learn operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">InvalidSwapOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">SwapOperationErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid swap operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">InvalidDevMgrOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">DevMgrErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid device manager operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">InvalidCrcOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">CrcErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid crc operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">InvalidParseVSetOperation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">ParseVSetOperationErrorCode</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid parser value set operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">handle</span></div>


<div class="viewcode-block" id="handle_bad_input_mc"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.handle_bad_input_mc">[docs]</a><span class="k">def</span> <span class="nf">handle_bad_input_mc</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">pre_type</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pre_type</span>
        <span class="k">if</span> <span class="n">pre_type</span> <span class="o">==</span> <span class="n">PreType</span><span class="o">.</span><span class="n">none</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handle_bad_input</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">EType</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePre</span><span class="p">:</span> <span class="n">SimplePre</span><span class="o">.</span><span class="n">InvalidMcOperation</span><span class="p">,</span>
            <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePreLAG</span><span class="p">:</span> <span class="n">SimplePreLAG</span><span class="o">.</span><span class="n">InvalidMcOperation</span>
        <span class="p">}[</span><span class="n">pre_type</span><span class="p">]</span>
        <span class="n">Codes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePre</span><span class="p">:</span> <span class="n">SimplePre</span><span class="o">.</span><span class="n">McOperationErrorCode</span><span class="p">,</span>
            <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePreLAG</span><span class="p">:</span> <span class="n">SimplePreLAG</span><span class="o">.</span><span class="n">McOperationErrorCode</span>
        <span class="p">}[</span><span class="n">pre_type</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handle_bad_input</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">EType</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">Codes</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid PRE operation (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">handle</span></div>


<div class="viewcode-block" id="deprecated_act_prof"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.deprecated_act_prof">[docs]</a><span class="k">def</span> <span class="nf">deprecated_act_prof</span><span class="p">(</span><span class="n">substitute</span><span class="p">,</span> <span class="n">with_selection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">strictly_deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># need two levels here because our decorator takes arguments</span>
    <span class="k">def</span> <span class="nf">deprecated_act_prof_</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="c1"># not sure if this is the right place for it, if I want it to play nice</span>
        <span class="c1"># with @wraps</span>
        <span class="k">if</span> <span class="n">strictly_deprecated</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;[DEPRECATED!] &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span>
            <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Use &#39;</span><span class="si">{}</span><span class="s2">&#39; instead&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">substitute</span><span class="p">)</span>

        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">substitute_fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;do_&quot;</span> <span class="o">+</span> <span class="n">substitute</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">at_least_n_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_selection</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">check_indirect_ws</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">check_indirect</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">action_prof</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">action_prof</span><span class="o">.</span><span class="n">ref_cnt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">strictly_deprecated</span> <span class="ow">and</span> <span class="n">table</span><span class="o">.</span><span class="n">action_prof</span><span class="o">.</span><span class="n">ref_cnt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                    <span class="s2">&quot;Legacy command does not work with shared action profiles&quot;</span><span class="p">)</span>
            <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">action_prof</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">strictly_deprecated</span><span class="p">:</span>
                <span class="c1"># writing to stderr in case someone is parsing stdout</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="s2">&quot;This is a deprecated command, use &#39;</span><span class="si">{}</span><span class="s2">&#39; instead</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">substitute</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">substitute_fn</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="c1"># we add the handle_bad_input decorator &quot;programatically&quot;</span>
        <span class="k">return</span> <span class="n">handle_bad_input</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">deprecated_act_prof_</span></div>

<span class="c1"># thrift does not support unsigned integers</span>


<div class="viewcode-block" id="hex_to_i16"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.hex_to_i16">[docs]</a><span class="k">def</span> <span class="nf">hex_to_i16</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mh">0xFFFF</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Integer cannot fit within 16 bits&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mh">0x7FFF</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">-=</span> <span class="mh">0x10000</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="i16_to_hex"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.i16_to_hex">[docs]</a><span class="k">def</span> <span class="nf">i16_to_hex</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">+=</span> <span class="mh">0x10000</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="hex_to_i32"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.hex_to_i32">[docs]</a><span class="k">def</span> <span class="nf">hex_to_i32</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mh">0xFFFFFFFF</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Integer cannot fit within 32 bits&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mh">0x7FFFFFFF</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">-=</span> <span class="mh">0x100000000</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="i32_to_hex"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.i32_to_hex">[docs]</a><span class="k">def</span> <span class="nf">i32_to_hex</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">+=</span> <span class="mh">0x100000000</span>
    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="parse_bool"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.parse_bool">[docs]</a><span class="k">def</span> <span class="nf">parse_bool</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;false&quot;</span> <span class="ow">or</span> <span class="n">s</span>  <span class="o">==</span> <span class="s2">&quot;False&quot;</span> <span class="ow">or</span> <span class="n">s</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Invalid bool parameter&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="hexstr"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.hexstr">[docs]</a><span class="k">def</span> <span class="nf">hexstr</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">format</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;02x&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">v</span><span class="p">])</span></div>


<div class="viewcode-block" id="ThriftAPI"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI">[docs]</a><span class="k">class</span> <span class="nc">ThriftAPI</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;This class implements a client that connects to a P4 switch control plane </span>
<span class="sd">    and allows to configure it. It establishes a *Thrift* connection with the </span>
<span class="sd">    switch server that is then used to forward configuration information.</span>

<span class="sd">    Args:</span>
<span class="sd">        thrift_port (int) : port number the *Thrift* server listens on</span>
<span class="sd">        thrift_ip (str)   : IP the *Thrift* server listens on</span>
<span class="sd">        pre_type (str)    : PreType option</span>
<span class="sd">        json_path (str)   : path to the P4 compiled JSON file (optional)</span>

<span class="sd">    Possible values for **pre_type** are the following:</span>

<span class="sd">    - ``simple_pre``</span>
<span class="sd">    - ``simple_pre_lag``</span>
<span class="sd">    - ``none``</span>

<span class="sd">    Attributes:</span>
<span class="sd">        switch_info (:py:class:`SwitchInfo`)            : object containing information about all the</span>
<span class="sd">                                                          P4 structures present in the switch.</span>
<span class="sd">        client                                          : *Thrift* client instance.</span>
<span class="sd">        mc_client                                       : *Thrift* mc client instance.</span>
<span class="sd">        pre_type (:py:class:`str`)                      : given PreType option.</span>
<span class="sd">        table_entries_match_to_handle (:py:class:`dict`): dictionary used to associate table matches</span>
<span class="sd">                                                          with the related handle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ThriftAPI.get_thrift_services"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_thrift_services">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_thrift_services</span><span class="p">(</span><span class="n">pre_type</span><span class="p">):</span>

        <span class="n">services</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;standard&quot;</span><span class="p">,</span> <span class="n">Standard</span><span class="o">.</span><span class="n">Client</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">pre_type</span> <span class="o">==</span> <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePre</span><span class="p">:</span>
            <span class="n">services</span> <span class="o">+=</span> <span class="p">[(</span><span class="s2">&quot;simple_pre&quot;</span><span class="p">,</span> <span class="n">SimplePre</span><span class="o">.</span><span class="n">Client</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">pre_type</span> <span class="o">==</span> <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePreLAG</span><span class="p">:</span>
            <span class="n">services</span> <span class="o">+=</span> <span class="p">[(</span><span class="s2">&quot;simple_pre_lag&quot;</span><span class="p">,</span> <span class="n">SimplePreLAG</span><span class="o">.</span><span class="n">Client</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">services</span> <span class="o">+=</span> <span class="p">[(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">services</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thrift_port</span><span class="p">,</span> <span class="n">thrift_ip</span><span class="p">,</span> <span class="n">pre_type</span><span class="p">,</span> <span class="n">json_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pre_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">pre_type</span> <span class="o">=</span> <span class="n">PreType</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">pre_type</span><span class="p">)</span>

        <span class="n">standard_client</span><span class="p">,</span> <span class="n">mc_client</span> <span class="o">=</span> <span class="n">thrift_connect</span><span class="p">(</span><span class="n">thrift_ip</span><span class="p">,</span>
                                                    <span class="n">thrift_port</span><span class="p">,</span>
                                                    <span class="n">ThriftAPI</span><span class="o">.</span><span class="n">get_thrift_services</span><span class="p">(</span><span class="n">pre_type</span><span class="p">))</span>

        <span class="c1"># Controller to Switch Info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span> <span class="o">=</span> <span class="n">SwitchInfo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">load_json_config</span><span class="p">(</span><span class="n">standard_client</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">standard_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span> <span class="o">=</span> <span class="n">mc_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_type</span> <span class="o">=</span> <span class="n">pre_type</span>

        <span class="c1"># TODO: have a look at this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_entries_match_to_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_match_to_handle_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_table_entries_match_to_handle</span><span class="p">()</span>
        <span class="c1">#self.table_multiple_names = self.load_table_to_all_names()</span>

<div class="viewcode-block" id="ThriftAPI.create_match_to_handle_dict"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.create_match_to_handle_dict">[docs]</a>    <span class="k">def</span> <span class="nf">create_match_to_handle_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tables</span><span class="p">():</span>
            <span class="n">d</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="ThriftAPI.shell"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.shell">[docs]</a>    <span class="k">def</span> <span class="nf">shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs a shell command.&quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.get_res"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_res">[docs]</a>    <span class="k">def</span> <span class="nf">get_res</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">res_type</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">res_type</span><span class="p">,</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_ResourceError</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="ThriftAPI.parse_runtime_data"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.parse_runtime_data">[docs]</a>    <span class="k">def</span> <span class="nf">parse_runtime_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">action_params</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">action_params</span><span class="p">)</span> <span class="o">!=</span> <span class="n">action</span><span class="o">.</span><span class="n">num_params</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Action </span><span class="si">{}</span><span class="s2"> needs </span><span class="si">{}</span><span class="s2"> parameters&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">num_params</span><span class="p">())</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">parse_runtime_data</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action_params</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.show_tables"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.show_tables">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">show_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lists tables defined in the P4 program.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">tables</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">TABLES</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span><span class="o">.</span><span class="n">table_str</span><span class="p">())</span></div>

<div class="viewcode-block" id="ThriftAPI.show_actions"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.show_actions">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">show_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lists actions defined in the P4 program.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">actions</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">action_name</span><span class="p">]</span><span class="o">.</span><span class="n">action_str</span><span class="p">())</span></div>

<div class="viewcode-block" id="ThriftAPI.table_show_actions"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_show_actions">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_show_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lists one table&#39;s actions as per the P4 program.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str): name of the table</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">actions</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">action_name</span><span class="p">]</span><span class="o">.</span><span class="n">action_str</span><span class="p">())</span></div>

<div class="viewcode-block" id="ThriftAPI.table_info"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_info">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shows info about a table.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str): name of the table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">table_str</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">actions</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">action_name</span><span class="p">]</span><span class="o">.</span><span class="n">action_str</span><span class="p">())</span></div>

    <span class="c1"># for debugging</span>
<div class="viewcode-block" id="ThriftAPI.print_set_default"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.print_set_default">[docs]</a>    <span class="k">def</span> <span class="nf">print_set_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting default action of&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:20}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;action:&quot;</span><span class="p">,</span> <span class="n">action_name</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:20}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;runtime data:&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">printable_byte_str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">runtime_data</span><span class="p">)</span>
        <span class="p">))</span></div>

<div class="viewcode-block" id="ThriftAPI.table_set_default"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_set_default">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_set_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">action_params</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Sets default action for a match table.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str)    : name of the table</span>
<span class="sd">            action_name (str)   : name of the default action</span>
<span class="sd">            action_params (list): list of parameters for the default action</span>

<span class="sd">        Note:</span>
<span class="sd">            In ``action_params``, action parameters must be :py:class:`str`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Table </span><span class="si">{}</span><span class="s2"> has no action </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">runtime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_runtime_data</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action_params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">print_set_default</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_set_default_action</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.table_reset_default"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_reset_default">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_reset_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets default entry for a match table.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str): name of the table</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_reset_default_entry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

    <span class="c1"># for debugging</span>
<div class="viewcode-block" id="ThriftAPI.print_table_add"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.print_table_add">[docs]</a>    <span class="k">def</span> <span class="nf">print_table_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match_key</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:20}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;match key:&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">to_str</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">match_key</span><span class="p">)</span>
        <span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:20}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;action:&quot;</span><span class="p">,</span> <span class="n">action_name</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:20}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;runtime data:&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">printable_byte_str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">runtime_data</span><span class="p">)</span>
        <span class="p">))</span></div>

<div class="viewcode-block" id="ThriftAPI.table_num_entries"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_num_entries">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_num_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the number of entries in a match table (direct or indirect).</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str): name of the table</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: the number of entries in a table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_get_num_entries</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.table_clear"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_clear">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears all entries in a match table (direct or indirect), but not the default entry.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str): name of the table</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_clear_entries</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.load_table_to_all_names"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.load_table_to_all_names">[docs]</a>    <span class="k">def</span> <span class="nf">load_table_to_all_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tables</span><span class="p">():</span>
            <span class="c1">#check if short name exists</span>
            <span class="n">short_table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">short_table_name</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">table_name</span><span class="p">,</span> <span class="n">short_table_name</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">table_name</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="ThriftAPI.table_add"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_add">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">,</span> <span class="n">action_params</span><span class="o">=</span><span class="p">[],</span> <span class="n">prio</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds entry to a match table.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str)    : name of the table</span>
<span class="sd">            action_name (str)   : name of the action to execute</span>
<span class="sd">            match_keys (list)   : list of matches in the order they appear in the P4 code</span>
<span class="sd">            action_params (list): list of action parameters in the </span>
<span class="sd">                                  order they appear in the P4 code</span>
<span class="sd">            prio (int)          : priority in ternary matches</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: entry handle.</span>

<span class="sd">        Note:</span>
<span class="sd">            - In ``action_params`` and ``match_keys``, action parameters and match keys</span>
<span class="sd">              must be :py:class:`str`.</span>
<span class="sd">            - A higher ``prio`` number indicates that the entry must be given higher</span>
<span class="sd">              priority when performing a table lookup.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#print table_name, action_name, match_keys, action_params</span>
        <span class="c1">#import ipdb; ipdb.set_trace()</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Table </span><span class="si">{}</span><span class="s2"> has no action </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">match_type</span> <span class="ow">in</span> <span class="p">{</span><span class="n">MatchType</span><span class="o">.</span><span class="n">TERNARY</span><span class="p">,</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">RANGE</span><span class="p">}:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">priority</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prio</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                    <span class="s2">&quot;Table is ternary, but could not extract a valid priority from args&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_keys</span><span class="p">)</span> <span class="o">!=</span> <span class="n">table</span><span class="o">.</span><span class="n">num_key_fields</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Table </span><span class="si">{}</span><span class="s2"> needs </span><span class="si">{}</span><span class="s2"> key fields&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">num_key_fields</span><span class="p">())</span>
            <span class="p">)</span>

        <span class="n">runtime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_runtime_data</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action_params</span><span class="p">)</span>
        <span class="n">match_keys</span> <span class="o">=</span> <span class="n">parse_match_key</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding entry to&quot;</span><span class="p">,</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">match_type</span><span class="p">),</span> <span class="s2">&quot;match table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>

        <span class="c1"># disable, maybe a verbose CLI option?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_table_add</span><span class="p">(</span><span class="n">match_keys</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">)</span>

        <span class="n">entry_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_add_entry</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">,</span>
            <span class="n">BmAddEntryOptions</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1">#save handle</span>
        <span class="c1">#for sub_table_name in self.table_multiple_names[table.name]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry_handle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries_match_to_handle</span><span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">match_keys</span><span class="p">)]</span> <span class="o">=</span> <span class="n">entry_handle</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not add entry with handle </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry_handle</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">entry_handle</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entry has been added with handle&quot;</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">entry_handle</span></div>

<div class="viewcode-block" id="ThriftAPI.table_set_timeout"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_set_timeout">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_set_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a timeout in ms for a given entry; the table has to support timeouts.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str)  : name of the table</span>
<span class="sd">            entry_handle (int): entry handle</span>
<span class="sd">            timeout_ms (int)  : entry timeout in ms        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">table</span><span class="o">.</span><span class="n">support_timeout</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Table </span><span class="si">{}</span><span class="s2"> does not support entry timeouts&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for entry handle&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">timeout_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for timeout&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting a&quot;</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="s2">&quot;ms timeout for entry&quot;</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_set_entry_ttl</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">,</span> <span class="n">timeout_ms</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.get_handle_from_match"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_handle_from_match">[docs]</a>    <span class="k">def</span> <span class="nf">get_handle_from_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">,</span> <span class="n">pop</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="n">match_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">))</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parse_match_key</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">)))</span>
        <span class="n">entry_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_entries_match_to_handle</span><span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entry_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">pop</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_entries_match_to_handle</span><span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">entry_handle</span></div>

<div class="viewcode-block" id="ThriftAPI.table_modify"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_modify">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">,</span> <span class="n">action_params</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Modifies entry of a match table.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str)        : name of the table</span>
<span class="sd">            action_name (str)       : name of the action</span>
<span class="sd">            entry_handle (int)      : entry handle</span>
<span class="sd">            action_params (list)    : list of action parameters in the </span>
<span class="sd">                                      order they appear in the P4 code</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: entry handle.</span>

<span class="sd">        Note:</span>
<span class="sd">            In ``action_params``, action parameters must be :py:class:`str`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Table </span><span class="si">{}</span><span class="s2"> has no action </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for entry handle&quot;</span><span class="p">)</span>

        <span class="n">runtime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_runtime_data</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action_params</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modifying entry&quot;</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">,</span> <span class="s2">&quot;for&quot;</span><span class="p">,</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">match_type</span><span class="p">),</span> <span class="s2">&quot;match table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>

        <span class="c1">#does not return anything</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_modify_entry</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">runtime_data</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">entry_handle</span></div>

<div class="viewcode-block" id="ThriftAPI.table_modify_match"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_modify_match">[docs]</a>    <span class="k">def</span> <span class="nf">table_modify_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">,</span> <span class="n">action_params</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Modifies entry of a match table using match keys.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str)        : name of the table</span>
<span class="sd">            action_name (str)       : name of the action</span>
<span class="sd">            match_keys (list)       : list of matches in the order they appear in the P4 code</span>
<span class="sd">            action_params (list): list of action parameters in the </span>
<span class="sd">                                      order they appear in the P4 code</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: entry handle.</span>

<span class="sd">        Note:</span>
<span class="sd">            In ``action_params``, action parameters must be :py:class:`str`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entry_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_handle_from_match</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entry_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_modify</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">,</span> <span class="n">action_params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Table </span><span class="si">{}</span><span class="s2"> has no match </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">entry_handle</span></div>

<div class="viewcode-block" id="ThriftAPI.table_delete"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_delete">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes entry from a match table.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str)  : name of the table</span>
<span class="sd">            entry_handle (int): entry handle</span>
<span class="sd">            quiet (bool)      : disable verbose output</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#TODO: delete handle</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for entry handle &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry_handle</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleting entry&quot;</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_delete_entry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.table_delete_match"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_delete_match">[docs]</a>    <span class="k">def</span> <span class="nf">table_delete_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes entry from a table using match keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name (str): name of the table</span>
<span class="sd">            match_keys (list): list of matches in the order they appear in the P4 code</span>

<span class="sd">        Note:</span>
<span class="sd">            In ``match_keys``, match keys must be :py:class:`str`.</span>

<span class="sd">        Warning:</span>
<span class="sd">            This may not work with ternary matches and priority entries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entry_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_handle_from_match</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">,</span> <span class="n">pop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;trying to delete entry with handle &quot;</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entry_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_delete</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Table </span><span class="si">{}</span><span class="s2"> has no match </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.check_indirect"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.check_indirect">[docs]</a>    <span class="k">def</span> <span class="nf">check_indirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">type_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="n">TableType</span><span class="o">.</span><span class="n">indirect</span><span class="p">,</span> <span class="n">TableType</span><span class="o">.</span><span class="n">indirect_ws</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Cannot run this command on non-indirect table&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.check_indirect_ws"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.check_indirect_ws">[docs]</a>    <span class="k">def</span> <span class="nf">check_indirect_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">type_</span> <span class="o">!=</span> <span class="n">TableType</span><span class="o">.</span><span class="n">indirect_ws</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Cannot run this command on non-indirect table,&quot;</span>\
                <span class="s2">&quot; or on indirect table with no selector&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.check_act_prof_ws"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.check_act_prof_ws">[docs]</a>    <span class="k">def</span> <span class="nf">check_act_prof_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">with_selection</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Cannot run this command on an action profile without selector&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_create_member"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_create_member">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_create_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">action_params</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Adds a member to an action profile.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str) : name of the action profile</span>
<span class="sd">            action_name (str)   : name of the action</span>
<span class="sd">            action_params (list): list of action parameters in the </span>
<span class="sd">                                  order they appear in the P4 code</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: member handle.      </span>

<span class="sd">        Note:</span>
<span class="sd">            In ``action_params``, action parameters must be :py:class:`str`.   </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Action profile &#39;</span><span class="si">{}</span><span class="s2">&#39; has no action &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">))</span>


        <span class="n">runtime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_runtime_data</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action_params</span><span class="p">)</span>
        <span class="n">mbr_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_add_member</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Member has been created with handle&quot;</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mbr_handle</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_delete_member"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_delete_member">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_delete_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes a member in an action profile.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str): name of the action profile</span>
<span class="sd">            mbr_handle (int)   : member handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mbr_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mbr_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for member handle&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_delete_member</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_modify_member"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_modify_member">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_modify_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">,</span> <span class="n">action_params</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Modifies member in an action profile.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str) : name of the action profile</span>
<span class="sd">            action_name (str)   : name of the action</span>
<span class="sd">            mbr_handle (int)    : member handle</span>
<span class="sd">            action_params (list): list of action parameters in the </span>
<span class="sd">                                  order they appear in the P4 code</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: member handle.</span>

<span class="sd">        Note:</span>
<span class="sd">            In ``action_params``, action parameters must be :py:class:`str`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Action profile &#39;</span><span class="si">{}</span><span class="s2">&#39; has no action &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">mbr_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mbr_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for member handle&quot;</span><span class="p">)</span>

        <span class="n">runtime_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_runtime_data</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_modify_member</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">runtime_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mbr_handle</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_create_group"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_create_group">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a group to an action pofile.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str): name of the action profile</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: group handle.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_act_prof_ws</span><span class="p">(</span><span class="n">act_prof</span><span class="p">)</span>
        <span class="n">grp_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_create_group</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">grp_handle</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_delete_group"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_delete_group">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_delete_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">grp_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete a group from an action profile.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str): name of the action profile</span>
<span class="sd">            grp_handle (int)   : group handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_act_prof_ws</span><span class="p">(</span><span class="n">act_prof</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">grp_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grp_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for group handle&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_delete_group</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">grp_handle</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_add_member_to_group"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_add_member_to_group">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_add_member_to_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">,</span> <span class="n">grp_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds member to group in an action profile.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str): name of the action profile</span>
<span class="sd">            mbr_handle (int)   : member handle</span>
<span class="sd">            grp_handle (int)   : group handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_act_prof_ws</span><span class="p">(</span><span class="n">act_prof</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">mbr_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mbr_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for member handle&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">grp_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grp_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for group handle&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_add_member_to_group</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">,</span> <span class="n">grp_handle</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_remove_member_from_group"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_remove_member_from_group">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_remove_member_from_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">,</span> <span class="n">grp_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes member from group in action profile.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str): name of the action profile</span>
<span class="sd">            mbr_handle (int)   : member handle</span>
<span class="sd">            grp_handle (int)   : group handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_act_prof_ws</span><span class="p">(</span><span class="n">act_prof</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">mbr_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mbr_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for member handle&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">grp_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grp_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for group handle&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_remove_member_from_group</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">,</span> <span class="n">grp_handle</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.check_has_pre"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.check_has_pre">[docs]</a>    <span class="k">def</span> <span class="nf">check_has_pre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_type</span> <span class="o">==</span> <span class="n">PreType</span><span class="o">.</span><span class="n">none</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Cannot execute this command without packet replication engine&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.get_mgrp"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_mgrp">[docs]</a>    <span class="k">def</span> <span class="nf">get_mgrp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for multicast group id&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_mgrp_create"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_mgrp_create">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_mgrp_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates multicast group.</span>

<span class="sd">        Args:</span>
<span class="sd">            mgrp (int): multicast group id</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: multicast group handle.</span>

<span class="sd">        Note:</span>
<span class="sd">            The multicast group handle is equal to the multicast group id.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mgrp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mgrp</span><span class="p">(</span><span class="n">mgrp</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating multicast group&quot;</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">)</span>
        <span class="n">mgrp_hdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_mgrp_create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">mgrp</span> <span class="o">==</span> <span class="n">mgrp_hdl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mgrp_hdl</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_mgrp_destroy"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_mgrp_destroy">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_mgrp_destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Destroys multicast group.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            mgrp (int): multicast group id</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mgrp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mgrp</span><span class="p">(</span><span class="n">mgrp</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Destroying multicast group&quot;</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_mgrp_destroy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.ports_to_port_map_str"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.ports_to_port_map_str">[docs]</a>    <span class="k">def</span> <span class="nf">ports_to_port_map_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;port&quot;</span><span class="p">):</span>
        <span class="n">last_port_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">port_map_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ports_int</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">port_num_str</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">port_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port_num_str</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid </span><span class="si">{}</span><span class="s2"> number&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_num_str</span><span class="p">,</span> <span class="n">description</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">port_num</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid </span><span class="si">{}</span><span class="s2"> number&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_num_str</span><span class="p">,</span> <span class="n">description</span><span class="p">))</span>
            <span class="n">ports_int</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">port_num</span><span class="p">)</span>
        <span class="n">ports_int</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">port_num</span> <span class="ow">in</span> <span class="n">ports_int</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">port_num</span> <span class="o">==</span> <span class="p">(</span><span class="n">last_port_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Found duplicate </span><span class="si">{}</span><span class="s2"> number &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">port_num</span><span class="p">))</span>
            <span class="n">port_map_str</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">port_num</span> <span class="o">-</span> <span class="n">last_port_num</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;1&quot;</span>
            <span class="n">last_port_num</span> <span class="o">=</span> <span class="n">port_num</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">port_map_str</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_node_create"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_node_create">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_node_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">ports</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Creates multicast node.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            rid (int)   : replication id</span>
<span class="sd">            ports (list): list of port numbers</span>
<span class="sd">            lags (list) : list of lags</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: node handle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for rid&quot;</span><span class="p">)</span>
        <span class="n">port_map_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports_to_port_map_str</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="n">lag_map_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports_to_port_map_str</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;lag&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_type</span> <span class="o">==</span> <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePre</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating node with rid&quot;</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="s2">&quot;and with port map&quot;</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">)</span>
            <span class="n">l1_hdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_node_create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating node with rid&quot;</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="s2">&quot;, port map&quot;</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">,</span> <span class="s2">&quot;and lag map&quot;</span><span class="p">,</span> <span class="n">lag_map_str</span><span class="p">)</span>
            <span class="n">l1_hdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_node_create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">,</span> <span class="n">lag_map_str</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node was created with handle&quot;</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">l1_hdl</span></div>

<div class="viewcode-block" id="ThriftAPI.get_node_handle"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_node_handle">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for node handle&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_node_update"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_node_update">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_node_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">,</span> <span class="n">ports</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Updates multicast node.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            l1_hdl (int): node handle</span>
<span class="sd">            ports (list): list of port numbers</span>
<span class="sd">            lags (list) : list of lags</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: node handle.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">l1_hdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_handle</span><span class="p">(</span><span class="n">l1_hdl</span><span class="p">)</span>
        <span class="n">port_map_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports_to_port_map_str</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="n">lag_map_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports_to_port_map_str</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;lag&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_type</span> <span class="o">==</span> <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePre</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating node&quot;</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">,</span> <span class="s2">&quot;with port map&quot;</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_node_update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating node&quot;</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">,</span> <span class="s2">&quot;with port map&quot;</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">,</span> <span class="s2">&quot;and lag map&quot;</span><span class="p">,</span> <span class="n">lag_map_str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_node_update</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">,</span> <span class="n">lag_map_str</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">l1_hdl</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_node_associate"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_node_associate">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_node_associate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Associates node to multicast group.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            mgrp (int)  : multicast group id</span>
<span class="sd">            l1_hdl (int): node handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mgrp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mgrp</span><span class="p">(</span><span class="n">mgrp</span><span class="p">)</span>
        <span class="n">l1_hdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_handle</span><span class="p">(</span><span class="n">l1_hdl</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Associating node&quot;</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">,</span> <span class="s2">&quot;to multicast group&quot;</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_node_associate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_node_dissociate"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_node_dissociate">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_node_dissociate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dissociates node from multicast group.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            mgrp (int)  : multicast group handle</span>
<span class="sd">            l1_hdl (int): node handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mgrp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mgrp</span><span class="p">(</span><span class="n">mgrp</span><span class="p">)</span>
        <span class="n">l1_hdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_handle</span><span class="p">(</span><span class="n">l1_hdl</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dissociating node&quot;</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">,</span> <span class="s2">&quot;from multicast group&quot;</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_node_dissociate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mgrp</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_node_destroy"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_node_destroy">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_node_destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Destroys multicast node.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            l1_hdl (int): node handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">l1_hdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_handle</span><span class="p">(</span><span class="n">l1_hdl</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Destroying node&quot;</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_node_destroy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">l1_hdl</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_set_lag_membership"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_set_lag_membership">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_set_lag_membership</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lag_index</span><span class="p">,</span> <span class="n">ports</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets lag membership of port list.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            lag_index (int): lag index</span>
<span class="sd">            ports (list)   : list of port numbers</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_has_pre</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_type</span> <span class="o">!=</span> <span class="n">PreType</span><span class="o">.</span><span class="n">SimplePreLAG</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Cannot execute this command with this type of PRE,&quot;</span>\
                <span class="s2">&quot; SimplePreLAG is required&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">lag_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lag_index</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for lag index&quot;</span><span class="p">)</span>
        <span class="n">port_map_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports_to_port_map_str</span><span class="p">(</span><span class="n">ports</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;lag&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Setting lag membership:&quot;</span><span class="p">,</span> <span class="n">lag_index</span><span class="p">,</span> <span class="s2">&quot;&lt;-&quot;</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_set_lag_membership</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lag_index</span><span class="p">,</span> <span class="n">port_map_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.mc_dump"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.mc_dump">[docs]</a>    <span class="nd">@handle_bad_input_mc</span>
    <span class="k">def</span> <span class="nf">mc_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dumps entries in multicast engine.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_has_pre</span><span class="p">()</span>
        <span class="n">json_dump</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc_client</span><span class="o">.</span><span class="n">bm_mc_get_entries</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mc_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_dump</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception when retrieving MC entries&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">l1_handles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">mc_json</span><span class="p">[</span><span class="s2">&quot;l1_handles&quot;</span><span class="p">]:</span>
            <span class="n">l1_handles</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;handle&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;rid&quot;</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;l2_handle&quot;</span><span class="p">])</span>
        <span class="n">l2_handles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">mc_json</span><span class="p">[</span><span class="s2">&quot;l2_handles&quot;</span><span class="p">]:</span>
            <span class="n">l2_handles</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;handle&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s2">&quot;ports&quot;</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;lags&quot;</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MC ENTRIES&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mgrp</span> <span class="ow">in</span> <span class="n">mc_json</span><span class="p">[</span><span class="s2">&quot;mgrps&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**********&quot;</span><span class="p">)</span>
            <span class="n">mgid</span> <span class="o">=</span> <span class="n">mgrp</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mgrp(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mgid</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">L1h</span> <span class="ow">in</span> <span class="n">mgrp</span><span class="p">[</span><span class="s2">&quot;l1_handles&quot;</span><span class="p">]:</span>
                <span class="n">rid</span><span class="p">,</span> <span class="n">L2h</span> <span class="o">=</span> <span class="n">l1_handles</span><span class="p">[</span><span class="n">L1h</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  -&gt; (L1h=</span><span class="si">{}</span><span class="s2">, rid=</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">L1h</span><span class="p">,</span> <span class="n">rid</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">ports</span><span class="p">,</span> <span class="n">lags</span> <span class="o">=</span> <span class="n">l2_handles</span><span class="p">[</span><span class="n">L2h</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt; (ports=[</span><span class="si">{}</span><span class="s2">], lags=[</span><span class="si">{}</span><span class="s2">])&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">]),</span>
                    <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lags</span><span class="p">])))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LAGS&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;lags&quot;</span> <span class="ow">in</span> <span class="n">mc_json</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">mc_json</span><span class="p">[</span><span class="s2">&quot;lags&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lag(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lag</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt; ports=[</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;None for this PRE type&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.load_new_config_file"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.load_new_config_file">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">load_new_config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads new JSON config.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            filename (str): path to the P4 compiled JSON file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Not a valid filename&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading new Json config&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json_str</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Not a valid JSON file&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_load_new_config</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_json_str</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.swap_configs"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.swap_configs">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">swap_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Swap the 2 existing configs, need to have called </span>
<span class="sd">        :py:meth:`load_new_config_file` before.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Swapping configs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_swap_configs</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThriftAPI.meter_array_set_rates"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.meter_array_set_rates">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">meter_array_set_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">rates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configures rates for an entire meter array.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            meter_name (str): name of the meter</span>
<span class="sd">            rates (list)    : ``[(cir, cburst), (pir, pburst)]``</span>
<span class="sd">        </span>
<span class="sd">        Note:</span>
<span class="sd">            ``cir`` and ``pir`` use units/second, ``cbursts`` and ``pburst`` use units </span>
<span class="sd">            where units is bytes or packets, depending on the meter type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">meter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;meter&quot;</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">meter_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span> <span class="o">!=</span> <span class="n">meter</span><span class="o">.</span><span class="n">rate_count</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid number of rates, expected </span><span class="si">{}</span><span class="s2"> but got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meter</span><span class="o">.</span><span class="n">rate_count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">new_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rate</span><span class="p">,</span> <span class="n">burst</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
                <span class="n">new_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BmMeterRateConfig</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Error while parsing rates&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_meter_array_set_rates</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">meter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_rates</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.meter_set_rates"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.meter_set_rates">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">meter_set_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">rates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configures rates for a meter.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            meter_name (str): name of the meter</span>
<span class="sd">            index (int)     : index in the array of meters (first element is at ``0``)</span>
<span class="sd">            rates (list)    : ``[(cir, cburst), (pir, pburst)]``</span>
<span class="sd">        </span>
<span class="sd">        Note:</span>
<span class="sd">            ``cir`` and ``pir`` use units/second, ``cbursts`` and ``pburst`` use units </span>
<span class="sd">            where units is bytes or packets, depending on the meter type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">meter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;meter&quot;</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">meter_array</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for index&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span> <span class="o">!=</span> <span class="n">meter</span><span class="o">.</span><span class="n">rate_count</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Invalid number of rates, expected </span><span class="si">{}</span><span class="s2"> but got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meter</span><span class="o">.</span><span class="n">rate_count</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">new_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rate</span><span class="p">,</span> <span class="n">burst</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
                <span class="n">new_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BmMeterRateConfig</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Error while parsing rates&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">meter</span><span class="o">.</span><span class="n">is_direct</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">binding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_set_meter_rates</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">new_rates</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_meter_set_rates</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">meter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">new_rates</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.meter_get_rates"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.meter_get_rates">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">meter_get_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves rates for a meter.</span>

<span class="sd">        Args:</span>
<span class="sd">            meter_name (str): name of the meter</span>
<span class="sd">            index (int)     : index in the array of meters (first element is at ``0``)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            list: ``[(cir, cburst), (pir, pburst)]``.</span>

<span class="sd">        Note:</span>
<span class="sd">            ``cir`` and ``pir`` use units/second, ``cbursts`` and ``pburst`` use units </span>
<span class="sd">            where units is bytes or packets, depending on the meter type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">meter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;meter&quot;</span><span class="p">,</span> <span class="n">meter_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">meter_array</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for index&quot;</span><span class="p">)</span>
        <span class="c1"># meter.rate_count</span>
        <span class="k">if</span> <span class="n">meter</span><span class="o">.</span><span class="n">is_direct</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">binding</span>
            <span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_get_meter_rates</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_meter_get_rates</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">meter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span> <span class="o">!=</span> <span class="n">meter</span><span class="o">.</span><span class="n">rate_count</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: expected&quot;</span><span class="p">,</span> <span class="n">meter</span><span class="o">.</span><span class="n">rate_count</span><span class="p">,</span> <span class="s2">&quot;rates&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;but only received&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">))</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rates</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: info rate = </span><span class="si">{}</span><span class="s2">, burst size = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">idx</span><span class="p">,</span> <span class="n">rate</span><span class="o">.</span><span class="n">units_per_micros</span><span class="p">,</span> <span class="n">rate</span><span class="o">.</span><span class="n">burst_size</span><span class="p">))</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rate</span><span class="o">.</span><span class="n">units_per_micros</span><span class="p">,</span> <span class="n">rate</span><span class="o">.</span><span class="n">burst_size</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="ThriftAPI.counter_read"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.counter_read">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">counter_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads counter value.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            counter_name (str): name of the counter</span>
<span class="sd">            index (int)       : index in the array of counters</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: ``(byte_count, packet_count)`` where:</span>

<span class="sd">            - ``byte_count`` is the number of bytes counted;</span>
<span class="sd">            - ``packet_count`` is the number of bytes counted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;counter&quot;</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">counter_array</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for index&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counter</span><span class="o">.</span><span class="n">is_direct</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">binding</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this is the direct counter for table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
            <span class="c1"># index = index &amp; 0xffffffff</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_read_counter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_counter_read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">counter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">[</span><span class="si">{}</span><span class="s2">]= (</span><span class="si">{}</span><span class="s2"> bytes, </span><span class="si">{}</span><span class="s2"> packets)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">bytes</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">packets</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">bytes</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">packets</span></div>

<div class="viewcode-block" id="ThriftAPI.counter_write"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.counter_write">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">counter_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pkts</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">byts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write counter value.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            counter_name (str): name of the counter</span>
<span class="sd">            index (int)       : index in the array of counters (first element is at ``0``)</span>
<span class="sd">            pkts (int)        : number of packets to write (default: ``0``)</span>
<span class="sd">            byts (int)        : number of bytes to write (default: ``0``)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;counter&quot;</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">counter_array</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for index&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pkts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pkts</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for packets&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">byts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">byts</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for bytes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counter</span><span class="o">.</span><span class="n">is_direct</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">binding</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;writing to direct counter for table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_write_counter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">BmCounterValue</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="n">byts</span><span class="p">,</span> <span class="n">packets</span><span class="o">=</span><span class="n">pkts</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_counter_write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">BmCounterValue</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="n">byts</span><span class="p">,</span> <span class="n">packets</span><span class="o">=</span><span class="n">pkts</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">[</span><span class="si">{}</span><span class="s2">] has been updated&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter_name</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span></div>

<div class="viewcode-block" id="ThriftAPI.counter_reset"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.counter_reset">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">counter_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets counter array.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            counter_name (str): name of the counter</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;counter&quot;</span><span class="p">,</span> <span class="n">counter_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">counter_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counter</span><span class="o">.</span><span class="n">is_direct</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">binding</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this is the direct counter for table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_reset_counters</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_counter_reset_all</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">counter</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.register_read"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.register_read">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">register_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads register value.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            register_name (str): name of the register</span>
<span class="sd">            index (int)        : index in the array of registers (if **None**, the</span>
<span class="sd">                                 whole array will be read)</span>
<span class="sd">            show (bool)        : enable verbose output</span>

<span class="sd">        Returns:</span>
<span class="sd">            int or list: register value or list of values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">register</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="n">register_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">register_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for index&quot;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_register_read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">register</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">[</span><span class="si">{}</span><span class="s2">]=&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_name</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_register_read_all</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">register</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;register index omitted, reading entire array</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register_name</span><span class="p">),</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">entries</span></div>

<div class="viewcode-block" id="ThriftAPI.register_write"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.register_write">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">register_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes register value.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            register_name (str): name of the register</span>
<span class="sd">            index (int or list): index in the array of registers or</span>
<span class="sd">                                 ``[start_index, end_index]``</span>
<span class="sd">            value (int)        : value to write</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">register</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="n">register_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">register_array</span><span class="p">)</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for index&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for value, must be an integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_register_write_range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">register</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_register_write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">register</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.register_reset"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.register_reset">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">register_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets all the cells in the register array to ``0``.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            register_name (str): name of the register</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">register</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="n">register_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">register_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_register_reset</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">register</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.dump_action_and_data"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.dump_action_and_data">[docs]</a>    <span class="k">def</span> <span class="nf">dump_action_and_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">action_data</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Action entry: </span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">action_name</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">hexstr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">action_data</span><span class="p">])))</span></div>

<div class="viewcode-block" id="ThriftAPI.dump_action_entry"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.dump_action_entry">[docs]</a>    <span class="k">def</span> <span class="nf">dump_action_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_entry</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a_entry</span><span class="o">.</span><span class="n">action_type</span> <span class="o">==</span> <span class="n">BmActionEntryType</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EMPTY&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a_entry</span><span class="o">.</span><span class="n">action_type</span> <span class="o">==</span> <span class="n">BmActionEntryType</span><span class="o">.</span><span class="n">ACTION_DATA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_action_and_data</span><span class="p">(</span><span class="n">a_entry</span><span class="o">.</span><span class="n">action_name</span><span class="p">,</span> <span class="n">a_entry</span><span class="o">.</span><span class="n">action_data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a_entry</span><span class="o">.</span><span class="n">action_type</span> <span class="o">==</span> <span class="n">BmActionEntryType</span><span class="o">.</span><span class="n">MBR_HANDLE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index: member(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_entry</span><span class="o">.</span><span class="n">mbr_handle</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">a_entry</span><span class="o">.</span><span class="n">action_type</span> <span class="o">==</span> <span class="n">BmActionEntryType</span><span class="o">.</span><span class="n">GRP_HANDLE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index: group(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_entry</span><span class="o">.</span><span class="n">grp_handle</span><span class="p">))</span></div>

<div class="viewcode-block" id="ThriftAPI.dump_one_member"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.dump_one_member">[docs]</a>    <span class="k">def</span> <span class="nf">dump_one_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">member</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dumping member </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">mbr_handle</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_action_and_data</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">action_name</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">action_data</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.dump_members"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.dump_members">[docs]</a>    <span class="k">def</span> <span class="nf">dump_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">members</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**********&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_one_member</span><span class="p">(</span><span class="n">m</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.dump_one_group"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.dump_one_group">[docs]</a>    <span class="k">def</span> <span class="nf">dump_one_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dumping group </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">grp_handle</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Members: [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">mbr_handles</span><span class="p">])))</span></div>

<div class="viewcode-block" id="ThriftAPI.dump_groups"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.dump_groups">[docs]</a>    <span class="k">def</span> <span class="nf">dump_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**********&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_one_group</span><span class="p">(</span><span class="n">g</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.dump_one_entry"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.dump_one_entry">[docs]</a>    <span class="k">def</span> <span class="nf">dump_one_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
            <span class="n">out_name_w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">]))</span>

        <span class="k">def</span> <span class="nf">dump_exact</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
             <span class="k">return</span> <span class="n">hexstr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exact</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">dump_lpm</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hexstr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lpm</span><span class="o">.</span><span class="n">key</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">lpm</span><span class="o">.</span><span class="n">prefix_length</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">dump_ternary</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &amp;&amp;&amp; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hexstr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ternary</span><span class="o">.</span><span class="n">key</span><span class="p">),</span>
                                      <span class="n">hexstr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ternary</span><span class="o">.</span><span class="n">mask</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">dump_range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> -&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hexstr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">start</span><span class="p">),</span>
                                     <span class="n">hexstr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">end_</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">dump_valid</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;01&quot;</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">key</span> <span class="k">else</span> <span class="s2">&quot;00&quot;</span>
        <span class="n">pdumpers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;exact&quot;</span><span class="p">:</span> <span class="n">dump_exact</span><span class="p">,</span> <span class="s2">&quot;lpm&quot;</span><span class="p">:</span> <span class="n">dump_lpm</span><span class="p">,</span>
                    <span class="s2">&quot;ternary&quot;</span><span class="p">:</span> <span class="n">dump_ternary</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">dump_valid</span><span class="p">,</span>
                    <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="n">dump_range</span><span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dumping entry </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">entry_handle</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Match key:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">match_key</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">pdumper</span> <span class="o">=</span> <span class="n">pdumpers</span><span class="p">[</span><span class="n">MatchType</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span><span class="p">)]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* {0:</span><span class="si">{w}</span><span class="s2">}: </span><span class="si">{1:10}{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                <span class="n">pdumper</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">w</span><span class="o">=</span><span class="n">out_name_w</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">priority</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Priority: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">priority</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_action_entry</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">action_entry</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">life</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Life: </span><span class="si">{}</span><span class="s2">ms since hit, timeout is </span><span class="si">{}</span><span class="s2">ms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">life</span><span class="o">.</span><span class="n">time_since_hit_ms</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">life</span><span class="o">.</span><span class="n">timeout_ms</span><span class="p">))</span></div>

<div class="viewcode-block" id="ThriftAPI.table_dump_entry"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_dump_entry">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_dump_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays some information about a table entry.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str)  : name of the table</span>
<span class="sd">            entry_handle (int): entry handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">entry_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entry_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for entry handle&quot;</span><span class="p">)</span>

        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_get_entry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">entry_handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_one_entry</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_dump_member"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_dump_member">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_dump_member</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays some information about a member.</span>

<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str): name of the action profile</span>
<span class="sd">            mbr_handle (int)   : member handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">mbr_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mbr_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for member handle&quot;</span><span class="p">)</span>

        <span class="n">member</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_get_member</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">mbr_handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_one_member</span><span class="p">(</span><span class="n">member</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.act_prof_dump_group"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_dump_group">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_dump_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span> <span class="n">grp_handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays some information about a group.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str): name of the action profile</span>
<span class="sd">            grp_handle (int)   : group handle</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">grp_handle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grp_handle</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for group handle&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_get_group</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">grp_handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_one_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_dump_act_prof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof</span><span class="p">):</span>
        <span class="n">act_prof_name</span> <span class="o">=</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span>
        <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_get_members</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MEMBERS&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_members</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">with_selection</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_act_prof_get_groups</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">act_prof</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GROUPS&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_groups</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

<div class="viewcode-block" id="ThriftAPI.act_prof_dump"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.act_prof_dump">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">act_prof_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays entries in an action profile.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            act_prof_name (str): name of the action profile</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">act_prof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;action profile&quot;</span><span class="p">,</span> <span class="n">act_prof_name</span><span class="p">,</span>
                                <span class="n">ResType</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dump_act_prof</span><span class="p">(</span><span class="n">act_prof</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThriftAPI.load_table_entries_match_to_handle"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.load_table_entries_match_to_handle">[docs]</a>    <span class="k">def</span> <span class="nf">load_table_entries_match_to_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tables</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="c1">#remove the entries if any</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_entries_match_to_handle</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">switch_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_get_entries</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">switch_entries</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">table_entries_match_to_handle</span><span class="p">[</span><span class="n">table_name</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">match_key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entry_handle</span></div>

<div class="viewcode-block" id="ThriftAPI.table_dump"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_dump">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays entries in a match-table.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str): name of the table</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_get_entries</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TABLE ENTRIES&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;**********&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_one_entry</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">type_</span> <span class="o">==</span> <span class="n">TableType</span><span class="o">.</span><span class="n">indirect</span> <span class="ow">or</span>\
           <span class="n">table</span><span class="o">.</span><span class="n">type_</span> <span class="o">==</span> <span class="n">TableType</span><span class="o">.</span><span class="n">indirect_ws</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">action_prof</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dump_act_prof</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">action_prof</span><span class="p">)</span>

        <span class="c1"># default entry</span>
        <span class="n">default_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_get_default_entry</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dumping default entry&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_action_entry</span><span class="p">(</span><span class="n">default_entry</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.table_dump_entry_from_key"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.table_dump_entry_from_key">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">table_dump_entry_from_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">,</span> <span class="n">prio</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays some information about a table entry using match keys.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            table_name (str) : name of the table</span>
<span class="sd">            match_keys (list): list of matches in the order they appear in the P4 code</span>
<span class="sd">            prio (int)       : priority in ternary match</span>

<span class="sd">        Note:</span>
<span class="sd">            In ``match_keys``, match keys must be :py:class:`str`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">match_type</span> <span class="ow">in</span> <span class="p">{</span><span class="n">MatchType</span><span class="o">.</span><span class="n">TERNARY</span><span class="p">,</span> <span class="n">MatchType</span><span class="o">.</span><span class="n">RANGE</span><span class="p">}:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">priority</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prio</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                    <span class="s2">&quot;Table is ternary, but could not extract a valid priority from args&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_keys</span><span class="p">)</span> <span class="o">!=</span> <span class="n">table</span><span class="o">.</span><span class="n">num_key_fields</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span>
                <span class="s2">&quot;Table </span><span class="si">{}</span><span class="s2"> needs </span><span class="si">{}</span><span class="s2"> key fields&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">num_key_fields</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="n">match_key</span> <span class="o">=</span> <span class="n">parse_match_key</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">match_keys</span><span class="p">)</span>

        <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mt_get_entry_from_key</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">match_key</span><span class="p">,</span> <span class="n">BmAddEntryOptions</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_one_entry</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.show_pvs"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.show_pvs">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">show_pvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lists parser value sets defined in the P4 program.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pvs_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">parse_vsets</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">parse_vsets</span><span class="p">[</span><span class="n">pvs_name</span><span class="p">]</span><span class="o">.</span><span class="n">parse_vset_str</span><span class="p">())</span></div>

<div class="viewcode-block" id="ThriftAPI.pvs_add"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.pvs_add">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">pvs_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a value to a parser value set.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pvs_name (str): name of the parser value set</span>
<span class="sd">            value (int)   : value to add</span>
<span class="sd">        </span>
<span class="sd">        Warning:</span>
<span class="sd">            *BMv2* will not report an error if the value already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;parser value set&quot;</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">parse_vset</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">parse_pvs_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pvs</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_parse_vset_add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.pvs_remove"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.pvs_remove">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">pvs_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a value from a parser value set.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pvs_name (str): name of the parser value set</span>
<span class="sd">            value (int)   : value to remove</span>

<span class="sd">        Warning:</span>
<span class="sd">            *BMv2* will not report an error if the value does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;parser value set&quot;</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">parse_vset</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">parse_pvs_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pvs</span><span class="o">.</span><span class="n">bitwidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_parse_vset_remove</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.pvs_get"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.pvs_get">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">pvs_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves all values from a parser value set.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pvs_name (str): name of the parser value set</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: values of the parser value set</span>
<span class="sd">        </span>
<span class="sd">        Note:</span>
<span class="sd">            Values are displayed in no particular order, one per line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;parser value set&quot;</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">parse_vset</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_parse_vset_get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">hexstr</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="ThriftAPI.pvs_clear"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.pvs_clear">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">pvs_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes all values from a parser value set.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pvs_name (str): name of the parser value set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_res</span><span class="p">(</span><span class="s2">&quot;parser value set&quot;</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">,</span> <span class="n">ResType</span><span class="o">.</span><span class="n">parse_vset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_parse_vset_clear</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pvs_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.port_add"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.port_add">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">port_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface_name</span><span class="p">,</span> <span class="n">port_num</span><span class="p">,</span> <span class="n">pcap_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a port to the switch (behavior depends on device manager used).</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            iface_name (str): interface name</span>
<span class="sd">            port_num (int)  : port number</span>
<span class="sd">            pcap_path (str) : path where the ``.pcap`` files are saved (optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">port_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port_num</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for port_num, must be an integer&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_dev_mgr_add_port</span><span class="p">(</span><span class="n">iface_name</span><span class="p">,</span> <span class="n">port_num</span><span class="p">,</span> <span class="n">pcap_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.port_remove"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.port_remove">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">port_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a port from the switch (behavior depends on device manager used).</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            port_num (int): port number</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">port_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port_num</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_Error</span><span class="p">(</span><span class="s2">&quot;Bad format for port_num, must be an integer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_dev_mgr_remove_port</span><span class="p">(</span><span class="n">port_num</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.show_ports"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.show_ports">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">show_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shows the ports connected to the switch.&quot;&quot;&quot;</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_dev_mgr_show_ports</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:^10}{:^20}{:^10}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;port #&quot;</span><span class="p">,</span> <span class="s2">&quot;iface name&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;extra info&quot;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">port_info</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;UP&quot;</span> <span class="k">if</span> <span class="n">port_info</span><span class="o">.</span><span class="n">is_up</span> <span class="k">else</span> <span class="s2">&quot;DOWN&quot;</span>
            <span class="n">extra_info</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">port_info</span><span class="o">.</span><span class="n">extra</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:^10}{:^20}{:^10}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">port_info</span><span class="o">.</span><span class="n">port_num</span><span class="p">,</span> <span class="n">port_info</span><span class="o">.</span><span class="n">iface_name</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">extra_info</span><span class="p">))</span></div>

<div class="viewcode-block" id="ThriftAPI.switch_info"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.switch_info">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">switch_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shows some basic info about the switch.&quot;&quot;&quot;</span>

        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_mgmt_get_info</span><span class="p">()</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">thrift_spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
        <span class="n">out_attr_w</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;{:</span><span class="si">{w}</span><span class="s2">}: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">w</span><span class="o">=</span><span class="n">out_attr_w</span><span class="p">))</span></div>

<div class="viewcode-block" id="ThriftAPI.reset_state"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.reset_state">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">reset_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets all state in the switch (table entries, registers, ...), but P4 config is preserved.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_reset_state</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThriftAPI.write_config_to_file"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.write_config_to_file">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">write_config_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves the JSON config currently used by the switch and dumps it to user-specified file.&quot;&quot;&quot;</span>

        <span class="n">json_cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_get_config</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_cfg</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.serialize_state"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.serialize_state">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">serialize_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serializes the switch state and dumps it to user-specified file.&quot;&quot;&quot;</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_serialize_state</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.set_crc_parameters_common"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.set_crc_parameters_common">[docs]</a>    <span class="k">def</span> <span class="nf">set_crc_parameters_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">polynomial</span><span class="p">,</span> <span class="n">initial_remainder</span><span class="p">,</span> <span class="n">final_xor_value</span><span class="p">,</span> <span class="n">reflect_data</span><span class="p">,</span> <span class="n">reflect_remainder</span><span class="p">,</span> <span class="n">crc_width</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
        <span class="n">conversion_fn</span> <span class="o">=</span> <span class="p">{</span><span class="mi">16</span><span class="p">:</span> <span class="n">hex_to_i16</span><span class="p">,</span> <span class="mi">32</span><span class="p">:</span> <span class="n">hex_to_i32</span><span class="p">}[</span><span class="n">crc_width</span><span class="p">]</span>
        <span class="n">config_type</span> <span class="o">=</span> <span class="p">{</span><span class="mi">16</span><span class="p">:</span> <span class="n">BmCrc16Config</span><span class="p">,</span> <span class="mi">32</span><span class="p">:</span> <span class="n">BmCrc32Config</span><span class="p">}[</span><span class="n">crc_width</span><span class="p">]</span>
        <span class="n">thrift_fn</span> <span class="o">=</span> <span class="p">{</span><span class="mi">16</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_set_crc16_custom_parameters</span><span class="p">,</span>
                     <span class="mi">32</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">bm_set_crc32_custom_parameters</span><span class="p">}[</span><span class="n">crc_width</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">custom_crc_calcs</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">custom_crc_calcs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">crc_width</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UIn_ResourceError</span><span class="p">(</span><span class="s2">&quot;crc</span><span class="si">{}</span><span class="s2">_custom&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">crc_width</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">config_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">conversion_fn</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="n">polynomial</span><span class="p">,</span> <span class="n">initial_remainder</span><span class="p">,</span> <span class="n">final_xor_value</span><span class="p">]]</span>
        <span class="n">config_args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">parse_bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="n">reflect_data</span><span class="p">,</span> <span class="n">reflect_remainder</span><span class="p">]]</span>
        <span class="n">crc_config</span> <span class="o">=</span> <span class="n">config_type</span><span class="p">(</span><span class="o">*</span><span class="n">config_args</span><span class="p">)</span>
        <span class="n">thrift_fn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">crc_config</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.set_crc16_parameters"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.set_crc16_parameters">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">set_crc16_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">polynomial</span><span class="p">,</span> <span class="n">initial_remainder</span><span class="p">,</span> <span class="n">final_xor_value</span><span class="p">,</span> <span class="n">reflect_data</span><span class="p">,</span> <span class="n">reflect_remainder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes the parameters for a custom ``crc16`` hash.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            name (str)              : hash name</span>
<span class="sd">            polynomial (int)        : polynomial</span>
<span class="sd">            intial_remainder (int)  : initial reminder</span>
<span class="sd">            final_xor_value  (int)  : final *xor* value</span>
<span class="sd">            reflect_data (bool)     : reflect data or do not</span>
<span class="sd">            reflect_remainder (bool): reflect remainder or do not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_crc_parameters_common</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">polynomial</span><span class="p">,</span> <span class="n">initial_remainder</span><span class="p">,</span> <span class="n">final_xor_value</span><span class="p">,</span> <span class="n">reflect_data</span><span class="p">,</span> <span class="n">reflect_remainder</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThriftAPI.set_crc32_parameters"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.set_crc32_parameters">[docs]</a>    <span class="nd">@handle_bad_input</span>
    <span class="k">def</span> <span class="nf">set_crc32_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">polynomial</span><span class="p">,</span> <span class="n">initial_remainder</span><span class="p">,</span> <span class="n">final_xor_value</span><span class="p">,</span> <span class="n">reflect_data</span><span class="p">,</span> <span class="n">reflect_remainder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes the parameters for a custom ``crc32`` hash.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            name (str)              : name</span>
<span class="sd">            polynomial (int)        : polynomial</span>
<span class="sd">            intial_remainder (int)  : initial reminder</span>
<span class="sd">            final_xor_value  (int)  : final *xor* value</span>
<span class="sd">            reflect_data (bool)     : reflect data or do not</span>
<span class="sd">            reflect_remainder (bool): reflect remainder or do not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_crc_parameters_common</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">polynomial</span><span class="p">,</span> <span class="n">initial_remainder</span><span class="p">,</span> <span class="n">final_xor_value</span><span class="p">,</span> <span class="n">reflect_data</span><span class="p">,</span> <span class="n">reflect_remainder</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span></div>


    <span class="c1">#Global Variable Getters</span>
<div class="viewcode-block" id="ThriftAPI.get_tables"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_tables">[docs]</a>    <span class="k">def</span> <span class="nf">get_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">tables</span></div>

<div class="viewcode-block" id="ThriftAPI.get_action_profs"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_action_profs">[docs]</a>    <span class="k">def</span> <span class="nf">get_action_profs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">action_profs</span></div>

<div class="viewcode-block" id="ThriftAPI.get_actions"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_actions">[docs]</a>    <span class="k">def</span> <span class="nf">get_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">actions</span></div>

<div class="viewcode-block" id="ThriftAPI.get_meter_arrays"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_meter_arrays">[docs]</a>    <span class="k">def</span> <span class="nf">get_meter_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">meter_arrays</span></div>

<div class="viewcode-block" id="ThriftAPI.get_counter_arrays"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_counter_arrays">[docs]</a>    <span class="k">def</span> <span class="nf">get_counter_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">counter_arrays</span></div>

<div class="viewcode-block" id="ThriftAPI.get_register_arrays"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_register_arrays">[docs]</a>    <span class="k">def</span> <span class="nf">get_register_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">register_arrays</span></div>

<div class="viewcode-block" id="ThriftAPI.get_custom_crc_calcs"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_custom_crc_calcs">[docs]</a>    <span class="k">def</span> <span class="nf">get_custom_crc_calcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">custom_crc_calcs</span></div>

<div class="viewcode-block" id="ThriftAPI.get_parse_vsets"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_parse_vsets">[docs]</a>    <span class="k">def</span> <span class="nf">get_parse_vsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">parse_vsets</span></div>

<div class="viewcode-block" id="ThriftAPI.get_suffix_lookup_map"><a class="viewcode-back" href="../../../p4utils.utils.thrift_API.html#p4utils.utils.thrift_API.ThriftAPI.get_suffix_lookup_map">[docs]</a>    <span class="k">def</span> <span class="nf">get_suffix_lookup_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_info</span><span class="o">.</span><span class="n">suffix_lookup_map</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Networked Systems Group (NSG@ETH).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>