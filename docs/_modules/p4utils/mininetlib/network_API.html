

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>p4utils.mininetlib.network_API &mdash; P4-Utils 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'1.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> P4-Utils
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">p4utils</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">P4-Utils</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>p4utils.mininetlib.network_API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for p4utils.mininetlib.network_API</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">ipaddress</span> <span class="kn">import</span> <span class="n">ip_interface</span><span class="p">,</span> <span class="n">IPv4Network</span>
<span class="kn">from</span> <span class="nn">networkx</span> <span class="kn">import</span> <span class="n">MultiGraph</span>
<span class="kn">from</span> <span class="nn">networkx.readwrite.json_graph</span> <span class="kn">import</span> <span class="n">node_link_data</span>
<span class="kn">from</span> <span class="nn">mininet.link</span> <span class="kn">import</span> <span class="n">TCLink</span>
<span class="kn">from</span> <span class="nn">mininet.nodelib</span> <span class="kn">import</span> <span class="n">LinuxBridge</span>
<span class="kn">from</span> <span class="nn">mininet.topo</span> <span class="kn">import</span> <span class="n">Topo</span>
<span class="kn">from</span> <span class="nn">mininet.log</span> <span class="kn">import</span> <span class="n">setLogLevel</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">warning</span><span class="p">,</span> <span class="n">error</span>
<span class="kn">from</span> <span class="nn">mininet.clean</span> <span class="kn">import</span> <span class="n">cleanup</span><span class="p">,</span> <span class="n">sh</span>

<span class="kn">from</span> <span class="nn">p4utils.utils.helper</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">p4utils.utils.helper</span> <span class="kn">import</span> <span class="n">_prefixLenMatchRegex</span>
<span class="kn">from</span> <span class="nn">p4utils.utils.client</span> <span class="kn">import</span> <span class="n">ThriftClient</span>
<span class="kn">from</span> <span class="nn">p4utils.utils.compiler</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">p4utils.utils.topology</span> <span class="kn">import</span> <span class="n">NetworkGraph</span>
<span class="kn">from</span> <span class="nn">p4utils.mininetlib.node</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">p4utils.mininetlib.net</span> <span class="kn">import</span> <span class="n">P4Mininet</span>
<span class="kn">from</span> <span class="nn">p4utils.mininetlib.cli</span> <span class="kn">import</span> <span class="n">P4CLI</span>
<span class="kn">from</span> <span class="nn">p4utils.utils.task_scheduler</span> <span class="kn">import</span> <span class="n">TaskClient</span>


<div class="viewcode-block" id="NetworkAPI"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI">[docs]</a><span class="k">class</span> <span class="nc">NetworkAPI</span><span class="p">(</span><span class="n">Topo</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Network definition and initialization API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="c1"># Init superclass</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="c1"># Set log level</span>
        <span class="n">setLogLevel</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
        <span class="c1"># Name of the CPU bridge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_bridge</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Whether to enable the client or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Topology data file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topoFile</span> <span class="o">=</span> <span class="s1">&#39;./topology.json&#39;</span>
        <span class="c1"># IP default generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipv4_net</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;10.0.0.0/8&#39;</span><span class="p">)</span>
        <span class="c1"># Gateway static ARP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_gw_arp</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Static ARP entries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_arp_tables</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># List of scripts to execute in</span>
        <span class="c1"># the main namespace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Dictionary of scheduled tasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">## External modules default configuration dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Network module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;net&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;net&#39;</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P4Mininet</span>
        <span class="c1"># Default kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;net&#39;</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Network is instantiated in self.startNetwork</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># Compiler module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P4C</span>
        <span class="c1"># Default kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># List of compilers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Switch client module</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;sw_cli&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;sw_cli&#39;</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ThriftClient</span>
        <span class="c1"># Default kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;sw_cli&#39;</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                              <span class="s1">&#39;log_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;./log&#39;</span>
                                           <span class="p">}</span>
        <span class="c1"># List of switch clients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sw_clients</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">### Utils</span>
<div class="viewcode-block" id="NetworkAPI.cleanup"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes old Mininet files and processes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Mininet cleanup</span>
        <span class="n">cleanup</span><span class="p">()</span>
        <span class="n">bridges</span> <span class="o">=</span> <span class="n">sh</span><span class="p">(</span><span class="s2">&quot;brctl show | awk &#39;FNR &gt; 1 {print $1}&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">bridge</span> <span class="ow">in</span> <span class="n">bridges</span><span class="p">:</span>
            <span class="n">sh</span><span class="p">(</span><span class="s2">&quot;ifconfig </span><span class="si">{}</span><span class="s2"> down&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bridge</span><span class="p">))</span>
            <span class="n">sh</span><span class="p">(</span><span class="s2">&quot;brctl delbr </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bridge</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.is_multigraph"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.is_multigraph">[docs]</a>    <span class="k">def</span> <span class="nf">is_multigraph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether the graph is a multigraph, i.e. it has multiple parallel</span>
<span class="sd">        links.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">multigraph</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">areNeighbors</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_linkEntry</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">multigraph</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
        <span class="k">return</span> <span class="n">multigraph</span></div>

<div class="viewcode-block" id="NetworkAPI.save_topology"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.save_topology">[docs]</a>    <span class="k">def</span> <span class="nf">save_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves mininet topology to a JSON file.</span>

<span class="sd">        Notice that multigraphs are not supported yet by p4utils.utils.Topology</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This function return None for each not serializable</span>
        <span class="c1"># obect so that no TypeError is thrown.</span>
        <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving mininet topology to database: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topoFile</span><span class="p">))</span>

        <span class="c1"># Check whether the graph is a multigraph or not</span>
        <span class="n">multigraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multigraph</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">multigraph</span><span class="p">:</span>
            <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Multigraph topology selected.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">MultiGraph</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Simple graph topology selected.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">NetworkGraph</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                
                <span class="n">node1</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">]</span>
                <span class="n">node2</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">]</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="n">node1</span><span class="p">][</span><span class="n">node2</span><span class="p">]</span>
                <span class="n">params1</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;params1&#39;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">params2</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;params2&#39;</span><span class="p">,</span> <span class="p">{})</span>

                <span class="c1"># Move outside parameters in subdictionaries</span>
                <span class="c1"># and append number to identify them.</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params1</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">edge</span><span class="p">[</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params2</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">edge</span><span class="p">[</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                <span class="c1"># Fake switches&#39; IPs</span>
                <span class="k">if</span> <span class="s1">&#39;sw_ip1&#39;</span> <span class="ow">in</span> <span class="n">edge</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;ip1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;sw_ip1&#39;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;sw_ip1&#39;</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="s1">&#39;sw_ip2&#39;</span> <span class="ow">in</span> <span class="n">edge</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;ip2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;sw_ip2&#39;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;sw_ip2&#39;</span><span class="p">]</span>

                <span class="c1"># Get addresses from the network</span>
                <span class="c1"># This gathers also routers interfaces IPs!</span>
                <span class="n">port1</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;port1&#39;</span><span class="p">]</span>
                <span class="n">intf1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">intfs</span><span class="p">[</span><span class="n">port1</span><span class="p">]</span>
                <span class="n">ip1</span><span class="p">,</span> <span class="n">addr1</span> <span class="o">=</span> <span class="n">intf1</span><span class="o">.</span><span class="n">updateAddr</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ip1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">subnet1</span> <span class="o">=</span> <span class="n">_prefixLenMatchRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">intf1</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">ip1</span> <span class="o">=</span> <span class="n">ip_interface</span><span class="p">(</span><span class="n">ip1</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">subnet1</span><span class="p">)</span><span class="o">.</span><span class="n">with_prefixlen</span>
                <span class="n">edge</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ip1</span><span class="o">=</span><span class="n">ip1</span><span class="p">,</span> <span class="n">addr1</span><span class="o">=</span><span class="n">addr1</span><span class="p">)</span>

                <span class="n">port2</span> <span class="o">=</span> <span class="n">edge</span><span class="p">[</span><span class="s1">&#39;port2&#39;</span><span class="p">]</span>
                <span class="n">intf2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span><span class="o">.</span><span class="n">intfs</span><span class="p">[</span><span class="n">port2</span><span class="p">]</span>
                <span class="n">ip2</span><span class="p">,</span> <span class="n">addr2</span> <span class="o">=</span>  <span class="n">intf2</span><span class="o">.</span><span class="n">updateAddr</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ip2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">subnet2</span> <span class="o">=</span> <span class="n">_prefixLenMatchRegex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">intf2</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">ip2</span> <span class="o">=</span> <span class="n">ip_interface</span><span class="p">(</span><span class="n">ip2</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">subnet2</span><span class="p">)</span><span class="o">.</span><span class="n">with_prefixlen</span>
                <span class="n">edge</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ip2</span><span class="o">=</span><span class="n">ip2</span><span class="p">,</span> <span class="n">addr2</span><span class="o">=</span><span class="n">addr2</span><span class="p">)</span>

        <span class="n">graph_dict</span> <span class="o">=</span> <span class="n">node_link_data</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topoFile</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">graph_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.compile"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compile all the required P4 files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">p4switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
            <span class="n">p4_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">p4switch</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;p4_src&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p4_src</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_compiled</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">p4_src</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">):</span>
                    <span class="n">compiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="n">p4_src</span><span class="p">)</span>
                    <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compiler</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">compiler</span> <span class="o">=</span> <span class="n">get_by_attr</span><span class="p">(</span><span class="s1">&#39;p4_src&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">p4_src</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">compilers</span><span class="p">)</span>
                <span class="c1"># Retrieve json_path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">p4switch</span><span class="p">,</span> <span class="n">json_path</span><span class="o">=</span><span class="n">compiler</span><span class="o">.</span><span class="n">get_json_out</span><span class="p">())</span>
                <span class="c1"># Try to retrieve p4 runtime info file path</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">p4switch</span><span class="p">,</span> <span class="n">p4rt_path</span><span class="o">=</span><span class="n">compiler</span><span class="o">.</span><span class="n">get_p4rt_out</span><span class="p">())</span>
                <span class="k">except</span> <span class="n">P4InfoDisabled</span><span class="p">:</span>
                    <span class="k">pass</span></div>

<div class="viewcode-block" id="NetworkAPI.program_switches"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.program_switches">[docs]</a>    <span class="k">def</span> <span class="nf">program_switches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If any command files were provided for the switches, this method will start up the</span>
<span class="sd">        CLI on each switch and use the contents of the command files as input.</span>

<span class="sd">        Assumes:</span>
<span class="sd">            A mininet instance is stored as self.net.</span>
<span class="sd">            self.net.start() has been called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">p4switch</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">cli_input</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cli_input&#39;</span><span class="p">)</span>
            <span class="n">thrift_port</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thrift_port&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cli_input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sw_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">&#39;sw_cli&#39;</span><span class="p">,</span> <span class="n">thrift_port</span><span class="p">,</span> <span class="n">p4switch</span><span class="p">,</span> <span class="n">cli_input</span><span class="o">=</span><span class="n">cli_input</span><span class="p">)</span>
                <span class="n">sw_client</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sw_clients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sw_client</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.program_hosts"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.program_hosts">[docs]</a>    <span class="k">def</span> <span class="nf">program_hosts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds static and default routes ARP entries to each mininet host.</span>
<span class="sd">        Multihomed hosts are allowed.</span>

<span class="sd">        Assumes:</span>
<span class="sd">            Only switches and hosts are allowed.</span>
<span class="sd">            No duplicated IP addresses exist in the Network (e.g. no NAT allowed</span>
<span class="sd">            for the same subnet).</span>
<span class="sd">            A mininet instance is stored as self.net.</span>
<span class="sd">            self.net.start() has been called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">host1</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1"># Get mininet node</span>
            <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">host1</span><span class="p">)</span>
            <span class="c1"># Set gateway static ARP</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_gw_arp</span><span class="p">:</span>
                <span class="c1"># If there is gateway assigned</span>
                <span class="k">if</span> <span class="s1">&#39;defaultRoute&#39;</span> <span class="ow">in</span> <span class="n">h1</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                    <span class="c1"># Get gateway IP</span>
                    <span class="n">gw_ip</span> <span class="o">=</span> <span class="n">h1</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;defaultRoute&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">host1</span> <span class="o">==</span> <span class="n">node</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                        <span class="c1"># If it is a switch, handle fake IPs</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">intfs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                                <span class="c1"># Skip loopback interface</span>
                                <span class="k">if</span> <span class="n">intf</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lo&#39;</span><span class="p">:</span>
                                    <span class="k">continue</span>
                                <span class="c1"># Get link from interface</span>
                                <span class="n">link</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">link</span>
                                <span class="c1"># Get fake IP</span>
                                <span class="n">n_ip</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sw_ip1&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">intf</span> <span class="o">==</span> <span class="n">link</span><span class="o">.</span><span class="n">intf1</span> <span class="k">else</span> <span class="n">intf</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sw_ip2&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">n_ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">n_ip</span> <span class="o">=</span> <span class="n">n_ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="c1"># Check if the IPs match and set ARP</span>
                                    <span class="k">if</span> <span class="n">n_ip</span> <span class="o">==</span> <span class="n">gw_ip</span><span class="p">:</span>
                                        <span class="n">h1</span><span class="o">.</span><span class="n">setARP</span><span class="p">(</span><span class="n">gw_ip</span><span class="p">,</span> <span class="n">intf</span><span class="o">.</span><span class="n">mac</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">intf</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">intfs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                                <span class="c1"># Skip loopback interface</span>
                                <span class="k">if</span> <span class="n">intf</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lo&#39;</span><span class="p">:</span>
                                    <span class="k">continue</span>
                                <span class="n">n_ip</span> <span class="o">=</span> <span class="n">intf</span><span class="o">.</span><span class="n">ip</span>
                                <span class="k">if</span> <span class="n">n_ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">n_ip</span> <span class="o">=</span> <span class="n">n_ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="c1"># Check if the IPs match and set ARP</span>
                                    <span class="k">if</span> <span class="n">n_ip</span> <span class="o">==</span> <span class="n">gw_ip</span><span class="p">:</span>
                                        <span class="n">h1</span><span class="o">.</span><span class="n">setARP</span><span class="p">(</span><span class="n">gw_ip</span><span class="p">,</span> <span class="n">intf</span><span class="o">.</span><span class="n">mac</span><span class="p">)</span>
            
            <span class="c1"># Set static ARP entries</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_arp_tables</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">intf1</span> <span class="ow">in</span> <span class="n">h1</span><span class="o">.</span><span class="n">intfs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="c1"># Skip loopback interface</span>
                    <span class="k">if</span> <span class="n">intf1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lo&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="c1"># Set arp rules for all the hosts in the same subnet</span>
                    <span class="n">h1_intf_ip</span> <span class="o">=</span> <span class="n">ip_interface</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intf1</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">intf1</span><span class="o">.</span><span class="n">prefixLen</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">host2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">host1</span> <span class="o">==</span> <span class="n">host2</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">host2</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">intf2</span> <span class="ow">in</span> <span class="n">h2</span><span class="o">.</span><span class="n">intfs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                            <span class="c1"># Skip loopback interface</span>
                            <span class="k">if</span> <span class="n">intf2</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lo&#39;</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="c1"># Get the other interface&#39;s IP</span>
                            <span class="n">h2_intf_ip</span> <span class="o">=</span> <span class="n">ip_interface</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intf2</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">intf2</span><span class="o">.</span><span class="n">prefixLen</span><span class="p">))</span>
                            <span class="c1"># Check if the subnet is the same</span>
                            <span class="k">if</span> <span class="n">h1_intf_ip</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">compressed</span> <span class="o">==</span> <span class="n">h2_intf_ip</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">compressed</span><span class="p">:</span>
                                <span class="n">h1</span><span class="o">.</span><span class="n">setARP</span><span class="p">(</span><span class="n">intf2</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">intf2</span><span class="o">.</span><span class="n">mac</span><span class="p">)</span>

            <span class="c1"># Set DHCP autoconfiguration</span>
            <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dhcp&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">intf1</span> <span class="ow">in</span> <span class="n">h1</span><span class="o">.</span><span class="n">intfs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="c1"># Skip loopback interface</span>
                    <span class="k">if</span> <span class="n">intf1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lo&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">h1</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;dhclient -r </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intf1</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="n">h1</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;dhclient </span><span class="si">{}</span><span class="s1"> &amp;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intf1</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.exec_scripts"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.exec_scripts">[docs]</a>    <span class="k">def</span> <span class="nf">exec_scripts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the scripts in the main namespace after network boot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">:</span>
            <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Exec Script: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">script</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]))</span>
            <span class="n">run_command</span><span class="p">(</span><span class="n">script</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="NetworkAPI.start_scheduler"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.start_scheduler">[docs]</a>    <span class="k">def</span> <span class="nf">start_scheduler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the task scheduler on node if enabled.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): name of the node</span>

<span class="sd">        Assumes:</span>
<span class="sd">            A mininet instance is stored as self.net.</span>
<span class="sd">            self.net.start() has been called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasScheduler</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">unix_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unix_path&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp&#39;</span><span class="p">)</span>
            <span class="n">unix_socket</span> <span class="o">=</span> <span class="n">unix_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">node</span> <span class="o">+</span> <span class="s1">&#39;_socket&#39;</span>
            <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Node </span><span class="si">{}</span><span class="s1"> task scheduler listens on </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">unix_socket</span><span class="p">))</span>
            <span class="n">node_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">log_enabled</span> <span class="o">=</span> <span class="n">node_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_enabled&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">log_dir</span> <span class="o">=</span> <span class="n">node_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_dir&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log_enabled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;python3 -u -m p4utils.utils.task_scheduler &quot;</span><span class="si">{}</span><span class="s1">&quot; &gt; &quot;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_scheduler.log&quot; 2&gt;&amp;1 &amp;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unix_socket</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;python3 -u -m p4utils.utils.task_scheduler &quot;</span><span class="si">{}</span><span class="s1">&quot; &gt; /dev/null 2&gt;&amp;1 &amp;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unix_socket</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.start_schedulers"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.start_schedulers">[docs]</a>    <span class="k">def</span> <span class="nf">start_schedulers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start all the required task schedulers.</span>

<span class="sd">        Assumes:</span>
<span class="sd">            A mininet instance is stored as self.net.</span>
<span class="sd">            self.net.start() has been called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasScheduler</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_scheduler</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Remove node if it has no scheduler</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.distribute_tasks"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.distribute_tasks">[docs]</a>    <span class="k">def</span> <span class="nf">distribute_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Distribute all the tasks to the schedulers.</span>

<span class="sd">        Assumes:</span>
<span class="sd">            All the nodes in self.tasks have an active scheduler.</span>
<span class="sd">            A mininet instance is stored as self.net.</span>
<span class="sd">            self.net.start() has been called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get current time</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">tasks</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Update start with current time</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                <span class="n">task</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">current_time</span>
            <span class="n">unix_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unix_path&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp&#39;</span><span class="p">)</span>
            <span class="n">unix_socket</span> <span class="o">=</span> <span class="n">unix_path</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">node</span> <span class="o">+</span> <span class="s1">&#39;_socket&#39;</span>
            <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Tasks for node </span><span class="si">{}</span><span class="s1"> distributed to socket </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">unix_socket</span><span class="p">))</span>
            <span class="n">task_client</span> <span class="o">=</span> <span class="n">TaskClient</span><span class="p">(</span><span class="n">unix_socket</span><span class="p">)</span>
            <span class="n">task_client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Remove all the tasks once they are sent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="NetworkAPI.start_net_cli"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.start_net_cli">[docs]</a>    <span class="k">def</span> <span class="nf">start_net_cli</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts up the mininet CLI and prints some helpful output.</span>

<span class="sd">        Assumes:</span>
<span class="sd">            A mininet instance is stored as self.net.</span>
<span class="sd">            self.net.start() has been called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">switches</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">switch</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">switch</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
            <span class="n">host</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
        <span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting mininet CLI...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Generate a message that will be printed by the Mininet CLI to make</span>
        <span class="c1"># interacting with the simple switch a little easier.</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;======================================================================</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Welcome to the P4 Utils Mininet CLI!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;======================================================================</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Your P4 program is installed into the BMV2 software switch</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;and your initial configuration is loaded. You can interact</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;with the network using the mininet CLI below.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;To inspect or change the switch configuration, connect to</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;its CLI from your host operating system using this command:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{}</span><span class="s1"> --thrift-port &lt;switch thrift port&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ThriftClient</span><span class="o">.</span><span class="n">cli_bin</span><span class="p">))</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;To view a switch log, run this command from your host OS:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;  tail -f &lt;log_dir&gt;/&lt;switchname&gt;.log</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;By default log directory is &quot;./log&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;To view the switch output pcap, check the pcap files in &lt;pcap_dir&gt;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;  for example run:  sudo tcpdump -xxx -r s1-eth1.pcap</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;By default pcap directory is &quot;./pcap&quot;.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">P4CLI</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.module"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.module">[docs]</a>    <span class="k">def</span> <span class="nf">module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod_name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create object from external modules configurations.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            mod_name (string): module name (possible values are</span>
<span class="sd">                               &#39;topo&#39;, &#39;comp&#39;, &#39;net&#39;, &#39;sw_cli&#39;)</span>
<span class="sd">            args             : positional arguments to pass to the object</span>
<span class="sd">            kwargs           : keyword arguments to pass to the object in addition to</span>
<span class="sd">                               the default ones</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            configured instance of the class of the module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">mod_name</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
        <span class="n">default_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">mod_name</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">default_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">default_class</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.node_ports"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.node_ports">[docs]</a>    <span class="k">def</span> <span class="nf">node_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a dictionary from the links and store the ports</span>
<span class="sd">        of every node and its destination node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withKeys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">],</span> <span class="p">{})</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">],</span> <span class="p">{})</span>
            <span class="n">port1</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ports</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">port1</span> <span class="p">:</span> <span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">],</span> <span class="n">key</span><span class="p">)})</span>
            <span class="n">port2</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ports</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">port2</span> <span class="p">:</span> <span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">],</span> <span class="n">key</span><span class="p">)})</span>
        <span class="k">return</span> <span class="n">ports</span></div>

<div class="viewcode-block" id="NetworkAPI.node_intfs"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.node_intfs">[docs]</a>    <span class="k">def</span> <span class="nf">node_intfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a dictionary from the links and store the interfaces</span>
<span class="sd">        of every node and its destination node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withKeys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">],</span> <span class="p">{})</span>
            <span class="n">ports</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">],</span> <span class="p">{})</span>
            <span class="n">intfName1</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;intfName1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">intfName1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ports</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">intfName1</span> <span class="p">:</span> <span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">],</span> <span class="n">key</span><span class="p">)})</span>
            <span class="n">intfName2</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;intfName2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">intfName2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ports</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">intfName2</span> <span class="p">:</span> <span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">],</span> <span class="n">key</span><span class="p">)})</span>     
        <span class="k">return</span> <span class="n">ports</span></div>

<div class="viewcode-block" id="NetworkAPI.switch_ids"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.switch_ids">[docs]</a>    <span class="k">def</span> <span class="nf">switch_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a set containing all the switch IDs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">switch</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switches</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">switch</span><span class="p">):</span>
                <span class="n">device_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">device_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dpid</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dpid&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dpid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">ids</span></div>

<div class="viewcode-block" id="NetworkAPI.thrift_ports"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.thrift_ports">[docs]</a>    <span class="k">def</span> <span class="nf">thrift_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a set containing all the switches&#39; thrift ports.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thrift_ports</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">switch</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">thrift_port</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thrift_port&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">thrift_port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">thrift_ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">thrift_port</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">thrift_ports</span></div>

<div class="viewcode-block" id="NetworkAPI.grpc_ports"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.grpc_ports">[docs]</a>    <span class="k">def</span> <span class="nf">grpc_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a set containing all the switches&#39; grpc ports.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grpc_ports</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">switch</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4rtswitches</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">grpc_port</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grpc_port&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">grpc_port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">grpc_ports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">grpc_port</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">grpc_ports</span></div>

<div class="viewcode-block" id="NetworkAPI.mac_addresses"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.mac_addresses">[docs]</a>    <span class="k">def</span> <span class="nf">mac_addresses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a set containing all the MAC addresses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">macs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">mac1</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;addr1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mac1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">macs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mac1</span><span class="p">)</span>
            <span class="n">mac2</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;addr2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mac2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">macs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mac2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">macs</span></div>

<div class="viewcode-block" id="NetworkAPI.ip_addresses"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.ip_addresses">[docs]</a>    <span class="k">def</span> <span class="nf">ip_addresses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a set containing all the IPv4 addresses of L3 nodes,</span>
<span class="sd">        i.e. of all non-switch nodes. The fake IPs assigned to the</span>
<span class="sd">        switches are not considered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params1&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ip</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params2&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ip</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ips</span></div>

<div class="viewcode-block" id="NetworkAPI.check_host_valid_ip_from_name"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.check_host_valid_ip_from_name">[docs]</a>    <span class="k">def</span> <span class="nf">check_host_valid_ip_from_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Util for assignment strategies.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            host (string): name of the host</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">host</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">host</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">return</span> <span class="n">valid</span></div>

<div class="viewcode-block" id="NetworkAPI.intf_name"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.intf_name">[docs]</a>    <span class="k">def</span> <span class="nf">intf_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a canonical interface name node-ethN for interface port.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the Mininet node</span>
<span class="sd">            port (int)   : port number</span>

<span class="sd">        Returns:</span>
<span class="sd">            the chosen interface name (string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;-eth&#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">port</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.auto_switch_id"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.auto_switch_id">[docs]</a>    <span class="k">def</span> <span class="nf">auto_switch_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute an available switch id that can be assigned.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            base (int): starting switch id</span>

<span class="sd">        Returns:</span>
<span class="sd">            the computed switch id (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">switch_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_ids</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grpc_ports</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">next_element</span><span class="p">(</span><span class="n">switch_ids</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="n">base</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.auto_grpc_port"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.auto_grpc_port">[docs]</a>    <span class="k">def</span> <span class="nf">auto_grpc_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">9559</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute an available grpc port that can be assigned.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            base (int): starting grpc port</span>

<span class="sd">        Returns:</span>
<span class="sd">            the computed grpc port (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grpc_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grpc_ports</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thrift_ports</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">next_element</span><span class="p">(</span><span class="n">grpc_ports</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="n">base</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.auto_thrift_port"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.auto_thrift_port">[docs]</a>    <span class="k">def</span> <span class="nf">auto_thrift_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">9090</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute an available thrift port that can be assigned.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            base (int): starting thrift port</span>

<span class="sd">        Returns:</span>
<span class="sd">            the computed thrift port (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">thrift_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrift_ports</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">next_element</span><span class="p">(</span><span class="n">thrift_ports</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="n">base</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.auto_port_num"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.auto_port_num">[docs]</a>    <span class="k">def</span> <span class="nf">auto_port_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the next port number that can be used on the node.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string)    : name of the node</span>
<span class="sd">            base (int)       : starting port number</span>

<span class="sd">        Returns:</span>
<span class="sd">            available port number (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ports</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ports_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ports</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">next_element</span><span class="p">(</span><span class="n">ports_list</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="n">base</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base</span></div>

<div class="viewcode-block" id="NetworkAPI.auto_mac_address"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.auto_mac_address">[docs]</a>    <span class="k">def</span> <span class="nf">auto_mac_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a MAC address, different from anyone already generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mac</span> <span class="o">=</span> <span class="n">rand_mac</span><span class="p">()</span>
        <span class="n">mac_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mac_addresses</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">mac</span> <span class="ow">in</span> <span class="n">mac_addresses</span><span class="p">:</span>
            <span class="n">mac</span> <span class="o">=</span> <span class="n">rand_mac</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mac</span></div>

<div class="viewcode-block" id="NetworkAPI.auto_ip_address"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.auto_ip_address">[docs]</a>    <span class="k">def</span> <span class="nf">auto_ip_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an IP address, different from anyone already generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ip_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ipv4_net</span><span class="o">.</span><span class="n">hosts</span><span class="p">()</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">ip_generator</span><span class="p">))</span>
        <span class="n">prefixLen</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ipv4_net</span><span class="o">.</span><span class="n">prefixlen</span><span class="p">)</span>
        <span class="n">ip_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ip_addresses</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ip_addresses</span><span class="p">:</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">ip_generator</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ip</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">prefixLen</span></div>

<div class="viewcode-block" id="NetworkAPI.auto_assignment"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.auto_assignment">[docs]</a>    <span class="k">def</span> <span class="nf">auto_assignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function automatically assigns unique MACs, IPs, interface </span>
<span class="sd">        names and port numbers to all the interfaces which require them.</span>
<span class="sd">        It also assigns unique device ids, grpc ports and thrift ports</span>
<span class="sd">        to the devices which require them. When a default interface is</span>
<span class="sd">        encountered, the respective device entry is updated.</span>

<span class="sd">        It assignes unique IPs and MACs addresses to the hosts that were</span>
<span class="sd">        not configured manually or through an assignment strategy.</span>
<span class="sd">        It assignes unique MACs addresses to the every non-host node that</span>
<span class="sd">        was not configured manually or through an assignment strategy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set nodes&#39; parameters automatically</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                
                <span class="c1"># Device IDs</span>
                <span class="n">device_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">device_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">device_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_switch_id</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setP4SwitchId</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">device_id</span><span class="p">)</span>

                <span class="c1"># Thrift ports</span>
                <span class="n">thrift_port</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thrift_port&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">thrift_port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">thrift_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_thrift_port</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setThriftPort</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">thrift_port</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4RuntimeSwitch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>

                    <span class="c1"># GRPC ports</span>
                    <span class="n">grpc_port</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grpc_port&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">grpc_port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">grpc_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_grpc_port</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setGrpcPort</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">grpc_port</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                
                <span class="c1"># DPIDs</span>
                <span class="n">dpid</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dpid&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dpid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">device_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_switch_id</span><span class="p">()</span>
                    <span class="n">dpid</span> <span class="o">=</span> <span class="n">dpidToStr</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setSwitchDpid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dpid</span><span class="p">)</span>

        <span class="c1"># Set links&#39; parameters automatically</span>
        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withKeys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="c1"># Port numbers</span>
            <span class="n">port1</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                    <span class="n">port1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_port_num</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">port1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_port_num</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfPort</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">port1</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

            <span class="n">port2</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">port2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                    <span class="n">port2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_port_num</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">port2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_port_num</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfPort</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">port2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># Interface names</span>
            <span class="n">intfName1</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;intfName1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">intfName1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">intfName1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intf_name</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">port1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfName</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">intfName1</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            
            <span class="n">intfName2</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;intfName2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">intfName2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">intfName2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intf_name</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">port2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfName</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">intfName2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># MACs</span>
            <span class="n">addr1</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;addr1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">addr1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">addr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_mac_address</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfMac</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">addr1</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

            <span class="n">addr2</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;addr2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">addr2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">addr2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_mac_address</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfMac</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">addr2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># IPs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                <span class="n">params1</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params1&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">params1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ip1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_ip_address</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">ip1</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ip1</span> <span class="o">=</span> <span class="n">params1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ip1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ip1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_ip_address</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">ip1</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">params2</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params2&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">params2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ip2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_ip_address</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">ip2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ip2</span> <span class="o">=</span> <span class="n">params2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ip2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ip2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_ip_address</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">ip2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            
        <span class="c1"># Update hosts&#39; default interfaces (from links&#39; parameters to hosts&#39; parameters)</span>
        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withKeys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                <span class="c1"># Check if it is a default interfaces</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_default_intf</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">mac</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;addr1&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;params1&#39;</span><span class="p">][</span><span class="s1">&#39;ip&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                 <span class="c1"># Check if it is a default interfaces</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_default_intf</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">mac</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;addr2&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;params2&#39;</span><span class="p">][</span><span class="s1">&#39;ip&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="NetworkAPI.get_default_intf"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.get_default_intf">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_intf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the tuple (node1, node2, key) identifying the</span>
<span class="sd">        default interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
            <span class="n">node_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ports</span><span class="p">()</span>
            <span class="n">ports</span> <span class="o">=</span> <span class="n">node_ports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ports</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">node_ports</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warning</span><span class="p">(</span><span class="s1">&#39;node </span><span class="si">{}</span><span class="s1"> has no incident links.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node1</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exist.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node1</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.is_default_intf"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.is_default_intf">[docs]</a>    <span class="k">def</span> <span class="nf">is_default_intf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the specified interface is the default one for node1.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the interface is default, False else</span>

<span class="sd">        Notice:</span>
<span class="sd">            Since interfaces can be removed, the default interface</span>
<span class="sd">            may change during the definition of the network. So this is</span>
<span class="sd">            reliable only if no other interfaces are added/removed afterwards.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
        <span class="n">def_intf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_intf</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linkEntry</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">intf</span> <span class="o">=</span> <span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">def_intf</span> <span class="o">==</span> <span class="n">intf</span></div>

<span class="c1">### API</span>
<span class="c1">## External modules management</span>
<div class="viewcode-block" id="NetworkAPI.setLogLevel"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setLogLevel">[docs]</a>    <span class="k">def</span> <span class="nf">setLogLevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the log level for the execution.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            logLevel (string): possible values are debug&#39;, &#39;info&#39;, &#39;output&#39;,</span>
<span class="sd">                               &#39;warning&#39;, &#39;error&#39;, &#39;critical&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">setLogLevel</span><span class="p">(</span><span class="n">logLevel</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setIpBase"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setIpBase">[docs]</a>    <span class="k">def</span> <span class="nf">setIpBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ipBase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the network in which all the L3 devices will be placed,</span>
<span class="sd">        if no explicit assignment is performed (e.g. assignment strategies</span>
<span class="sd">        or manual assignment).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            ipBase (string): IP address/mask (e.g. &#39;10.0.0.0/8&#39;)</span>

<span class="sd">        Notice:</span>
<span class="sd">            Remember that setting the IP base won&#39;t automatically change</span>
<span class="sd">            the already assigned IP. If you want to specify a network</span>
<span class="sd">            different from &#39;10.0.0.0/8&#39; (default one), please use this method</span>
<span class="sd">            before any node is added to the network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ipv4_net</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="n">ipBase</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setCompiler"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setCompiler">[docs]</a>    <span class="k">def</span> <span class="nf">setCompiler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compilerClass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the default P4 compiler class and options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">compilerClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compilerClass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;comp&#39;</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setNet"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setNet">[docs]</a>    <span class="k">def</span> <span class="nf">setNet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netClass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the default Mininet class and options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">netClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;net&#39;</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">netClass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;net&#39;</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setSwitchClient"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setSwitchClient">[docs]</a>    <span class="k">def</span> <span class="nf">setSwitchClient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">swclientClass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the default switch client class and options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">swclientClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;sw_cli&#39;</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">swclientClass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;sw_cli&#39;</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="c1">## Generic methods</span>
<div class="viewcode-block" id="NetworkAPI.printPortMapping"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.printPortMapping">[docs]</a>    <span class="k">def</span> <span class="nf">printPortMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the port mapping of all the devices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Port mapping:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">node_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ports</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node1</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node_ports</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:  &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">port1</span><span class="p">,</span> <span class="n">intf</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">node_ports</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="se">\t</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port1</span><span class="p">,</span> <span class="n">intf</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.execScript"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.execScript">[docs]</a>    <span class="k">def</span> <span class="nf">execScript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">reboot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the given command in the main namespace after</span>
<span class="sd">        the network boot.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cmd (string) : command to execute</span>
<span class="sd">            reboot (bool): whether to rerun the script every time</span>
<span class="sd">                           all the P4 switches are rebooted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;cmd&#39;</span><span class="p">:</span> <span class="n">cmd</span><span class="p">,</span> <span class="s1">&#39;reboot_run&#39;</span><span class="p">:</span> <span class="n">reboot</span><span class="p">})</span></div>

<div class="viewcode-block" id="NetworkAPI.describeP4Nodes"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.describeP4Nodes">[docs]</a>    <span class="k">def</span> <span class="nf">describeP4Nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print a description for the P4 nodes in the network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">switches</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">switch</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">switch</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">hosts</span><span class="p">:</span>
            <span class="n">host</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="NetworkAPI.setTopologyFile"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setTopologyFile">[docs]</a>    <span class="k">def</span> <span class="nf">setTopologyFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topoFile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the file where the topology will be saved for subsequent</span>
<span class="sd">        queries in the exercises.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topoFile</span> <span class="o">=</span> <span class="n">topoFile</span></div>

<div class="viewcode-block" id="NetworkAPI.enableCli"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableCli">[docs]</a>    <span class="k">def</span> <span class="nf">enableCli</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the Mininet client.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_enabled</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="NetworkAPI.disableCli"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableCli">[docs]</a>    <span class="k">def</span> <span class="nf">disableCli</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the Mininet client.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_enabled</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="NetworkAPI.enableArpTables"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableArpTables">[docs]</a>    <span class="k">def</span> <span class="nf">enableArpTables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the static ARP entries for hosts in the</span>
<span class="sd">        same network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_arp_tables</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="NetworkAPI.disableArpTables"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableArpTables">[docs]</a>    <span class="k">def</span> <span class="nf">disableArpTables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the static ARP entries for hosts in the</span>
<span class="sd">        same network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_arp_tables</span> <span class="o">=</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="NetworkAPI.enableGwArp"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableGwArp">[docs]</a>    <span class="k">def</span> <span class="nf">enableGwArp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the static ARP entry in hosts</span>
<span class="sd">        for the gateway only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_gw_arp</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="NetworkAPI.disableGwArp"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableGwArp">[docs]</a>    <span class="k">def</span> <span class="nf">disableGwArp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the static ARP entry in hosts</span>
<span class="sd">        for the gateway only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_gw_arp</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="NetworkAPI.startNetwork"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.startNetwork">[docs]</a>    <span class="k">def</span> <span class="nf">startNetwork</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Once the topology has been created, create and start the Mininet network.</span>
<span class="sd">        If enabled, start the client.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Cleanup old files and processes...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

        <span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Auto configuration of not configured interfaces...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_assignment</span><span class="p">()</span>
        
        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Compiling P4 files...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;P4 Files compiled!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">printPortMapping</span><span class="p">()</span>

        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating network...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">&#39;net&#39;</span><span class="p">,</span> <span class="n">topo</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Network created!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting network...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Network started!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting schedulers...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_schedulers</span><span class="p">()</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Schedulers started correctly!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving topology to disk...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_topology</span><span class="p">()</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Topology saved to disk!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Programming switches...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program_switches</span><span class="p">()</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Switches programmed correctly!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Programming hosts...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program_hosts</span><span class="p">()</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Hosts programmed correctly!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Executing scripts...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exec_scripts</span><span class="p">()</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;All scripts executed correctly!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Distributing tasks...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distribute_tasks</span><span class="p">()</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;All tasks distributed correctly!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_net_cli</span><span class="p">()</span>
            <span class="c1"># Stop right after the CLI is exited</span>
            <span class="n">info</span><span class="p">(</span><span class="s1">&#39;Stopping network...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="n">output</span><span class="p">(</span><span class="s1">&#39;Network stopped!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<span class="c1">## Links</span>
<div class="viewcode-block" id="NetworkAPI.addLink"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addLink">[docs]</a>    <span class="k">def</span> <span class="nf">addLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">port1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">port2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add link between two nodes. If key is None, then the next</span>
<span class="sd">        ordinal number is used.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string)        : nodes to link together</span>
<span class="sd">            port1, port2 (int)           : ports (optional)</span>
<span class="sd">            key (int)                    : id used to identify multiple edges which</span>
<span class="sd">                                           link two same nodes (optional)</span>
<span class="sd">            opts                         : link options as listed below (optional)</span>
<span class="sd">    </span>
<span class="sd">        Link options:</span>
<span class="sd">            intfName1, intfName2 (string): names of the interfaces (optional)</span>
<span class="sd">            addr1, addr2 (string)        : MAC addresses (optional)</span>
<span class="sd">            </span>
<span class="sd">            weight (int)                 : weight used to compute shortest paths</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>

<span class="sd">        Notice:</span>
<span class="sd">            If not specified, all the optional fields are assigned automatically</span>
<span class="sd">            by the method self.auto_assignment before the network is started.</span>
<span class="sd">            The interface names must not be in the canonical format (i.e. &#39;node-ethN&#39;</span>
<span class="sd">            where N is the port number of the interface) because the automatic</span>
<span class="sd">            assignment uses it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ports</span><span class="p">()</span>
        <span class="n">node_intfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_intfs</span><span class="p">()</span>
        <span class="n">mac_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mac_addresses</span><span class="p">()</span>
        <span class="n">ip_addresses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ip_addresses</span><span class="p">()</span>
        
        <span class="c1"># Sanity check</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>

        <span class="c1"># Ports</span>
        <span class="k">if</span> <span class="n">port1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="ow">in</span> <span class="n">node_ports</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">port1</span> <span class="ow">in</span> <span class="n">node_ports</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;port </span><span class="si">{}</span><span class="s1"> already present on node &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port1</span><span class="p">,</span> <span class="n">node1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">port2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">node_ports</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">port2</span> <span class="ow">in</span> <span class="n">node_ports</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;port </span><span class="si">{}</span><span class="s1"> already present on node &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port2</span><span class="p">,</span> <span class="n">node2</span><span class="p">))</span>

        <span class="c1"># Interface names</span>
        <span class="n">intfName1</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;intfName1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intfName1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="ow">in</span> <span class="n">node_intfs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">intfName1</span> <span class="ow">in</span> <span class="n">node_intfs</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;interface &quot;</span><span class="si">{}</span><span class="s1">&quot; already present on node &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intfName1</span><span class="p">,</span> <span class="n">node1</span><span class="p">))</span>

        <span class="n">intfName2</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;intfName2&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intfName2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node2</span> <span class="ow">in</span> <span class="n">node_intfs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">intfName2</span> <span class="ow">in</span> <span class="n">node_intfs</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;interface &quot;</span><span class="si">{}</span><span class="s1">&quot; already present on node &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intfName2</span><span class="p">,</span> <span class="n">node2</span><span class="p">))</span>

        <span class="c1"># MACs</span>
        <span class="n">addr1</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;addr1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">addr1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">addr1</span> <span class="ow">in</span> <span class="n">mac_addresses</span><span class="p">:</span>
                <span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Node &quot;</span><span class="si">{}</span><span class="s1">&quot;: MAC </span><span class="si">{}</span><span class="s1"> has been already assigned.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">addr1</span><span class="p">))</span>

        <span class="n">addr2</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;addr2&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">addr2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">addr2</span> <span class="ow">in</span> <span class="n">mac_addresses</span> <span class="ow">or</span> <span class="n">addr1</span> <span class="o">==</span> <span class="n">addr2</span><span class="p">:</span>
                <span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Node &quot;</span><span class="si">{}</span><span class="s1">&quot;: MAC </span><span class="si">{}</span><span class="s1"> has been already assigned.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">addr2</span><span class="p">))</span>

        <span class="c1"># IPs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
            <span class="n">ip1</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sw_ip1&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ip1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ip1</span> <span class="o">=</span> <span class="n">ip1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ip1</span> <span class="ow">in</span> <span class="n">ip_addresses</span><span class="p">:</span>
                    <span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Node &quot;</span><span class="si">{}</span><span class="s1">&quot;: IP </span><span class="si">{}</span><span class="s1"> has been already assigned.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">ip1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params1</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params1&#39;</span><span class="p">)</span>
            <span class="n">ip1</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">params1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ip1</span> <span class="o">=</span> <span class="n">params1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ip1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ip1</span> <span class="o">=</span> <span class="n">ip1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ip1</span> <span class="ow">in</span> <span class="n">ip_addresses</span><span class="p">:</span>
                        <span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Node &quot;</span><span class="si">{}</span><span class="s1">&quot;: IP </span><span class="si">{}</span><span class="s1"> has been already assigned.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">ip1</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
            <span class="n">ip2</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sw_ip2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ip2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ip2</span> <span class="o">=</span> <span class="n">ip2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ip2</span> <span class="ow">in</span> <span class="n">ip_addresses</span> <span class="ow">or</span> <span class="n">ip1</span> <span class="o">==</span> <span class="n">ip2</span><span class="p">:</span>
                    <span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Node &quot;</span><span class="si">{}</span><span class="s1">&quot;: IP </span><span class="si">{}</span><span class="s1"> has been already assigned.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">ip2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params2</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params2&#39;</span><span class="p">)</span>
            <span class="n">ip2</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">params2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ip2</span> <span class="o">=</span> <span class="n">params2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ip2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ip2</span> <span class="o">=</span> <span class="n">ip2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ip2</span> <span class="ow">in</span> <span class="n">ip_addresses</span> <span class="ow">or</span> <span class="n">ip1</span> <span class="o">==</span> <span class="n">ip2</span><span class="p">:</span>
                        <span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Node &quot;</span><span class="si">{}</span><span class="s1">&quot;: IP </span><span class="si">{}</span><span class="s1"> has been already assigned.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">ip2</span><span class="p">))</span>

        <span class="c1"># Modified version of the mininet addLink. Built-in port numbering removed.</span>
        <span class="c1"># (see https://github.com/mininet/mininet/blob/57294d013e780cccc6b4b9af151906b382c4d8a7/mininet/topo.py#L151)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lopts</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lopts</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>

        <span class="c1"># Set default options</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="n">TCLink</span><span class="p">)</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">node1</span><span class="o">=</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="o">=</span><span class="n">node2</span><span class="p">,</span> <span class="n">port1</span><span class="o">=</span><span class="n">port1</span><span class="p">,</span> <span class="n">port2</span><span class="o">=</span><span class="n">port2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.getLink"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.getLink">[docs]</a>    <span class="k">def</span> <span class="nf">getLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return link metadata dict. If key is None, then the </span>
<span class="sd">        link with the lowest key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            key (int)        : id used to identify multiple edges which</span>
<span class="sd">                               link two same nodes (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (link metadata dict, key)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entry</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linkEntry</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entry</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">key</span></div>

<div class="viewcode-block" id="NetworkAPI.updateLink"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.updateLink">[docs]</a>    <span class="k">def</span> <span class="nf">updateLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update link metadata dict. In fact, delete the node</span>
<span class="sd">        and create a new one with the updated information. </span>
<span class="sd">        If key is None, then the link with the lowest key </span>
<span class="sd">        value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes to link together</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>
<span class="sd">            opts                 : link options to update (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="c1"># Check if the edge is in the opposite direction and</span>
        <span class="c1"># change all the fields accordingly</span>
        <span class="k">if</span> <span class="n">node1</span> <span class="o">==</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">node2</span> <span class="o">==</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">]</span>
            <span class="n">opts_new</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">opts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;1&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                    <span class="n">opts_new</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="s1">&#39;2&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                    <span class="n">opts_new</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">opts_new</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opts_new</span> <span class="o">=</span> <span class="n">opts</span>
        <span class="c1"># Remove &#39;node1&#39; and &#39;node2&#39; fields from link&#39;s information</span>
        <span class="n">node1</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;node1&#39;</span><span class="p">)</span>
        <span class="n">node2</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;node2&#39;</span><span class="p">)</span>
        <span class="n">merge_dict</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">opts_new</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.deleteLink"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.deleteLink">[docs]</a>    <span class="k">def</span> <span class="nf">deleteLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete link.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes to link together</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entry1</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linkEntry</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">entry1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">node2</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.popLink"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.popLink">[docs]</a>    <span class="k">def</span> <span class="nf">popLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pop link. If key is None, then the link with the lowest</span>
<span class="sd">        key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes to link together</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            (link metadata dict, key)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteLink</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s1">&#39;node1&#39;</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="s1">&#39;node2&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">link</span><span class="p">,</span> <span class="n">key</span></div>

<div class="viewcode-block" id="NetworkAPI.links"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.links">[docs]</a>    <span class="k">def</span> <span class="nf">links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withKeys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return links only preserving (src, dst) order, i.e. no duplicated </span>
<span class="sd">        edges are listed.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            sort (bool)    : sort links alphabetically, preserving (src, dst) order</span>
<span class="sd">            withKeys (bool): return link keys</span>
<span class="sd">            withInfo (bool): return link info</span>

<span class="sd">        Returns: </span>
<span class="sd">            list of (src, dst [,key, info ])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">sort</span><span class="p">,</span> <span class="n">withKeys</span><span class="p">,</span> <span class="n">withInfo</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setBw"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setBw">[docs]</a>    <span class="k">def</span> <span class="nf">setBw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set link bandwidth. If key is None, then the link with the lowest</span>
<span class="sd">        key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            bw (float, int)      : bandwidth (in Mbps)</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;bw is not a float nor int.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setDelay"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setDelay">[docs]</a>    <span class="k">def</span> <span class="nf">setDelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set link delay. If key is None, then the link with the lowest</span>
<span class="sd">        key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            delay (int)          : transmission delay (in ms)</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;delay is not an integer.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setLoss"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setLoss">[docs]</a>    <span class="k">def</span> <span class="nf">setLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set link loss. If key is None, then the link with the lowest</span>
<span class="sd">        key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            loss (float)         : packet loss rate (e.g. 0.5 means that 50% of</span>
<span class="sd">                                   packets will exeperience a loss)</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">loss</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">loss</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">*=</span> <span class="mi">100</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;the selected loss rate is not allowed.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;bw is not an integer.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setMaxQueueSize"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setMaxQueueSize">[docs]</a>    <span class="k">def</span> <span class="nf">setMaxQueueSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">max_queue_size</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set link max queue size. If key is None, then the link with the lowest</span>
<span class="sd">        key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            max_queue_size (int) : maximum number of packets the qdisc may hold queued at a time.</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_queue_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">max_queue_size</span><span class="o">=</span><span class="n">max_queue_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;max_queue_size is not an integer.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setIntfName"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setIntfName">[docs]</a>    <span class="k">def</span> <span class="nf">setIntfName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">intfName</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set name of node1&#39;s interface facing node2 with the specified key. if key is None,</span>
<span class="sd">        then the link with lowest key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            intfName (string)    : name of the interface</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">intfName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_intfs</span><span class="p">()[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">intfName1</span><span class="o">=</span><span class="n">intfName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;interface &quot;</span><span class="si">{}</span><span class="s1">&quot; already present on node &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intfName</span><span class="p">,</span> <span class="n">node1</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.setIntfPort"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setIntfPort">[docs]</a>    <span class="k">def</span> <span class="nf">setIntfPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set port number of node1&#39;s interface facing node2 with the specified key.</span>
<span class="sd">        if key is None, then the link with lowest key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            port (int)           : name of the interface</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ports</span><span class="p">()[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">port1</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;port </span><span class="si">{}</span><span class="s1"> already present on node &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">node1</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.setIntfIp"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setIntfIp">[docs]</a>    <span class="k">def</span> <span class="nf">setIntfIp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set IP of node1&#39;s interface facing node2 with the specified key. If key is None,</span>
<span class="sd">        then the link with the lowest key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            ip (string)          : IP address/mask to configure</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
            <span class="c1"># Set fake IP for switches</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">sw_ip1</span><span class="o">=</span><span class="n">ip</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Set real IP for other devices</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">params1</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="n">ip</span><span class="p">})</span></div>

<div class="viewcode-block" id="NetworkAPI.setIntfMac"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setIntfMac">[docs]</a>    <span class="k">def</span> <span class="nf">setIntfMac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set MAC of node1&#39;s interface facing node2 with the specified key. If key is None,</span>
<span class="sd">        then the link with the lowest key value is considered.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): nodes linked together</span>
<span class="sd">            mac (string)         : MAC address to configure</span>
<span class="sd">            key (int)            : id used to identify multiple edges which</span>
<span class="sd">                                   link two same nodes (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            key (int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateLink</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">addr1</span><span class="o">=</span><span class="n">mac</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setBwAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setBwAll">[docs]</a>    <span class="k">def</span> <span class="nf">setBwAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set bandwidth for all the links currently in the network.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            bw (float): bandwidth (in Mbps)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withKeys</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBw</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setDelayAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setDelayAll">[docs]</a>    <span class="k">def</span> <span class="nf">setDelayAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set delay for all the links currently in the network.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            delay (int): transmission delay (in ms)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withKeys</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDelay</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setLossAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setLossAll">[docs]</a>    <span class="k">def</span> <span class="nf">setLossAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loss</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set loss for all the links currently in the network.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            loss (float): packet loss rate (e.g. 0.5 means that 50% of</span>
<span class="sd">                          packets will exeperience a loss)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withKeys</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLoss</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="NetworkAPI.setMaxQueueSizeAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setMaxQueueSizeAll">[docs]</a>    <span class="k">def</span> <span class="nf">setMaxQueueSizeAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_queue_size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set max queue size for all the links currently in the network.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            max_queue_size (int): maximum number of packets the qdisc may hold queued at a time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">(</span><span class="n">withKeys</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMaxQueueSize</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">max_queue_size</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>

<span class="c1">## Nodes</span>
<span class="c1"># Generic nodes</span>
<div class="viewcode-block" id="NetworkAPI.addNode"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addNode">[docs]</a>    <span class="k">def</span> <span class="nf">addNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add Node to graph.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name</span>
<span class="sd">            opts (kwargs): node options</span>

<span class="sd">        Returns:</span>
<span class="sd">            node name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="NetworkAPI.getNode"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.getNode">[docs]</a>    <span class="k">def</span> <span class="nf">getNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get node information.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): Mininet node name</span>

<span class="sd">        Returns:</span>
<span class="sd">            node metadata dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeInfo</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.updateNode"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.updateNode">[docs]</a>    <span class="k">def</span> <span class="nf">updateNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update node metadata dict. In fact, delete the node</span>
<span class="sd">        and create a new one with the updated information.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): node name</span>
<span class="sd">            opts         : node options to update (optional)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            node name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">node_setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addHost</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4RuntimeSwitch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">node_setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addP4RuntimeSwitch</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">node_setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addP4Switch</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">node_setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSwitch</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRouter</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">node_setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addRouter</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNode</span>

        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">remove_links</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">merge_dict</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node_setter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.deleteNode"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.deleteNode">[docs]</a>    <span class="k">def</span> <span class="nf">deleteNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">remove_links</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete node.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node         (string): Mininet node name</span>
<span class="sd">            remove_links (bool)  : whether to remove all the incident</span>
<span class="sd">                                   links</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Delete incident links</span>
        <span class="k">if</span> <span class="n">remove_links</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Delete node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> </div>

<div class="viewcode-block" id="NetworkAPI.popNode"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.popNode">[docs]</a>    <span class="k">def</span> <span class="nf">popNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">remove_links</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pop node.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1 (string)     : nodes to link together</span>
<span class="sd">            remove_links (bool): whether to remove all the incident</span>
<span class="sd">                                 links</span>

<span class="sd">        Returns:</span>
<span class="sd">            node metadata dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">remove_links</span><span class="o">=</span><span class="n">remove_links</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>

<div class="viewcode-block" id="NetworkAPI.isNode"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.isNode">[docs]</a>    <span class="k">def</span> <span class="nf">isNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if node exists.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): node name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if node exists, else False (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span></div>

<div class="viewcode-block" id="NetworkAPI.nodes"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.nodes">[docs]</a>    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return nodes in graph.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            sort (bool)    : sort nodes alphabetically</span>
<span class="sd">            withInfo (bool): retrieve node information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">withInfo</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sort</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nodes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ignore info when sorting</span>
            <span class="n">tupleSize</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">naturalSeq</span><span class="p">(</span><span class="n">l</span><span class="p">[:</span><span class="n">tupleSize</span><span class="p">])))</span></div>

<div class="viewcode-block" id="NetworkAPI.enableLog"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableLog">[docs]</a>    <span class="k">def</span> <span class="nf">enableLog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="s1">&#39;./log&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable log for node (also for the task scheduler).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string)   : name of the node</span>
<span class="sd">            log_dir (string): where to save log files</span>
<span class="sd">        &quot;&quot;&quot;</span>            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">log_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="n">log_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exists.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.disableLog"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableLog">[docs]</a>    <span class="k">def</span> <span class="nf">disableLog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable log for node (also for the task scheduler).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the node</span>
<span class="sd">        &quot;&quot;&quot;</span>            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">log_enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exists.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.enableLogAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableLogAll">[docs]</a>    <span class="k">def</span> <span class="nf">enableLogAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="s1">&#39;./log&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable log for all the nodes (also for the task schedulers).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            log_dir (string): where to save log files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableLog</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">log_dir</span><span class="o">=</span><span class="n">log_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.disableLogAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableLogAll">[docs]</a>    <span class="k">def</span> <span class="nf">disableLogAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable log for all the nodes (also for the task schedulers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableLog</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.enableScheduler"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableScheduler">[docs]</a>    <span class="k">def</span> <span class="nf">enableScheduler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the task scheduler server for the node.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the node</span>
<span class="sd">            path (string): name of the directory where the</span>
<span class="sd">                           socket file will be placed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">scheduler</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">socket_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exists.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.disableScheduler"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableScheduler">[docs]</a>    <span class="k">def</span> <span class="nf">disableScheduler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the task scheduler server for the node.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">scheduler</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exists.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.hasScheduler"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.hasScheduler">[docs]</a>    <span class="k">def</span> <span class="nf">hasScheduler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether a host has an active scheduler or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scheduler&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.enableSchedulerAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableSchedulerAll">[docs]</a>    <span class="k">def</span> <span class="nf">enableSchedulerAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the task scheduler server for all the nodes.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            path (string): name of the directory where the</span>
<span class="sd">                           socket file will be placed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableScheduler</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.disableSchedulerAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableSchedulerAll">[docs]</a>    <span class="k">def</span> <span class="nf">disableSchedulerAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable the task scheduler server for all the nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableScheduler</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.addTaskFile"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addTaskFile">[docs]</a>    <span class="k">def</span> <span class="nf">addTaskFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">def_mod</span><span class="o">=</span><span class="s1">&#39;p4utils.utils.traffic_utils&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the tasks to the node.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            filepath (string): tasks file path</span>
<span class="sd">            def_mod (string) : default module where to look for exe functions</span>

<span class="sd">        Notice:</span>
<span class="sd">            The file has to be a set of lines, where each has the following syntax.</span>
<span class="sd">            A non-default module can be specified in the command with &#39;--mod &lt;module&gt;&#39;.</span>
<span class="sd">            &lt;node&gt; &lt;start&gt; &lt;duration&gt; &lt;exe&gt; [&lt;arg1&gt;] ... [&lt;argN&gt;] [--mod &lt;module&gt;] [--&lt;key1&gt; &lt;kwarg1&gt;] ... [--&lt;keyM&gt; &lt;kwargM&gt;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;//&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">))]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">parse_task_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">def_mod</span><span class="o">=</span><span class="n">def_mod</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addTask</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.addTask"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addTask">[docs]</a>    <span class="k">def</span> <span class="nf">addTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">enableScheduler</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a task to the node. It can automatically enable the TaskServer</span>
<span class="sd">        on that node with the socket lacated in the default path, if no</span>
<span class="sd">        TaskServer has been previously enabled.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string)         : name of the node</span>
<span class="sd">            exe                   : executable to run (either a shell string </span>
<span class="sd">                                    command or a python function)</span>
<span class="sd">            args                  : positional arguments for the passed function</span>
<span class="sd">            start (float)         : task delay in seconds with respect to the</span>
<span class="sd">                                    network staring time.</span>
<span class="sd">            duration (float)      : task duration time in seconds (if duration is </span>
<span class="sd">                                    lower than or equal to 0, then the task has no </span>
<span class="sd">                                    time limitation)</span>
<span class="sd">            enableScheduler (bool): whether to automatically enable the TaskServer or not</span>
<span class="sd">            kwargs                : key-word arguments for the passed function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="c1"># If the TaskServer is not enabled, enable it.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasScheduler</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="n">enableScheduler</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enableScheduler</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasScheduler</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">enableScheduler</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not have a scheduler.&#39;</span><span class="o">.</span> <span class="nb">format</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">[])</span>
            <span class="c1"># Parse execution parameters to pass to the server</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">exe</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># Append task to tasks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exists.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.setDefaultRoute"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setDefaultRoute">[docs]</a>    <span class="k">def</span> <span class="nf">setDefaultRoute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default_route</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the node&#39;s default route.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string)         : name of the node</span>
<span class="sd">            default_route (string): default route IP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">defaultRoute</span><span class="o">=</span><span class="s1">&#39;via </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">default_route</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; does not exists.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.areNeighbors"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.areNeighbors">[docs]</a>    <span class="k">def</span> <span class="nf">areNeighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether two node are neighbors.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node1, node2 (string): names of the nodes</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if node1 and node2 are neighbors, False else.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">node1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<span class="c1"># Hosts</span>
<div class="viewcode-block" id="NetworkAPI.addHost"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addHost">[docs]</a>    <span class="k">def</span> <span class="nf">addHost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add P4 host node to Mininet topology.</span>
<span class="sd">        If the node is already present, overwrite it.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): switch name</span>
<span class="sd">            opts (kwargs): switch options (optional)</span>

<span class="sd">        Returns:</span>
<span class="sd">            P4 host name (string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="n">P4Host</span><span class="p">)</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">isHost</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">addHost</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.isHost"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.isHost">[docs]</a>    <span class="k">def</span> <span class="nf">isHost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if node is a host.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): node name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if node is a host, else False (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isHost&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.hosts"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.hosts">[docs]</a>    <span class="k">def</span> <span class="nf">hosts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return hosts.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            sort (bool)    : sort hosts alphabetically</span>
<span class="sd">            withInfo (bool): retrieve node information</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of hosts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">withInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span></div>

<div class="viewcode-block" id="NetworkAPI.enableDhcp"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableDhcp">[docs]</a>    <span class="k">def</span> <span class="nf">enableDhcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable DHCP server in hosts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dhcp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.disableDhcp"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableDhcp">[docs]</a>    <span class="k">def</span> <span class="nf">disableDhcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable DHCP server in hosts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dhcp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.enableDhcpAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableDhcpAll">[docs]</a>    <span class="k">def</span> <span class="nf">enableDhcpAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable DHCP for all the hosts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableDhcp</span><span class="p">(</span><span class="n">host</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">disableDhcpAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable DHCP for all the hosts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableDhcp</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>

<div class="viewcode-block" id="NetworkAPI.disableDhcpAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableDhcpAll">[docs]</a>    <span class="k">def</span> <span class="nf">disableDhcpAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable DHCP for all the hosts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hosts</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableDhcp</span><span class="p">(</span><span class="n">host</span><span class="p">)</span></div>

<span class="c1"># Switches</span>
<div class="viewcode-block" id="NetworkAPI.addSwitch"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addSwitch">[docs]</a>    <span class="k">def</span> <span class="nf">addSwitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add switch node to Mininet topology.</span>
<span class="sd">        If the node is already present, overwrite it.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): switch name</span>
<span class="sd">            opts (kwargs): switch options</span>

<span class="sd">        Returns:</span>
<span class="sd">            switch name (string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dpid</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dpid&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dpid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">switch_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">switch_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_ids</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;dpid </span><span class="si">{}</span><span class="s1"> already in use.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dpid</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sopts</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sopts</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">isSwitch</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.isSwitch"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.isSwitch">[docs]</a>    <span class="k">def</span> <span class="nf">isSwitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if node is a switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): Mininet node name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if node is a switch, else False (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="NetworkAPI.switches"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.switches">[docs]</a>    <span class="k">def</span> <span class="nf">switches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return switches.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            sort (bool)    : sort switches alphabetically</span>
<span class="sd">            withInfo (bool): retrieve node information</span>
<span class="sd">           </span>
<span class="sd">        Returns: </span>
<span class="sd">            list of switches</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">withInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span></div>

<div class="viewcode-block" id="NetworkAPI.setSwitchDpid"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setSwitchDpid">[docs]</a>    <span class="k">def</span> <span class="nf">setSwitchDpid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dpid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set Switch DPID. Only applies to non P4 switches</span>
<span class="sd">        since their DPID is determined by their ID.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 switch</span>
<span class="sd">            dpid (string): switch DPID (16 hexadecimal characters)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;cannot set DPID to P4 switches.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dpid</span><span class="o">=</span><span class="n">dpid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<span class="c1"># P4Switches</span>
<div class="viewcode-block" id="NetworkAPI.addP4Switch"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addP4Switch">[docs]</a>    <span class="k">def</span> <span class="nf">addP4Switch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add P4 switch node to Mininet topology.</span>
<span class="sd">        If the node is already present, overwrite it.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): switch name</span>
<span class="sd">            opts (kwargs): switch options</span>

<span class="sd">        Returns:</span>
<span class="sd">            P4 switch name (string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">switch_id</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">switch_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">switch_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_ids</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;switch ID </span><span class="si">{}</span><span class="s1"> already in use.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">switch_id</span><span class="p">))</span>

        <span class="n">opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="n">P4Switch</span><span class="p">)</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">isP4Switch</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSwitch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.isP4Switch"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.isP4Switch">[docs]</a>    <span class="k">def</span> <span class="nf">isP4Switch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if node is a P4 switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): node name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if node is a P4 switch, else False (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isP4Switch&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.p4switches"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.p4switches">[docs]</a>    <span class="k">def</span> <span class="nf">p4switches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return P4 switches.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            sort (bool)    : sort switches alphabetically</span>
<span class="sd">            withInfo (bool): retrieve node information</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of P4 switches</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">withInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span></div>

<div class="viewcode-block" id="NetworkAPI.setP4Source"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setP4Source">[docs]</a>    <span class="k">def</span> <span class="nf">setP4Source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">p4_src</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the P4 source for the switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string)  : name of the P4 switch</span>
<span class="sd">            p4_src (string): path to the P4 fil</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">p4_src</span><span class="o">=</span><span class="n">p4_src</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.setP4SourceAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setP4SourceAll">[docs]</a>    <span class="k">def</span> <span class="nf">setP4SourceAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p4_src</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the same P4 source for all the P4 switches.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string)  : name of the P4 switch</span>
<span class="sd">            p4_src (string): path to the P4 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">p4switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setP4Source</span><span class="p">(</span><span class="n">p4switch</span><span class="p">,</span> <span class="n">p4_src</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.setP4CliInput"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setP4CliInput">[docs]</a>    <span class="k">def</span> <span class="nf">setP4CliInput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cli_input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the path to the command line configuration file for</span>
<span class="sd">        the Thrift capable switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string)     : name of the P4 switch</span>
<span class="sd">            cli_input (string): path to the command line configuration</span>
<span class="sd">                                file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cli_input</span><span class="o">=</span><span class="n">cli_input</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.setP4SwitchId"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setP4SwitchId">[docs]</a>    <span class="k">def</span> <span class="nf">setP4SwitchId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set P4 Switch ID.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 switch</span>
<span class="sd">            id (int)     : P4 switch ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">device_id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.setThriftPort"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setThriftPort">[docs]</a>    <span class="k">def</span> <span class="nf">setThriftPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the thrift port number for the P4 switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 switch</span>
<span class="sd">            port (int)   : thrift port number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">thrift_port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.enableDebugger"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableDebugger">[docs]</a>    <span class="k">def</span> <span class="nf">enableDebugger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable debugger for switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 switch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">enable_debugger</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.disableDebugger"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableDebugger">[docs]</a>    <span class="k">def</span> <span class="nf">disableDebugger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable debugger for switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 switch</span>
<span class="sd">        &quot;&quot;&quot;</span>            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">enable_debugger</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.enableDebuggerAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableDebuggerAll">[docs]</a>    <span class="k">def</span> <span class="nf">enableDebuggerAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable debugger for all the switches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableDebugger</span><span class="p">(</span><span class="n">switch</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.disableDebuggerAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableDebuggerAll">[docs]</a>    <span class="k">def</span> <span class="nf">disableDebuggerAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable debugger for all the switches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableDebugger</span><span class="p">(</span><span class="n">switch</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.enablePcapDump"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enablePcapDump">[docs]</a>    <span class="k">def</span> <span class="nf">enablePcapDump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pcap_dir</span><span class="o">=</span><span class="s1">&#39;./pcap&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable pcap dump for switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string)    : name of the P4 switch</span>
<span class="sd">            pcap_dir (string): where to save pcap files</span>
<span class="sd">        &quot;&quot;&quot;</span>            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pcap_dump</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pcap_dir</span><span class="o">=</span><span class="n">pcap_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.disablePcapDump"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disablePcapDump">[docs]</a>    <span class="k">def</span> <span class="nf">disablePcapDump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable pcap dump for switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 switch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pcap_dump</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.enablePcapDumpAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enablePcapDumpAll">[docs]</a>    <span class="k">def</span> <span class="nf">enablePcapDumpAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pcap_dir</span><span class="o">=</span><span class="s1">&#39;./pcap&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable pcap dump for all the switches.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            pcap_dir (string): where to save pcap files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enablePcapDump</span><span class="p">(</span><span class="n">switch</span><span class="p">,</span> <span class="n">pcap_dir</span><span class="o">=</span><span class="n">pcap_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.disablePcapDumpAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disablePcapDumpAll">[docs]</a>    <span class="k">def</span> <span class="nf">disablePcapDumpAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable pcap dump for all the switches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disablePcapDump</span><span class="p">(</span><span class="n">switch</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.hasCpuPort"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.hasCpuPort">[docs]</a>    <span class="k">def</span> <span class="nf">hasCpuPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if node has a CPU port.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): Mininet node name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if node has a CPU port, else False (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cpu_port&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.enableCpuPort"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableCpuPort">[docs]</a>    <span class="k">def</span> <span class="nf">enableCpuPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable CPU port on switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 switch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="c1"># We use the bridge but at the same time we use the bug it has so the</span>
            <span class="c1"># interfaces are not added to it, but at least we can clean easily thanks to that.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu_bridge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpu_bridge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addSwitch</span><span class="p">(</span><span class="s1">&#39;sw-cpu&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">LinuxBridge</span><span class="p">,</span> <span class="n">dpid</span><span class="o">=</span><span class="s1">&#39;1000000000000000&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addLink</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu_bridge</span><span class="p">,</span> <span class="n">intfName1</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-cpu-eth0&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">intfName2</span><span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-cpu-eth1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">deleteIntfs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cpu_port</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.disableCpuPort"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableCpuPort">[docs]</a>    <span class="k">def</span> <span class="nf">disableCpuPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable CPU port on switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 switch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasCpuPort</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">popLink</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cpu_port</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">delete_cpu_bridge</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasCpuPort</span><span class="p">(</span><span class="n">switch</span><span class="p">):</span>
                        <span class="n">delete_cpu_bridge</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">delete_cpu_bridge</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu_bridge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu_bridge</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">popNode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu_bridge</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpu_bridge</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="NetworkAPI.enableCpuPortAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.enableCpuPortAll">[docs]</a>    <span class="k">def</span> <span class="nf">enableCpuPortAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable CPU port on all the P4 switches.</span>

<span class="sd">        Notice:</span>
<span class="sd">            This applies only to already defined switches. If other</span>
<span class="sd">            switches are added after this command, they won&#39;t have</span>
<span class="sd">            any CPU port enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableCpuPort</span><span class="p">(</span><span class="n">switch</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.disableCpuPortAll"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.disableCpuPortAll">[docs]</a>    <span class="k">def</span> <span class="nf">disableCpuPortAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable CPU port on all the P4 switches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">switch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4switches</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableCpuPort</span><span class="p">(</span><span class="n">switch</span><span class="p">)</span></div>

<span class="c1"># P4RuntimeSwitches</span>
<div class="viewcode-block" id="NetworkAPI.addP4RuntimeSwitch"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addP4RuntimeSwitch">[docs]</a>    <span class="k">def</span> <span class="nf">addP4RuntimeSwitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add P4 runtime switch node to Mininet topology.</span>
<span class="sd">        If the node is already present, overwrite it.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): switch name</span>
<span class="sd">            opts (kwargs): switch options</span>

<span class="sd">        Returns:</span>
<span class="sd">            P4 runtime switch name (string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="n">P4RuntimeSwitch</span><span class="p">)</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">isP4RuntimeSwitch</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addP4Switch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.isP4RuntimeSwitch"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.isP4RuntimeSwitch">[docs]</a>    <span class="k">def</span> <span class="nf">isP4RuntimeSwitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if node is a P4 runtime switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): node name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if node is a P4 switch, else False (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isP4RuntimeSwitch&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.p4rtswitches"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.p4rtswitches">[docs]</a>    <span class="k">def</span> <span class="nf">p4rtswitches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return P4 runtime switches.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            sort (bool)    : sort switches alphabetically</span>
<span class="sd">            withInfo (bool): retrieve node information</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of P4 runtime switches</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">withInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4RuntimeSwitch</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4RuntimeSwitch</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span></div>

<div class="viewcode-block" id="NetworkAPI.setGrpcPort"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.setGrpcPort">[docs]</a>    <span class="k">def</span> <span class="nf">setGrpcPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the grpc port number for the P4 runtime switch.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): name of the P4 runtime switch</span>
<span class="sd">            port (int)   : thrift port number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4RuntimeSwitch</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">grpc_port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; is not a P4 runtime switch.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<span class="c1"># Routers</span>
<div class="viewcode-block" id="NetworkAPI.addRouter"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.addRouter">[docs]</a>    <span class="k">def</span> <span class="nf">addRouter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add router node to Mininet topology.</span>
<span class="sd">        If the node is already present, overwrite it.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (string): switch name</span>
<span class="sd">            opts (kwargs): switch options</span>

<span class="sd">        Returns:</span>
<span class="sd">            router name (string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="n">FRRouter</span><span class="p">)</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">isRouter</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addNode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.isRouter"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.isRouter">[docs]</a>    <span class="k">def</span> <span class="nf">isRouter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if node is a router.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            node (string): node name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if node is a router, else False (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isRouter&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.routers"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.routers">[docs]</a>    <span class="k">def</span> <span class="nf">routers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return routers.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            sort (bool)    : sort routers alphabetically</span>
<span class="sd">            withInfo (bool): retrieve node information</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of routers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">withInfo</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRouter</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span> <span class="n">withInfo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRouter</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>   </div>

<span class="c1">## Assignment strategies</span>
<div class="viewcode-block" id="NetworkAPI.l2"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.l2">[docs]</a>    <span class="k">def</span> <span class="nf">l2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Automated IP/MAC assignment strategy for already initialized </span>
<span class="sd">        links and nodes. All the devices are placed inside the same</span>
<span class="sd">        IPv4 network (10.0.0.0/16).</span>

<span class="sd">        Assumptions:</span>
<span class="sd">            Each host is connected to exactly one switch.</span>
<span class="sd">            Only switches and hosts are allowed.</span>
<span class="sd">            Parallel links are not allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;&quot;l2&quot; assignment strategy selected.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ip_generator</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="s1">&#39;10.0.0.0/16&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hosts</span><span class="p">()</span>
        <span class="n">reserved_ips</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">assigned_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="c1"># Reserve IPs for normal hosts</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_host_valid_ip_from_name</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                    <span class="n">host_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="n">upper_byte</span> <span class="o">=</span> <span class="p">(</span><span class="n">host_num</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
                    <span class="n">lower_byte</span> <span class="o">=</span> <span class="p">(</span><span class="n">host_num</span> <span class="o">&amp;</span> <span class="mh">0x00ff</span><span class="p">)</span>
                    <span class="n">host_ip</span> <span class="o">=</span> <span class="s1">&#39;10.0.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">upper_byte</span><span class="p">,</span> <span class="n">lower_byte</span><span class="p">)</span>
                    <span class="n">reserved_ips</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">host_ip</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If it is not a host, it must be a switch</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># Check whether the graph is a multigraph</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multigraph</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span> <span class="ow">or</span> <span class="n">node2</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Node-switch link</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
            <span class="c1"># Switch-node link</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
            <span class="c1"># Switch-switch link</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_host_valid_ip_from_name</span><span class="p">(</span><span class="n">host_name</span><span class="p">):</span>
                <span class="n">host_ip</span> <span class="o">=</span> <span class="n">reserved_ips</span><span class="p">[</span><span class="n">host_name</span><span class="p">]</span>
                <span class="c1"># We check if for some reason the ip was already given by the ip_generator. </span>
                <span class="c1"># This can only happen if the host naming is not &lt;h_x&gt;.</span>
                <span class="c1"># This should not be possible anymore since we reserve ips for h_x hosts.</span>
                <span class="k">if</span> <span class="n">host_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host_ip</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">host_ip</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ip_generator</span><span class="p">)</span><span class="o">.</span><span class="n">compressed</span>
                <span class="c1"># We check if for some reason the ip was already given by the ip_generator. </span>
                <span class="c1"># This can only happen if the host naming is not &lt;h_x&gt;.</span>
                <span class="c1"># This should not be possible anymore since we reserve ips for h_x hosts.</span>
                <span class="k">while</span> <span class="n">host_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span> <span class="ow">or</span> <span class="n">host_ip</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">reserved_ips</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">host_ip</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">ip_generator</span><span class="p">)</span><span class="o">.</span><span class="n">compressed</span><span class="p">)</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span>

            <span class="n">host_mac</span> <span class="o">=</span> <span class="n">ip_address_to_mac</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">direct_sw_mac</span> <span class="o">=</span> <span class="n">ip_address_to_mac</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfMac</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_mac</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfMac</span><span class="p">(</span><span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw_mac</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_ip</span> <span class="o">+</span> <span class="s1">&#39;/16&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NetworkAPI.mixed"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.mixed">[docs]</a>    <span class="k">def</span> <span class="nf">mixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Automated IP/MAC assignment strategy for already initialized </span>
<span class="sd">        links and nodes. All the hosts linked to a switch are placed</span>
<span class="sd">        in the same subnetwork. Different switches (even those linked</span>
<span class="sd">        together) are placed in different subnetworks.</span>

<span class="sd">        Assumptions:</span>
<span class="sd">            Each host is connected to exactly one switch.</span>
<span class="sd">            Only switches and hosts are allowed.</span>
<span class="sd">            Parallel links are not allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;&quot;mixed&quot; assignment strategy selected.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">reserved_ips</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">assigned_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">sw_to_generator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sw_to_id</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="c1"># Generate a subnetwork per each switch</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                    <span class="n">sw_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sw_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sw_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_switch_id</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setP4SwitchId</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">sw_id</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dpid</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dpid&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dpid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sw_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_switch_id</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setSwitchDpid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">sw_id</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sw_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
                <span class="n">upper_bytex</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw_id</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
                <span class="n">lower_bytex</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw_id</span> <span class="o">&amp;</span> <span class="mh">0x00ff</span><span class="p">)</span>
                <span class="n">net</span> <span class="o">=</span> <span class="s1">&#39;10.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.0/24&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">upper_bytex</span><span class="p">,</span> <span class="n">lower_bytex</span><span class="p">)</span>
                <span class="n">sw_to_generator</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">IPv4Network</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">net</span><span class="p">))</span><span class="o">.</span><span class="n">hosts</span><span class="p">()</span>
                <span class="n">sw_to_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If it is not a switch, it must be a host</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        
        <span class="c1"># Check whether the graph is a multigraph</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multigraph</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span> <span class="ow">or</span> <span class="n">node2</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Node-switch link</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
            <span class="c1"># Switch-node link</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
            <span class="c1"># Switch-switch link</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">sw_id</span> <span class="o">=</span> <span class="n">sw_to_id</span><span class="p">[</span><span class="n">direct_sw</span><span class="p">]</span>
            <span class="n">upper_byte</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw_id</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
            <span class="n">lower_byte</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw_id</span> <span class="o">&amp;</span> <span class="mh">0x00ff</span><span class="p">)</span>

            <span class="c1"># Reserve IPs for normal hosts</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_host_valid_ip_from_name</span><span class="p">(</span><span class="n">host_name</span><span class="p">):</span>
                <span class="n">host_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">assert</span> <span class="n">host_num</span> <span class="o">&lt;</span> <span class="mi">254</span>
                <span class="n">host_ip</span> <span class="o">=</span> <span class="s1">&#39;10.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">upper_byte</span><span class="p">,</span> <span class="n">lower_byte</span><span class="p">,</span> <span class="n">host_num</span><span class="p">)</span>
                <span class="n">reserved_ips</span><span class="p">[</span><span class="n">host_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">host_ip</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span> <span class="ow">or</span> <span class="n">node2</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Node-switch link</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
            <span class="c1"># Switch-node link</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
            <span class="c1"># Switch-switch link</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">sw_id</span> <span class="o">=</span> <span class="n">sw_to_id</span><span class="p">[</span><span class="n">direct_sw</span><span class="p">]</span>
            <span class="n">upper_byte</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw_id</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
            <span class="n">lower_byte</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw_id</span> <span class="o">&amp;</span> <span class="mh">0x00ff</span><span class="p">)</span>
            <span class="n">ip_generator</span> <span class="o">=</span> <span class="n">sw_to_generator</span><span class="p">[</span><span class="n">direct_sw</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_host_valid_ip_from_name</span><span class="p">(</span><span class="n">host_name</span><span class="p">):</span>
                <span class="n">host_ip</span> <span class="o">=</span> <span class="n">reserved_ips</span><span class="p">[</span><span class="n">host_name</span><span class="p">]</span>
                <span class="c1"># We check if for some reason the ip was already given by the ip_generator. </span>
                <span class="c1"># This can only happen if the host naming is not &lt;h_x&gt;.</span>
                <span class="c1"># This should not be possible anymore since we reserve ips for h_x hosts.</span>
                <span class="k">if</span> <span class="n">host_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host_ip</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">host_ip</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ip_generator</span><span class="p">)</span><span class="o">.</span><span class="n">compressed</span>
                <span class="c1"># We check if for some reason the ip was already given by the ip_generator. </span>
                <span class="c1"># This can only happen if the host naming is not &lt;h_x&gt;.</span>
                <span class="c1"># This should not be possible anymore since we reserve ips for h_x hosts.</span>
                <span class="k">while</span> <span class="n">host_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span> <span class="ow">or</span> <span class="n">host_ip</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">reserved_ips</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">host_ip</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">ip_generator</span><span class="p">)</span><span class="o">.</span><span class="n">compressed</span><span class="p">)</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span>

            <span class="n">host_gw</span> <span class="o">=</span> <span class="s1">&#39;10.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.254&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">upper_byte</span><span class="p">,</span> <span class="n">lower_byte</span><span class="p">)</span>
            <span class="n">host_mac</span> <span class="o">=</span> <span class="n">ip_address_to_mac</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">direct_sw_mac</span> <span class="o">=</span> <span class="n">ip_address_to_mac</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfMac</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_mac</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfMac</span><span class="p">(</span><span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw_mac</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_ip</span> <span class="o">+</span> <span class="s1">&#39;/24&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_name</span><span class="p">,</span> <span class="n">host_gw</span> <span class="o">+</span> <span class="s1">&#39;/24&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultRoute</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">host_gw</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span> <span class="ow">or</span> <span class="n">node2</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Switch-switch link</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">sw1_ip</span> <span class="o">=</span> <span class="s1">&#39;20.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.1/24&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sw_to_id</span><span class="p">[</span><span class="n">node1</span><span class="p">],</span> <span class="n">sw_to_id</span><span class="p">[</span><span class="n">node2</span><span class="p">])</span>
                <span class="n">sw2_ip</span> <span class="o">=</span> <span class="s1">&#39;20.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.2/24&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sw_to_id</span><span class="p">[</span><span class="n">node1</span><span class="p">],</span> <span class="n">sw_to_id</span><span class="p">[</span><span class="n">node2</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">sw1_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sw1_ip</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sw1_ip</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sw2_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sw2_ip</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sw2_ip</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">sw1_ip</span><span class="p">)</span> <span class="c1"># Fake and real IPs are handled by the same method setIntfIp.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">sw2_ip</span><span class="p">)</span> <span class="c1"># Fake and real IPs are handled by the same method setIntfIp.</span></div>

<div class="viewcode-block" id="NetworkAPI.l3"><a class="viewcode-back" href="../../../p4utils.mininetlib.network_API.html#p4utils.mininetlib.network_API.NetworkAPI.l3">[docs]</a>    <span class="k">def</span> <span class="nf">l3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Automated IP/MAC assignment strategy for already initialized </span>
<span class="sd">        links and nodes. All the hosts have a different subnetwork shared</span>
<span class="sd">        with the fake IP address of the switch port they are connected to.</span>

<span class="sd">        Assumptions:</span>
<span class="sd">            Each host is connected to exactly one switch.</span>
<span class="sd">            Only switches and hosts are allowed.</span>
<span class="sd">            Parallel links are not allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span><span class="p">(</span><span class="s1">&#39;&quot;l3&quot; assignment strategy selected.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">assigned_ips</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">sw_to_next_available_host_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sw_to_id</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">withInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isP4Switch</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                    <span class="n">sw_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sw_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sw_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_switch_id</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setP4SwitchId</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">sw_id</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dpid</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dpid&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dpid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sw_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_switch_id</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setSwitchDpid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">sw_id</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sw_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
                <span class="n">sw_to_next_available_host_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">sw_to_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">sw_id</span>

        <span class="c1"># Check whether the graph is a multigraph</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multigraph</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span> <span class="ow">or</span> <span class="n">node2</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Node-switch link</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
            <span class="c1"># Switch-node link</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
            <span class="c1"># Switch-switch link</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Reserve host_num (from which the IP is generated) for normal hosts</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_host_valid_ip_from_name</span><span class="p">(</span><span class="n">host_name</span><span class="p">):</span>
                <span class="n">sw_id</span> <span class="o">=</span> <span class="n">sw_to_id</span><span class="p">[</span><span class="n">direct_sw</span><span class="p">]</span>
                <span class="n">host_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">assert</span> <span class="n">host_num</span> <span class="o">&lt;</span> <span class="mi">254</span>
                <span class="n">sw_to_next_available_host_id</span><span class="p">[</span><span class="n">direct_sw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">host_num</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span> <span class="ow">or</span> <span class="n">node2</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Node-switch link</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node1</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">)</span>
            <span class="c1"># Switch-node link</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHost</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">host_name</span> <span class="o">=</span> <span class="n">node2</span>
                <span class="n">direct_sw</span> <span class="o">=</span> <span class="n">node1</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
            <span class="c1"># Switch-switch link</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">sw_id</span> <span class="o">=</span> <span class="n">sw_to_id</span><span class="p">[</span><span class="n">direct_sw</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">sw_id</span> <span class="o">&lt;</span> <span class="mi">254</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_host_valid_ip_from_name</span><span class="p">(</span><span class="n">host_name</span><span class="p">):</span>
                <span class="n">host_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">host_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">assert</span> <span class="n">host_num</span> <span class="o">&lt;</span> <span class="mi">254</span>
                <span class="n">host_ip</span> <span class="o">=</span> <span class="s1">&#39;10.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.2&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sw_id</span><span class="p">,</span> <span class="n">host_num</span><span class="p">)</span>
                <span class="n">host_gw</span> <span class="o">=</span> <span class="s1">&#39;10.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.1&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sw_id</span><span class="p">,</span> <span class="n">host_num</span><span class="p">)</span>
                <span class="c1"># We check if for some reason the ip was already given by the ip_generator. </span>
                <span class="c1"># This can only happen if the host naming is not &lt;h_x&gt;.</span>
                <span class="c1"># This should not be possible anymore since we reserve ips for h_x hosts.</span>
                <span class="k">if</span> <span class="n">host_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host_ip</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">host_gw</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host_gw</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">host_gw</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">host_num</span> <span class="o">=</span> <span class="n">next_element</span><span class="p">(</span><span class="n">sw_to_next_available_host_id</span><span class="p">[</span><span class="n">direct_sw</span><span class="p">],</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">254</span><span class="p">)</span>
                <span class="n">host_ip</span> <span class="o">=</span> <span class="s1">&#39;10.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.2&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sw_id</span><span class="p">,</span> <span class="n">host_num</span><span class="p">)</span>
                <span class="n">host_gw</span> <span class="o">=</span> <span class="s1">&#39;10.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.1&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sw_id</span><span class="p">,</span> <span class="n">host_num</span><span class="p">)</span>
                <span class="c1"># We check if for some reason the ip was already given by the ip_generator. </span>
                <span class="c1"># This can only happen if the host naming is not &lt;h_x&gt;.</span>
                <span class="c1"># This should not be possible anymore since we reserve ips for h_x hosts.</span>
                <span class="k">if</span> <span class="n">host_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host_ip</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">host_gw</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host_gw</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">host_gw</span><span class="p">)</span>
                <span class="n">sw_to_next_available_host_id</span><span class="p">[</span><span class="n">direct_sw</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">host_num</span><span class="p">)</span>

            <span class="n">host_mac</span> <span class="o">=</span> <span class="n">ip_address_to_mac</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">direct_sw_mac</span> <span class="o">=</span> <span class="n">ip_address_to_mac</span><span class="p">(</span><span class="n">host_ip</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfMac</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_mac</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfMac</span><span class="p">(</span><span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw_mac</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_ip</span> <span class="o">+</span> <span class="s1">&#39;/24&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">direct_sw</span><span class="p">,</span> <span class="n">host_name</span><span class="p">,</span> <span class="n">host_gw</span> <span class="o">+</span> <span class="s1">&#39;/24&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultRoute</span><span class="p">(</span><span class="n">host_name</span><span class="p">,</span> <span class="n">host_gw</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># Skip CPU switch</span>
            <span class="k">if</span> <span class="n">node1</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span> <span class="ow">or</span> <span class="n">node2</span> <span class="o">==</span> <span class="s1">&#39;sw-cpu&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Switch-switch link</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSwitch</span><span class="p">(</span><span class="n">node2</span><span class="p">):</span>
                <span class="n">sw1_ip</span> <span class="o">=</span> <span class="s1">&#39;20.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.1/24&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sw_to_id</span><span class="p">[</span><span class="n">node1</span><span class="p">],</span> <span class="n">sw_to_id</span><span class="p">[</span><span class="n">node2</span><span class="p">])</span>
                <span class="n">sw2_ip</span> <span class="o">=</span> <span class="s1">&#39;20.</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">.2/24&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sw_to_id</span><span class="p">[</span><span class="n">node1</span><span class="p">],</span> <span class="n">sw_to_id</span><span class="p">[</span><span class="n">node2</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">sw1_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sw1_ip</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sw1_ip</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sw2_ip</span> <span class="ow">in</span> <span class="n">assigned_ips</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;IP </span><span class="si">{}</span><span class="s1"> has been already assigned to a host.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sw2_ip</span><span class="p">))</span>
                <span class="n">assigned_ips</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sw2_ip</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">sw1_ip</span><span class="p">)</span> <span class="c1"># Fake and real IPs are handled by the same method setIntfIp.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setIntfIp</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">sw2_ip</span><span class="p">)</span> <span class="c1"># Fake and real IPs are handled by the same method setIntfIp.</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Networked Systems Group (NSG@ETH).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>